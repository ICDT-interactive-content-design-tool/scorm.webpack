/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t,e,i={790:(t,e,i)=>{t.exports=function t(e,i,n){function r(s,o){if(!i[s]){if(!e[s]){if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};e[s][0].call(c.exports,(function(t){return r(e[s][1][t]||t)}),c,c.exports,t,e,i,n)}return i[s].exports}for(var a=void 0,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,n){(function(t){"use strict";var i,n,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var a=0,s=new r(d),o=t.document.createTextNode("");s.observe(o,{characterData:!0}),i=function(){o.data=a=++a%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){d(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(d,0)};else{var l=new t.MessageChannel;l.port1.onmessage=d,i=function(){l.port2.postMessage(0)}}var c=[];function d(){var t,e;n=!0;for(var i=c.length;i;){for(e=c,c=[],t=-1;++t<i;)e[t]();i=c.length}n=!1}e.exports=function(t){1!==c.push(t)||n||i()}}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){"use strict";var n=t(1);function r(){}var a={},s=["REJECTED"],o=["FULFILLED"],l=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==r&&f(this,t)}function d(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function h(t,e,i){n((function(){var n;try{n=e(i)}catch(e){return a.reject(t,e)}n===t?a.reject(t,new TypeError("Cannot resolve promise with itself")):a.resolve(t,n)}))}function u(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function f(t,e){var i=!1;function n(e){i||(i=!0,a.reject(t,e))}function r(e){i||(i=!0,a.resolve(t,e))}var s=g((function(){e(r,n)}));"error"===s.status&&n(s.value)}function g(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}e.exports=c,c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===o||"function"!=typeof e&&this.state===s)return this;var i=new this.constructor(r);return this.state!==l?h(i,this.state===o?t:e,this.outcome):this.queue.push(new d(i,t,e)),i},d.prototype.callFulfilled=function(t){a.resolve(this.promise,t)},d.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)},d.prototype.callRejected=function(t){a.reject(this.promise,t)},d.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)},a.resolve=function(t,e){var i=g(u,e);if("error"===i.status)return a.reject(t,i.value);var n=i.value;if(n)f(t,n);else{t.state=o,t.outcome=e;for(var r=-1,s=t.queue.length;++r<s;)t.queue[r].callFulfilled(e)}return t},a.reject=function(t,e){t.state=s,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},c.resolve=function(t){return t instanceof this?t:a.resolve(new this(r),t)},c.reject=function(t){var e=new this(r);return a.reject(e,t)},c.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var s=new Array(i),o=0,l=-1,c=new this(r);++l<i;)d(t[l],l);return c;function d(t,r){e.resolve(t).then((function(t){s[r]=t,++o!==i||n||(n=!0,a.resolve(c,s))}),(function(t){n||(n=!0,a.reject(c,t))}))}},c.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i,n=t.length,s=!1;if(!n)return this.resolve([]);for(var o=-1,l=new this(r);++o<n;)i=t[o],e.resolve(i).then((function(t){s||(s=!0,a.resolve(l,t))}),(function(t){s||(s=!0,a.reject(l,t))}));return l}},{1:1}],3:[function(t,e,n){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var r=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function a(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(r){if("TypeError"!==r.name)throw r;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)i.append(t[n]);return i.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var s=Promise;function o(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function l(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function c(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",u=void 0,f={},g=Object.prototype.toString,p="readonly",y="readwrite";function m(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),r=0;r<e;r++)n[r]=t.charCodeAt(r);return i}function v(t){return"boolean"==typeof u?s.resolve(u):function(t){return new s((function(e){var i=t.transaction(h,y),n=a([""]);i.objectStore(h).put(n,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43)}})).catch((function(){return!1}))}(t).then((function(t){return u=t}))}function b(t){var e=f[t.name],i={};i.promise=new s((function(t,e){i.resolve=t,i.reject=e})),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then((function(){return i.promise})):e.dbReady=i.promise}function w(t){var e=f[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function S(t,e){var i=f[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function x(t,e){return new s((function(i,n){if(f[t.name]=f[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return i(t.db);b(t),t.db.close()}var a=[t.name];e&&a.push(t.version);var s=r.open.apply(r,a);e&&(s.onupgradeneeded=function(e){var i=s.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(h)}catch(i){if("ConstraintError"!==i.name)throw i;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),s.onerror=function(t){t.preventDefault(),n(s.error)},s.onsuccess=function(){var e=s.result;e.onversionchange=function(t){t.target.close()},i(e),w(t)}}))}function _(t){return x(t,!1)}function k(t){return x(t,!0)}function O(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,r=t.version>t.db.version;if(n&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),r||i){if(i){var a=t.db.version+1;a>t.version&&(t.version=a)}return!0}return!1}function N(t){return a([m(atob(t.data))],{type:t.type})}function E(t){return t&&t.__local_forage_encoded_blob}function I(t){var e=this,i=e._initReady().then((function(){var t=f[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return l(i,t,t),i}function z(t,e,i,n){void 0===n&&(n=1);try{var r=t.db.transaction(t.storeName,e);i(null,r)}catch(r){if(n>0&&(!t.db||"InvalidStateError"===r.name||"NotFoundError"===r.name))return s.resolve().then((function(){if(!t.db||"NotFoundError"===r.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),k(t)})).then((function(){return function(t){b(t);for(var e=f[t.name],i=e.forages,n=0;n<i.length;n++){var r=i[n];r._dbInfo.db&&(r._dbInfo.db.close(),r._dbInfo.db=null)}return t.db=null,_(t).then((function(e){return t.db=e,O(t)?k(t):e})).then((function(n){t.db=e.db=n;for(var r=0;r<i.length;r++)i[r]._dbInfo.db=n})).catch((function(e){throw S(t,e),e}))}(t).then((function(){z(t,e,i,n-1)}))})).catch(i);i(r)}}var j={_driver:"asyncStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]=t[n];var r=f[i.name];r||(r={forages:[],db:null,dbReady:null,deferredOperations:[]},f[i.name]=r),r.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=I);var a=[];function o(){return s.resolve()}for(var l=0;l<r.forages.length;l++){var c=r.forages[l];c!==e&&a.push(c._initReady().catch(o))}var d=r.forages.slice(0);return s.all(a).then((function(){return i.db=r.db,_(i)})).then((function(t){return i.db=t,O(i,e._defaultConfig.version)?k(i):t})).then((function(t){i.db=r.db=t,e._dbInfo=i;for(var n=0;n<d.length;n++){var a=d[n];a!==e&&(a._dbInfo.db=i.db,a._dbInfo.version=i.version)}}))},_support:function(){try{if(!r||!r.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var i=this,n=new s((function(e,n){i.ready().then((function(){z(i._dbInfo,p,(function(r,a){if(r)return n(r);try{var s=a.objectStore(i._dbInfo.storeName).openCursor(),o=1;s.onsuccess=function(){var i=s.result;if(i){var n=i.value;E(n)&&(n=N(n));var r=t(n,i.key,o++);void 0!==r?e(r):i.continue()}else e()},s.onerror=function(){n(s.error)}}catch(t){n(t)}}))})).catch(n)}));return o(n,e),n},getItem:function(t,e){var i=this;t=c(t);var n=new s((function(e,n){i.ready().then((function(){z(i._dbInfo,p,(function(r,a){if(r)return n(r);try{var s=a.objectStore(i._dbInfo.storeName).get(t);s.onsuccess=function(){var t=s.result;void 0===t&&(t=null),E(t)&&(t=N(t)),e(t)},s.onerror=function(){n(s.error)}}catch(t){n(t)}}))})).catch(n)}));return o(n,e),n},setItem:function(t,e,i){var n=this;t=c(t);var r=new s((function(i,r){var a;n.ready().then((function(){return a=n._dbInfo,"[object Blob]"===g.call(e)?v(a.db).then((function(t){return t?e:(i=e,new s((function(t,e){var n=new FileReader;n.onerror=e,n.onloadend=function(e){var n=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:i.type})},n.readAsBinaryString(i)})));var i})):e})).then((function(e){z(n._dbInfo,y,(function(a,s){if(a)return r(a);try{var o=s.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=o.put(e,t);s.oncomplete=function(){void 0===e&&(e=null),i(e)},s.onabort=s.onerror=function(){var t=l.error?l.error:l.transaction.error;r(t)}}catch(t){r(t)}}))})).catch(r)}));return o(r,i),r},removeItem:function(t,e){var i=this;t=c(t);var n=new s((function(e,n){i.ready().then((function(){z(i._dbInfo,y,(function(r,a){if(r)return n(r);try{var s=a.objectStore(i._dbInfo.storeName).delete(t);a.oncomplete=function(){e()},a.onerror=function(){n(s.error)},a.onabort=function(){var t=s.error?s.error:s.transaction.error;n(t)}}catch(t){n(t)}}))})).catch(n)}));return o(n,e),n},clear:function(t){var e=this,i=new s((function(t,i){e.ready().then((function(){z(e._dbInfo,y,(function(n,r){if(n)return i(n);try{var a=r.objectStore(e._dbInfo.storeName).clear();r.oncomplete=function(){t()},r.onabort=r.onerror=function(){var t=a.error?a.error:a.transaction.error;i(t)}}catch(t){i(t)}}))})).catch(i)}));return o(i,t),i},length:function(t){var e=this,i=new s((function(t,i){e.ready().then((function(){z(e._dbInfo,p,(function(n,r){if(n)return i(n);try{var a=r.objectStore(e._dbInfo.storeName).count();a.onsuccess=function(){t(a.result)},a.onerror=function(){i(a.error)}}catch(t){i(t)}}))})).catch(i)}));return o(i,t),i},key:function(t,e){var i=this,n=new s((function(e,n){t<0?e(null):i.ready().then((function(){z(i._dbInfo,p,(function(r,a){if(r)return n(r);try{var s=a.objectStore(i._dbInfo.storeName),o=!1,l=s.openKeyCursor();l.onsuccess=function(){var i=l.result;i?0===t||o?e(i.key):(o=!0,i.advance(t)):e(null)},l.onerror=function(){n(l.error)}}catch(t){n(t)}}))})).catch(n)}));return o(n,e),n},keys:function(t){var e=this,i=new s((function(t,i){e.ready().then((function(){z(e._dbInfo,p,(function(n,r){if(n)return i(n);try{var a=r.objectStore(e._dbInfo.storeName).openKeyCursor(),s=[];a.onsuccess=function(){var e=a.result;e?(s.push(e.key),e.continue()):t(s)},a.onerror=function(){i(a.error)}}catch(t){i(t)}}))})).catch(i)}));return o(i,t),i},dropInstance:function(t,e){e=d.apply(this,arguments);var i,n=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName),t.name){var a=t.name===n.name&&this._dbInfo.db?s.resolve(this._dbInfo.db):_(t).then((function(e){var i=f[t.name],n=i.forages;i.db=e;for(var r=0;r<n.length;r++)n[r]._dbInfo.db=e;return e}));i=t.storeName?a.then((function(e){if(e.objectStoreNames.contains(t.storeName)){var i=e.version+1;b(t);var n=f[t.name],a=n.forages;e.close();for(var o=0;o<a.length;o++){var l=a[o];l._dbInfo.db=null,l._dbInfo.version=i}var c=new s((function(e,n){var a=r.open(t.name,i);a.onerror=function(t){a.result.close(),n(t)},a.onupgradeneeded=function(){a.result.deleteObjectStore(t.storeName)},a.onsuccess=function(){var t=a.result;t.close(),e(t)}}));return c.then((function(t){n.db=t;for(var e=0;e<a.length;e++){var i=a[e];i._dbInfo.db=t,w(i._dbInfo)}})).catch((function(e){throw(S(t,e)||s.resolve()).catch((function(){})),e}))}})):a.then((function(e){b(t);var i=f[t.name],n=i.forages;e.close();for(var a=0;a<n.length;a++)n[a]._dbInfo.db=null;var o=new s((function(e,i){var n=r.deleteDatabase(t.name);n.onerror=function(){var t=n.result;t&&t.close(),i(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},n.onsuccess=function(){var t=n.result;t&&t.close(),e(t)}}));return o.then((function(t){i.db=t;for(var e=0;e<n.length;e++)w(n[e]._dbInfo)})).catch((function(e){throw(S(t,e)||s.resolve()).catch((function(){})),e}))}))}else i=s.reject("Invalid arguments");return o(i,e),i}};var J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$=/^~~local_forage_type~([^~]+)~/,A="__lfsc__:",T="arbf",C="blob",B="si08",R="ui08",M="uic8",L="si16",P="si32",F="ur16",K="ui32",G="fl32",D="fl64",Q=Object.prototype.toString;function U(t){var e,i,n,r,a,s=.75*t.length,o=t.length,l=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var c=new ArrayBuffer(s),d=new Uint8Array(c);for(e=0;e<o;e+=4)i=J.indexOf(t[e]),n=J.indexOf(t[e+1]),r=J.indexOf(t[e+2]),a=J.indexOf(t[e+3]),d[l++]=i<<2|n>>4,d[l++]=(15&n)<<4|r>>2,d[l++]=(3&r)<<6|63&a;return c}function W(t){var e,i=new Uint8Array(t),n="";for(e=0;e<i.length;e+=3)n+=J[i[e]>>2],n+=J[(3&i[e])<<4|i[e+1]>>4],n+=J[(15&i[e+1])<<2|i[e+2]>>6],n+=J[63&i[e+2]];return i.length%3==2?n=n.substring(0,n.length-1)+"=":i.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var V={serialize:function(t,e){var i="";if(t&&(i=Q.call(t)),t&&("[object ArrayBuffer]"===i||t.buffer&&"[object ArrayBuffer]"===Q.call(t.buffer))){var n,r=A;t instanceof ArrayBuffer?(n=t,r+=T):(n=t.buffer,"[object Int8Array]"===i?r+=B:"[object Uint8Array]"===i?r+=R:"[object Uint8ClampedArray]"===i?r+=M:"[object Int16Array]"===i?r+=L:"[object Uint16Array]"===i?r+=F:"[object Int32Array]"===i?r+=P:"[object Uint32Array]"===i?r+=K:"[object Float32Array]"===i?r+=G:"[object Float64Array]"===i?r+=D:e(new Error("Failed to get type for BinaryArray"))),e(r+W(n))}else if("[object Blob]"===i){var a=new FileReader;a.onload=function(){var i="~~local_forage_type~"+t.type+"~"+W(this.result);e(A+C+i)},a.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(i){console.error("Couldn't convert value into a JSON string: ",t),e(null,i)}},deserialize:function(t){if(t.substring(0,9)!==A)return JSON.parse(t);var e,i=t.substring(13),n=t.substring(9,13);if(n===C&&$.test(i)){var r=i.match($);e=r[1],i=i.substring(r[0].length)}var s=U(i);switch(n){case T:return s;case C:return a([s],{type:e});case B:return new Int8Array(s);case R:return new Uint8Array(s);case M:return new Uint8ClampedArray(s);case L:return new Int16Array(s);case F:return new Uint16Array(s);case P:return new Int32Array(s);case K:return new Uint32Array(s);case G:return new Float32Array(s);case D:return new Float64Array(s);default:throw new Error("Unkown type: "+n)}},stringToBuffer:U,bufferToString:W};function H(t,e,i,n){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,n)}function X(t,e,i,n,r,a){t.executeSql(i,n,r,(function(t,s){s.code===s.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],(function(t,o){o.rows.length?a(t,s):H(t,e,(function(){t.executeSql(i,n,r,a)}),a)}),a):a(t,s)}),a)}function q(t,e,i,n){var r=this;t=c(t);var a=new s((function(a,s){r.ready().then((function(){void 0===e&&(e=null);var o=e,l=r._dbInfo;l.serializer.serialize(e,(function(e,c){c?s(c):l.db.transaction((function(i){X(i,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[t,e],(function(){a(o)}),(function(t,e){s(e)}))}),(function(e){if(e.code===e.QUOTA_ERR){if(n>0)return void a(q.apply(r,[t,o,i,n-1]));s(e)}}))}))})).catch(s)}));return o(a,i),a}var Y={_driver:"webSQLStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]="string"!=typeof t[n]?t[n].toString():t[n];var r=new s((function(t,n){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(t){return n(t)}i.db.transaction((function(r){H(r,i,(function(){e._dbInfo=i,t()}),(function(t,e){n(e)}))}),n)}));return i.serializer=V,r},_support:"function"==typeof openDatabase,iterate:function(t,e){var i=this,n=new s((function(e,n){i.ready().then((function(){var r=i._dbInfo;r.db.transaction((function(i){X(i,r,"SELECT * FROM "+r.storeName,[],(function(i,n){for(var a=n.rows,s=a.length,o=0;o<s;o++){var l=a.item(o),c=l.value;if(c&&(c=r.serializer.deserialize(c)),void 0!==(c=t(c,l.key,o+1)))return void e(c)}e()}),(function(t,e){n(e)}))}))})).catch(n)}));return o(n,e),n},getItem:function(t,e){var i=this;t=c(t);var n=new s((function(e,n){i.ready().then((function(){var r=i._dbInfo;r.db.transaction((function(i){X(i,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,i){var n=i.rows.length?i.rows.item(0).value:null;n&&(n=r.serializer.deserialize(n)),e(n)}),(function(t,e){n(e)}))}))})).catch(n)}));return o(n,e),n},setItem:function(t,e,i){return q.apply(this,[t,e,i,1])},removeItem:function(t,e){var i=this;t=c(t);var n=new s((function(e,n){i.ready().then((function(){var r=i._dbInfo;r.db.transaction((function(i){X(i,r,"DELETE FROM "+r.storeName+" WHERE key = ?",[t],(function(){e()}),(function(t,e){n(e)}))}))})).catch(n)}));return o(n,e),n},clear:function(t){var e=this,i=new s((function(t,i){e.ready().then((function(){var n=e._dbInfo;n.db.transaction((function(e){X(e,n,"DELETE FROM "+n.storeName,[],(function(){t()}),(function(t,e){i(e)}))}))})).catch(i)}));return o(i,t),i},length:function(t){var e=this,i=new s((function(t,i){e.ready().then((function(){var n=e._dbInfo;n.db.transaction((function(e){X(e,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(e,i){var n=i.rows.item(0).c;t(n)}),(function(t,e){i(e)}))}))})).catch(i)}));return o(i,t),i},key:function(t,e){var i=this,n=new s((function(e,n){i.ready().then((function(){var r=i._dbInfo;r.db.transaction((function(i){X(i,r,"SELECT key FROM "+r.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,i){var n=i.rows.length?i.rows.item(0).key:null;e(n)}),(function(t,e){n(e)}))}))})).catch(n)}));return o(n,e),n},keys:function(t){var e=this,i=new s((function(t,i){e.ready().then((function(){var n=e._dbInfo;n.db.transaction((function(e){X(e,n,"SELECT key FROM "+n.storeName,[],(function(e,i){for(var n=[],r=0;r<i.rows.length;r++)n.push(i.rows.item(r).key);t(n)}),(function(t,e){i(e)}))}))})).catch(i)}));return o(i,t),i},dropInstance:function(t,e){e=d.apply(this,arguments);var i=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||i.name,t.storeName=t.storeName||i.storeName);var n,r=this;return o(n=t.name?new s((function(e){var n;n=t.name===i.name?r._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:n,storeNames:[t.storeName]}):e(function(t){return new s((function(e,i){t.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(i,n){for(var r=[],a=0;a<n.rows.length;a++)r.push(n.rows.item(a).name);e({db:t,storeNames:r})}),(function(t,e){i(e)}))}),(function(t){i(t)}))}))}(n))})).then((function(t){return new s((function(e,i){t.db.transaction((function(n){function r(t){return new s((function(e,i){n.executeSql("DROP TABLE IF EXISTS "+t,[],(function(){e()}),(function(t,e){i(e)}))}))}for(var a=[],o=0,l=t.storeNames.length;o<l;o++)a.push(r(t.storeNames[o]));s.all(a).then((function(){e()})).catch((function(t){i(t)}))}),(function(t){i(t)}))}))})):s.reject("Invalid arguments"),e),n}};function Z(t,e){var i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}function tt(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||localStorage.length>0}var et={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=Z(t,this._defaultConfig),tt()?(this._dbInfo=e,e.serializer=V,s.resolve()):s.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var i=this,n=i.ready().then((function(){for(var e=i._dbInfo,n=e.keyPrefix,r=n.length,a=localStorage.length,s=1,o=0;o<a;o++){var l=localStorage.key(o);if(0===l.indexOf(n)){var c=localStorage.getItem(l);if(c&&(c=e.serializer.deserialize(c)),void 0!==(c=t(c,l.substring(r),s++)))return c}}}));return o(n,e),n},getItem:function(t,e){var i=this;t=c(t);var n=i.ready().then((function(){var e=i._dbInfo,n=localStorage.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n}));return o(n,e),n},setItem:function(t,e,i){var n=this;t=c(t);var r=n.ready().then((function(){void 0===e&&(e=null);var i=e;return new s((function(r,a){var s=n._dbInfo;s.serializer.serialize(e,(function(e,n){if(n)a(n);else try{localStorage.setItem(s.keyPrefix+t,e),r(i)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||a(t),a(t)}}))}))}));return o(r,i),r},removeItem:function(t,e){var i=this;t=c(t);var n=i.ready().then((function(){var e=i._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return o(n,e),n},clear:function(t){var e=this,i=e.ready().then((function(){for(var t=e._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var n=localStorage.key(i);0===n.indexOf(t)&&localStorage.removeItem(n)}}));return o(i,t),i},length:function(t){var e=this.keys().then((function(t){return t.length}));return o(e,t),e},key:function(t,e){var i=this,n=i.ready().then((function(){var e,n=i._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(n.keyPrefix.length)),e}));return o(n,e),n},keys:function(t){var e=this,i=e.ready().then((function(){for(var t=e._dbInfo,i=localStorage.length,n=[],r=0;r<i;r++){var a=localStorage.key(r);0===a.indexOf(t.keyPrefix)&&n.push(a.substring(t.keyPrefix.length))}return n}));return o(i,t),i},dropInstance:function(t,e){if(e=d.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var i=this.config();t.name=t.name||i.name,t.storeName=t.storeName||i.storeName}var n,r=this;return n=t.name?new s((function(e){t.storeName?e(Z(t,r._defaultConfig)):e(t.name+"/")})).then((function(t){for(var e=localStorage.length-1;e>=0;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}})):s.reject("Invalid arguments"),o(n,e),n}},it=function(t,e){for(var i=t.length,n=0;n<i;){if((r=t[n])===(a=e)||"number"==typeof r&&"number"==typeof a&&isNaN(r)&&isNaN(a))return!0;n++}var r,a;return!1},nt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},rt={},at={},st={INDEXEDDB:j,WEBSQL:Y,LOCALSTORAGE:et},ot=[st.INDEXEDDB._driver,st.WEBSQL._driver,st.LOCALSTORAGE._driver],lt=["dropInstance"],ct=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(lt),dt={description:"",driver:ot.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ht(t,e){t[e]=function(){var i=arguments;return t.ready().then((function(){return t[e].apply(t,i)}))}}function ut(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var i in e)e.hasOwnProperty(i)&&(nt(e[i])?arguments[0][i]=e[i].slice():arguments[0][i]=e[i])}return arguments[0]}var ft=function(){function t(e){for(var i in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),st)if(st.hasOwnProperty(i)){var n=st[i],r=n._driver;this[i]=r,rt[r]||this.defineDriver(n)}this._defaultConfig=ut({},dt),this._config=ut({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":n(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,i){var n=new s((function(e,i){try{var n=t._driver,r=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(r);for(var a=ct.concat("_initStorage"),l=0,c=a.length;l<c;l++){var d=a[l];if((!it(lt,d)||t[d])&&"function"!=typeof t[d])return void i(r)}!function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),i=s.reject(e);return o(i,arguments[arguments.length-1]),i}},i=0,n=lt.length;i<n;i++){var r=lt[i];t[r]||(t[r]=e(r))}}();var h=function(i){rt[n]&&console.info("Redefining LocalForage driver: "+n),rt[n]=t,at[n]=i,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(h,i):h(!!t._support):h(!0)}catch(t){i(t)}}));return l(n,e,i),n},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,i){var n=rt[t]?s.resolve(rt[t]):s.reject(new Error("Driver not found."));return l(n,e,i),n},t.prototype.getSerializer=function(t){var e=s.resolve(V);return l(e,t),e},t.prototype.ready=function(t){var e=this,i=e._driverSet.then((function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready}));return l(i,t,t),i},t.prototype.setDriver=function(t,e,i){var n=this;nt(t)||(t=[t]);var r=this._getSupportedDrivers(t);function a(){n._config.driver=n.driver()}function o(t){return n._extend(t),a(),n._ready=n._initStorage(n._config),n._ready}var c=null!==this._driverSet?this._driverSet.catch((function(){return s.resolve()})):s.resolve();return this._driverSet=c.then((function(){var t=r[0];return n._dbInfo=null,n._ready=null,n.getDriver(t).then((function(t){n._driver=t._driver,a(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(t){return function(){var e=0;return function i(){for(;e<t.length;){var r=t[e];return e++,n._dbInfo=null,n._ready=null,n.getDriver(r).then(o).catch(i)}a();var l=new Error("No available storage method found.");return n._driverSet=s.reject(l),n._driverSet}()}}(r)}))})).catch((function(){a();var t=new Error("No available storage method found.");return n._driverSet=s.reject(t),n._driverSet})),l(this._driverSet,e,i),this._driverSet},t.prototype.supports=function(t){return!!at[t]},t.prototype._extend=function(t){ut(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];this.supports(r)&&e.push(r)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=ct.length;t<e;t++)ht(this,ct[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),gt=new ft;e.exports=gt},{3:3}]},{},[4])(4)},314:(t,e,i)=>{"use strict";i.r(e),i.d(e,{APP_FONT:()=>en,APP_FONT_Content:()=>tn,LocalStorage_GetClipboard:()=>pa,LocalStorage_GetConfig:()=>fa,LocalStorage_GetData:()=>ha,LocalStorage_SetClipboard:()=>ya,LocalStorage_SetConfig:()=>ga,LocalStorage_SetData:()=>ua,V_ForeignObjectType:()=>Pi,V_ID:()=>Ti,V_Keyboard:()=>Gi,V_MediaType:()=>Fi,V_OssType:()=>Ki,V_PenType:()=>Bi,V_PointerType:()=>Ci,V_PolygonRatio:()=>Li,V_PolygonType:()=>Mi,V_ShapeType:()=>Ri,animate:()=>bs,animateIn:()=>ws,animateOut:()=>Ss,attributeDominantBaseline:()=>sl,attributeFill:()=>Ko,attributeFillOpacity:()=>Go,attributeFontFamily:()=>qo,attributeFontSize:()=>tl,attributeFontStyle:()=>Zo,attributeFontWeight:()=>Yo,attributeLetterSpacing:()=>il,attributeOpacity:()=>Fo,attributePreserveAspectRatio:()=>Xo,attributeR:()=>ol,attributeRx:()=>ll,attributeRy:()=>cl,attributeStroke:()=>Do,attributeStrokeDasharray:()=>Wo,attributeStrokeLinecap:()=>Vo,attributeStrokeLinejoin:()=>Ho,attributeStrokeOpacity:()=>Qo,attributeStrokeWidth:()=>Uo,attributeTextAnchor:()=>al,attributeTextDecoration:()=>rl,attributeTextLength:()=>el,attributeWordSpacing:()=>nl,combineData:()=>vs,extractFont:()=>nn,extractFontFromData:()=>rn,extractFromDataV1:()=>qn,extractFromSVG:()=>us,extractSourceV1:()=>Hn,getMediaViewerUrl:()=>ln,icdt:()=>ls,icdt_ActiveNodes:()=>Pr,icdt_AlignBottom:()=>Io,icdt_AlignCenter:()=>zo,icdt_AlignLeft:()=>Oo,icdt_AlignMiddle:()=>jo,icdt_AlignParentBottom:()=>To,icdt_AlignParentCenter:()=>Co,icdt_AlignParentLeft:()=>Jo,icdt_AlignParentMiddle:()=>Bo,icdt_AlignParentRight:()=>Ao,icdt_AlignParentTop:()=>$o,icdt_AlignRight:()=>Eo,icdt_AlignStretchX:()=>Ro,icdt_AlignStretchY:()=>Mo,icdt_AlignTop:()=>No,icdt_IndexComponent:()=>Da,icdt_Init:()=>Wa,icdt_Interactive:()=>Ia,icdt_InteractiveComponent:()=>ja,icdt_Keyboard:()=>ka,icdt_KeyboardComponent:()=>Oa,icdt_PenComponent:()=>za,icdt_PointerScale:()=>Ar,icdt_RenderComponent:()=>ma,icdt_RoundNumber:()=>hn,icdt_Run:()=>hr,icdt_SlideClearNodeIndex:()=>Ua,icdt_SortComponent:()=>va,icdt_StretchParentX:()=>Lo,icdt_StretchParentY:()=>Po,icdt_Svg:()=>fr,icdt_SvgRenew:()=>yr,icdt_SyncSvgBackground:()=>gr,icdt_SyncSvgNode:()=>mr,icdt_SyncSvgNode4Design:()=>xr,icdt_SyncSvgNodeAttribute:()=>vr,icdt_SyncSvgNodeSource:()=>wr,icdt_SyncSvgNodeStyle:()=>br,icdt_SyncSvgNodeStyleActive:()=>Sr,icdt_SyncSvgStyle:()=>pr,interactiveClickActionFinish:()=>Vs,interactiveClickActionIteration:()=>Ws,interactiveClickActionPoints:()=>Qs,interactiveClickActionTime:()=>Us,interactiveClickActionValue:()=>Ds,interactiveClickAudioAsync:()=>Ys,interactiveClickAudioFinish:()=>qs,interactiveClickAudioIteration:()=>Xs,interactiveClickAudioSource:()=>Hs,interactiveClickAudioTime:()=>Zs,interactiveClickImageSource:()=>po,interactiveClickLinkSource:()=>mo,interactiveClickLinkSourceUrl:()=>vo,interactiveClickMedia:()=>go,interactiveClickSlide:()=>fo,interactiveClickText:()=>bo,interactiveClickTriggerHideAsync:()=>ho,interactiveClickTriggerHideId:()=>lo,interactiveClickTriggerHideIds:()=>co,interactiveClickTriggerHideTime:()=>uo,interactiveClickTriggerRunAsync:()=>so,interactiveClickTriggerRunId:()=>ro,interactiveClickTriggerRunIds:()=>ao,interactiveClickTriggerRunTime:()=>oo,interactiveClickTriggerShowAsync:()=>io,interactiveClickTriggerShowId:()=>to,interactiveClickTriggerShowIds:()=>eo,interactiveClickTriggerShowTime:()=>no,interactiveClickVideoSource:()=>yo,interactiveShowActionFinish:()=>Ns,interactiveShowActionIteration:()=>Os,interactiveShowActionPoints:()=>_s,interactiveShowActionTime:()=>ks,interactiveShowActionValue:()=>xs,interactiveShowAudioAsync:()=>js,interactiveShowAudioFinish:()=>zs,interactiveShowAudioIteration:()=>Is,interactiveShowAudioSource:()=>Es,interactiveShowAudioTime:()=>Js,interactiveShowTriggerHideAsync:()=>Ks,interactiveShowTriggerHideId:()=>Ps,interactiveShowTriggerHideIds:()=>Fs,interactiveShowTriggerHideTime:()=>Gs,interactiveShowTriggerRunAsync:()=>Ms,interactiveShowTriggerRunId:()=>Bs,interactiveShowTriggerRunIds:()=>Rs,interactiveShowTriggerRunTime:()=>Ls,interactiveShowTriggerShowAsync:()=>Ts,interactiveShowTriggerShowId:()=>$s,interactiveShowTriggerShowIds:()=>As,interactiveShowTriggerShowTime:()=>Cs,isColorHex:()=>cs,isColorRGB:()=>ds,isColorText:()=>hs,lib_rgba2hex:()=>an,sizeHeight:()=>xa,sizeRotate:()=>_a,sizeWidth:()=>Sa,sizeX:()=>ba,sizeY:()=>wa,sourceAudio:()=>Qr,sourceEmbed:()=>qr,sourceFile:()=>Wr,sourceHtml:()=>Kr,sourceIframe:()=>Vr,sourceImage:()=>Dr,sourceInputPlaceholder:()=>Xr,sourceLink:()=>Gr,sourceText:()=>Fr,sourceTrack:()=>Hr,sourceVideo:()=>Ur,styleBackgroundColor:()=>wl,styleBackgroundOpacity:()=>Sl,styleBorderColor:()=>fl,styleBorderOpacity:()=>gl,styleBorderRadius:()=>pl,styleBorderStyle:()=>ul,styleBorderWidth:()=>hl,styleColor:()=>vl,styleFontFamily:()=>yl,styleFontSize:()=>ml,styleOpacity:()=>bl,stylePadding:()=>dl,svgBackgroundColor:()=>Nl,svgBackgroundImage:()=>Il,svgBackgroundOpacity:()=>El,svgCreate_RectCenterAttribute:()=>Di,svgDesign_LineAttribute:()=>Qi,svgDesign_RectAttribute:()=>Ui,svgDesign_RectCenterAttribute:()=>Wi,svgInteractive_LineAttribute:()=>qi,svgInteractive_RectCenterAttribute:()=>Yi,svgSelect_RectNodeAttribute:()=>Vi,svgSelect_RectTextNodeAttribute:()=>Hi,svgSelect_TextNodeAttribute:()=>Xi,svgSetIdx_RectNodeAttribute:()=>Zi,svgViewBoxHeight:()=>Ol,svgViewBoxWidth:()=>kl,svgViewBoxX:()=>xl,svgViewBoxY:()=>_l,syncBackground:()=>jr,syncNodeCreate:()=>_r,syncNodeIndex:()=>zr,syncNodeInteractive:()=>Ir,syncNodeResize:()=>kr,syncNodeScan:()=>Er,syncNodeSelect:()=>Nr,syncResizeNodes:()=>Or,syncSvg:()=>ur,syncTest:()=>Jr,variableClickOperator:()=>xo,variableClickValue:()=>ko,variableClickValueType:()=>_o,variableClickVariable:()=>So,variableInputVariable:()=>wo});var n=i(790),r=i.t(n,2);function a(){}function s(t){return null==t?a:function(){return this.querySelector(t)}}function o(){return[]}function l(t){return null==t?o:function(){return this.querySelectorAll(t)}}function c(t){return function(){return this.matches(t)}}function d(t){return function(e){return e.matches(t)}}var h=Array.prototype.find;function u(){return this.firstElementChild}var f=Array.prototype.filter;function g(){return Array.from(this.children)}function p(t){return new Array(t.length)}function y(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function m(t,e,i,n,r,a){for(var s,o=0,l=e.length,c=a.length;o<c;++o)(s=e[o])?(s.__data__=a[o],n[o]=s):i[o]=new y(t,a[o]);for(;o<l;++o)(s=e[o])&&(r[o]=s)}function v(t,e,i,n,r,a,s){var o,l,c,d=new Map,h=e.length,u=a.length,f=new Array(h);for(o=0;o<h;++o)(l=e[o])&&(f[o]=c=s.call(l,l.__data__,o,e)+"",d.has(c)?r[o]=l:d.set(c,l));for(o=0;o<u;++o)c=s.call(t,a[o],o,a)+"",(l=d.get(c))?(n[o]=l,l.__data__=a[o],d.delete(c)):i[o]=new y(t,a[o]);for(o=0;o<h;++o)(l=e[o])&&d.get(f[o])===l&&(r[o]=l)}function b(t){return t.__data__}function w(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function S(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}y.prototype={constructor:y,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var x="http://www.w3.org/1999/xhtml";const _={svg:"http://www.w3.org/2000/svg",xhtml:x,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function k(t){var e=t+="",i=e.indexOf(":");return i>=0&&"xmlns"!==(e=t.slice(0,i))&&(t=t.slice(i+1)),_.hasOwnProperty(e)?{space:_[e],local:t}:t}function O(t){return function(){this.removeAttribute(t)}}function N(t){return function(){this.removeAttributeNS(t.space,t.local)}}function E(t,e){return function(){this.setAttribute(t,e)}}function I(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function z(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttribute(t):this.setAttribute(t,i)}}function j(t,e){return function(){var i=e.apply(this,arguments);null==i?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function J(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function A(t){return function(){this.style.removeProperty(t)}}function T(t,e,i){return function(){this.style.setProperty(t,e,i)}}function C(t,e,i){return function(){var n=e.apply(this,arguments);null==n?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function B(t,e){return t.style.getPropertyValue(e)||J(t).getComputedStyle(t,null).getPropertyValue(e)}function R(t){return function(){delete this[t]}}function M(t,e){return function(){this[t]=e}}function L(t,e){return function(){var i=e.apply(this,arguments);null==i?delete this[t]:this[t]=i}}function P(t){return t.trim().split(/^|\s+/)}function F(t){return t.classList||new K(t)}function K(t){this._node=t,this._names=P(t.getAttribute("class")||"")}function G(t,e){for(var i=F(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function D(t,e){for(var i=F(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function Q(t){return function(){G(this,t)}}function U(t){return function(){D(this,t)}}function W(t,e){return function(){(e.apply(this,arguments)?G:D)(this,t)}}function V(){this.textContent=""}function H(t){return function(){this.textContent=t}}function X(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function q(){this.innerHTML=""}function Y(t){return function(){this.innerHTML=t}}function Z(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function tt(){this.nextSibling&&this.parentNode.appendChild(this)}function et(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function it(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===x&&e.documentElement.namespaceURI===x?e.createElement(t):e.createElementNS(i,t)}}function nt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function rt(t){var e=k(t);return(e.local?nt:it)(e)}function at(){return null}function st(){var t=this.parentNode;t&&t.removeChild(this)}function ot(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function lt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ct(t){return function(){var e=this.__on;if(e){for(var i,n=0,r=-1,a=e.length;n<a;++n)i=e[n],t.type&&i.type!==t.type||i.name!==t.name?e[++r]=i:this.removeEventListener(i.type,i.listener,i.options);++r?e.length=r:delete this.__on}}}function dt(t,e,i){return function(){var n,r=this.__on,a=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var s=0,o=r.length;s<o;++s)if((n=r[s]).type===t.type&&n.name===t.name)return this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=a,n.options=i),void(n.value=e);this.addEventListener(t.type,a,i),n={type:t.type,name:t.name,value:e,listener:a,options:i},r?r.push(n):this.__on=[n]}}function ht(t,e,i){var n=J(t),r=n.CustomEvent;"function"==typeof r?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function ut(t,e){return function(){return ht(this,t,e)}}function ft(t,e){return function(){return ht(this,t,e.apply(this,arguments))}}K.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var gt=[null];function pt(t,e){this._groups=t,this._parents=e}function yt(){return new pt([[document.documentElement]],gt)}pt.prototype=yt.prototype={constructor:pt,select:function(t){"function"!=typeof t&&(t=s(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a,o,l=e[r],c=l.length,d=n[r]=new Array(c),h=0;h<c;++h)(a=l[h])&&(o=t.call(a,a.__data__,h,l))&&("__data__"in a&&(o.__data__=a.__data__),d[h]=o);return new pt(n,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):l(t);for(var e=this._groups,i=e.length,n=[],r=[],a=0;a<i;++a)for(var s,o=e[a],c=o.length,d=0;d<c;++d)(s=o[d])&&(n.push(t.call(s,s.__data__,d,o)),r.push(s));return new pt(n,r)},selectChild:function(t){return this.select(null==t?u:function(t){return function(){return h.call(this.children,t)}}("function"==typeof t?t:d(t)))},selectChildren:function(t){return this.selectAll(null==t?g:function(t){return function(){return f.call(this.children,t)}}("function"==typeof t?t:d(t)))},filter:function(t){"function"!=typeof t&&(t=c(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a,s=e[r],o=s.length,l=n[r]=[],d=0;d<o;++d)(a=s[d])&&t.call(a,a.__data__,d,s)&&l.push(a);return new pt(n,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,b);var i,n=e?v:m,r=this._parents,a=this._groups;"function"!=typeof t&&(i=t,t=function(){return i});for(var s=a.length,o=new Array(s),l=new Array(s),c=new Array(s),d=0;d<s;++d){var h=r[d],u=a[d],f=u.length,g=w(t.call(h,h&&h.__data__,d,r)),p=g.length,y=l[d]=new Array(p),S=o[d]=new Array(p);n(h,u,y,S,c[d]=new Array(f),g,e);for(var x,_,k=0,O=0;k<p;++k)if(x=y[k]){for(k>=O&&(O=k+1);!(_=S[O])&&++O<p;);x._next=_||null}}return(o=new pt(o,r))._enter=l,o._exit=c,o},enter:function(){return new pt(this._enter||this._groups.map(p),this._parents)},exit:function(){return new pt(this._exit||this._groups.map(p),this._parents)},join:function(t,e,i){var n=this.enter(),r=this,a=this.exit();return"function"==typeof t?(n=t(n))&&(n=n.selection()):n=n.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==i?a.remove():i(a),n&&r?n.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,i=this._groups,n=e._groups,r=i.length,a=n.length,s=Math.min(r,a),o=new Array(r),l=0;l<s;++l)for(var c,d=i[l],h=n[l],u=d.length,f=o[l]=new Array(u),g=0;g<u;++g)(c=d[g]||h[g])&&(f[g]=c);for(;l<r;++l)o[l]=i[l];return new pt(o,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n,r=t[e],a=r.length-1,s=r[a];--a>=0;)(n=r[a])&&(s&&4^n.compareDocumentPosition(s)&&s.parentNode.insertBefore(n,s),s=n);return this},sort:function(t){function e(e,i){return e&&i?t(e.__data__,i.__data__):!e-!i}t||(t=S);for(var i=this._groups,n=i.length,r=new Array(n),a=0;a<n;++a){for(var s,o=i[a],l=o.length,c=r[a]=new Array(l),d=0;d<l;++d)(s=o[d])&&(c[d]=s);c.sort(e)}return new pt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,a=n.length;r<a;++r){var s=n[r];if(s)return s}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r,a=e[i],s=0,o=a.length;s<o;++s)(r=a[s])&&t.call(r,r.__data__,s,a);return this},attr:function(t,e){var i=k(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((null==e?i.local?N:O:"function"==typeof e?i.local?j:z:i.local?I:E)(i,e))},style:function(t,e,i){return arguments.length>1?this.each((null==e?A:"function"==typeof e?C:T)(t,e,null==i?"":i)):B(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?R:"function"==typeof e?L:M)(t,e)):this.node()[t]},classed:function(t,e){var i=P(t+"");if(arguments.length<2){for(var n=F(this.node()),r=-1,a=i.length;++r<a;)if(!n.contains(i[r]))return!1;return!0}return this.each(("function"==typeof e?W:e?Q:U)(i,e))},text:function(t){return arguments.length?this.each(null==t?V:("function"==typeof t?X:H)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?q:("function"==typeof t?Z:Y)(t)):this.node().innerHTML},raise:function(){return this.each(tt)},lower:function(){return this.each(et)},append:function(t){var e="function"==typeof t?t:rt(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var i="function"==typeof t?t:rt(t),n=null==e?at:"function"==typeof e?e:s(e);return this.select((function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)}))},remove:function(){return this.each(st)},clone:function(t){return this.select(t?lt:ot)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,i){var n,r,a=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}}))}(t+""),s=a.length;if(!(arguments.length<2)){for(o=e?dt:ct,n=0;n<s;++n)this.each(o(a[n],e,i));return this}var o=this.node().__on;if(o)for(var l,c=0,d=o.length;c<d;++c)for(n=0,l=o[c];n<s;++n)if((r=a[n]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?ft:ut)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n,r=t[e],a=0,s=r.length;a<s;++a)(n=r[a])&&(yield n)}};const mt=yt;var vt={value:()=>{}};function bt(){for(var t,e=0,i=arguments.length,n={};e<i;++e){if(!(t=arguments[e]+"")||t in n||/[\s.]/.test(t))throw new Error("illegal type: "+t);n[t]=[]}return new wt(n)}function wt(t){this._=t}function St(t,e){for(var i,n=0,r=t.length;n<r;++n)if((i=t[n]).name===e)return i.value}function xt(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=vt,t=t.slice(0,n).concat(t.slice(n+1));break}return null!=i&&t.push({name:e,value:i}),t}wt.prototype=bt.prototype={constructor:wt,on:function(t,e){var i,n,r=this._,a=(n=r,(t+"").trim().split(/^|\s+/).map((function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),s=-1,o=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(t=a[s]).type)r[i]=xt(r[i],t.name,e);else if(null==e)for(i in r)r[i]=xt(r[i],t.name,null);return this}for(;++s<o;)if((i=(t=a[s]).type)&&(i=St(r[i],t.name)))return i},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new wt(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var i,n,r=new Array(i),a=0;a<i;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,i=(n=this._[t]).length;a<i;++a)n[a].value.apply(e,r)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,a=n.length;r<a;++r)n[r].value.apply(e,i)}};const _t=bt;var kt,Ot,Nt=0,Et=0,It=0,zt=0,jt=0,Jt=0,$t="object"==typeof performance&&performance.now?performance:Date,At="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Tt(){return jt||(At(Ct),jt=$t.now()+Jt)}function Ct(){jt=0}function Bt(){this._call=this._time=this._next=null}function Rt(t,e,i){var n=new Bt;return n.restart(t,e,i),n}function Mt(){jt=(zt=$t.now())+Jt,Nt=Et=0;try{!function(){Tt(),++Nt;for(var t,e=kt;e;)(t=jt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Nt}()}finally{Nt=0,function(){for(var t,e,i=kt,n=1/0;i;)i._call?(n>i._time&&(n=i._time),t=i,i=i._next):(e=i._next,i._next=null,i=t?t._next=e:kt=e);Ot=t,Pt(n)}(),jt=0}}function Lt(){var t=$t.now(),e=t-zt;e>1e3&&(Jt-=e,zt=t)}function Pt(t){Nt||(Et&&(Et=clearTimeout(Et)),t-jt>24?(t<1/0&&(Et=setTimeout(Mt,t-$t.now()-Jt)),It&&(It=clearInterval(It))):(It||(zt=$t.now(),It=setInterval(Lt,1e3)),Nt=1,At(Mt)))}function Ft(t,e,i){var n=new Bt;return e=null==e?0:+e,n.restart((i=>{n.stop(),t(i+e)}),e,i),n}Bt.prototype=Rt.prototype={constructor:Bt,restart:function(t,e,i){if("function"!=typeof t)throw new TypeError("callback is not a function");i=(null==i?Tt():+i)+(null==e?0:+e),this._next||Ot===this||(Ot?Ot._next=this:kt=this,Ot=this),this._call=t,this._time=i,Pt()},stop:function(){this._call&&(this._call=null,this._time=1/0,Pt())}};var Kt=_t("start","end","cancel","interrupt"),Gt=[];function Dt(t,e,i,n,r,a){var s=t.__transition;if(s){if(i in s)return}else t.__transition={};!function(t,e,i){var n,r=t.__transition;function a(l){var c,d,h,u;if(1!==i.state)return o();for(c in r)if((u=r[c]).name===i.name){if(3===u.state)return Ft(a);4===u.state?(u.state=6,u.timer.stop(),u.on.call("interrupt",t,t.__data__,u.index,u.group),delete r[c]):+c<e&&(u.state=6,u.timer.stop(),u.on.call("cancel",t,t.__data__,u.index,u.group),delete r[c])}if(Ft((function(){3===i.state&&(i.state=4,i.timer.restart(s,i.delay,i.time),s(l))})),i.state=2,i.on.call("start",t,t.__data__,i.index,i.group),2===i.state){for(i.state=3,n=new Array(h=i.tween.length),c=0,d=-1;c<h;++c)(u=i.tween[c].value.call(t,t.__data__,i.index,i.group))&&(n[++d]=u);n.length=d+1}}function s(e){for(var r=e<i.duration?i.ease.call(null,e/i.duration):(i.timer.restart(o),i.state=5,1),a=-1,s=n.length;++a<s;)n[a].call(t,r);5===i.state&&(i.on.call("end",t,t.__data__,i.index,i.group),o())}function o(){for(var n in i.state=6,i.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=i,i.timer=Rt((function(t){i.state=1,i.timer.restart(a,i.delay,i.time),i.delay<=t&&a(t-i.delay)}),0,i.time)}(t,i,{name:e,index:n,group:r,on:Kt,tween:Gt,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function Qt(t,e){var i=Wt(t,e);if(i.state>0)throw new Error("too late; already scheduled");return i}function Ut(t,e){var i=Wt(t,e);if(i.state>3)throw new Error("too late; already running");return i}function Wt(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function Vt(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var Ht,Xt=180/Math.PI,qt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Yt(t,e,i,n,r,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(o=Math.sqrt(i*i+n*n))&&(i/=o,n/=o,l/=o),t*n<e*i&&(t=-t,e=-e,l=-l,s=-s),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*Xt,skewX:Math.atan(l)*Xt,scaleX:s,scaleY:o}}function Zt(t,e,i,n){function r(t){return t.length?t.pop()+" ":""}return function(a,s){var o=[],l=[];return a=t(a),s=t(s),function(t,n,r,a,s,o){if(t!==r||n!==a){var l=s.push("translate(",null,e,null,i);o.push({i:l-4,x:Vt(t,r)},{i:l-2,x:Vt(n,a)})}else(r||a)&&s.push("translate("+r+e+a+i)}(a.translateX,a.translateY,s.translateX,s.translateY,o,l),function(t,e,i,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:i.push(r(i)+"rotate(",null,n)-2,x:Vt(t,e)})):e&&i.push(r(i)+"rotate("+e+n)}(a.rotate,s.rotate,o,l),function(t,e,i,a){t!==e?a.push({i:i.push(r(i)+"skewX(",null,n)-2,x:Vt(t,e)}):e&&i.push(r(i)+"skewX("+e+n)}(a.skewX,s.skewX,o,l),function(t,e,i,n,a,s){if(t!==i||e!==n){var o=a.push(r(a)+"scale(",null,",",null,")");s.push({i:o-4,x:Vt(t,i)},{i:o-2,x:Vt(e,n)})}else 1===i&&1===n||a.push(r(a)+"scale("+i+","+n+")")}(a.scaleX,a.scaleY,s.scaleX,s.scaleY,o,l),a=s=null,function(t){for(var e,i=-1,n=l.length;++i<n;)o[(e=l[i]).i]=e.x(t);return o.join("")}}}var te=Zt((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?qt:Yt(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),ee=Zt((function(t){return null==t?qt:(Ht||(Ht=document.createElementNS("http://www.w3.org/2000/svg","g")),Ht.setAttribute("transform",t),(t=Ht.transform.baseVal.consolidate())?Yt((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):qt)}),", ",")",")");function ie(t,e){var i,n;return function(){var r=Ut(this,t),a=r.tween;if(a!==i)for(var s=0,o=(n=i=a).length;s<o;++s)if(n[s].name===e){(n=n.slice()).splice(s,1);break}r.tween=n}}function ne(t,e,i){var n,r;if("function"!=typeof i)throw new Error;return function(){var a=Ut(this,t),s=a.tween;if(s!==n){r=(n=s).slice();for(var o={name:e,value:i},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=o;break}l===c&&r.push(o)}a.tween=r}}function re(t,e,i){var n=t._id;return t.each((function(){var t=Ut(this,n);(t.value||(t.value={}))[e]=i.apply(this,arguments)})),function(t){return Wt(t,n).value[e]}}function ae(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function se(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function oe(){}var le=.7,ce=1/le,de="\\s*([+-]?\\d+)\\s*",he="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ue="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",fe=/^#([0-9a-f]{3,8})$/,ge=new RegExp(`^rgb\\(${de},${de},${de}\\)$`),pe=new RegExp(`^rgb\\(${ue},${ue},${ue}\\)$`),ye=new RegExp(`^rgba\\(${de},${de},${de},${he}\\)$`),me=new RegExp(`^rgba\\(${ue},${ue},${ue},${he}\\)$`),ve=new RegExp(`^hsl\\(${he},${ue},${ue}\\)$`),be=new RegExp(`^hsla\\(${he},${ue},${ue},${he}\\)$`),we={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Se(){return this.rgb().formatHex()}function xe(){return this.rgb().formatRgb()}function _e(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=fe.exec(t))?(i=e[1].length,e=parseInt(e[1],16),6===i?ke(e):3===i?new Ee(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===i?Oe(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===i?Oe(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=ge.exec(t))?new Ee(e[1],e[2],e[3],1):(e=pe.exec(t))?new Ee(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=ye.exec(t))?Oe(e[1],e[2],e[3],e[4]):(e=me.exec(t))?Oe(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=ve.exec(t))?Ae(e[1],e[2]/100,e[3]/100,1):(e=be.exec(t))?Ae(e[1],e[2]/100,e[3]/100,e[4]):we.hasOwnProperty(t)?ke(we[t]):"transparent"===t?new Ee(NaN,NaN,NaN,0):null}function ke(t){return new Ee(t>>16&255,t>>8&255,255&t,1)}function Oe(t,e,i,n){return n<=0&&(t=e=i=NaN),new Ee(t,e,i,n)}function Ne(t,e,i,n){return 1===arguments.length?((r=t)instanceof oe||(r=_e(r)),r?new Ee((r=r.rgb()).r,r.g,r.b,r.opacity):new Ee):new Ee(t,e,i,null==n?1:n);var r}function Ee(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}function Ie(){return`#${$e(this.r)}${$e(this.g)}${$e(this.b)}`}function ze(){const t=je(this.opacity);return`${1===t?"rgb(":"rgba("}${Je(this.r)}, ${Je(this.g)}, ${Je(this.b)}${1===t?")":`, ${t})`}`}function je(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Je(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function $e(t){return((t=Je(t))<16?"0":"")+t.toString(16)}function Ae(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Ce(t,e,i,n)}function Te(t){if(t instanceof Ce)return new Ce(t.h,t.s,t.l,t.opacity);if(t instanceof oe||(t=_e(t)),!t)return new Ce;if(t instanceof Ce)return t;var e=(t=t.rgb()).r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),a=Math.max(e,i,n),s=NaN,o=a-r,l=(a+r)/2;return o?(s=e===a?(i-n)/o+6*(i<n):i===a?(n-e)/o+2:(e-i)/o+4,o/=l<.5?a+r:2-a-r,s*=60):o=l>0&&l<1?0:s,new Ce(s,o,l,t.opacity)}function Ce(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}function Be(t){return(t=(t||0)%360)<0?t+360:t}function Re(t){return Math.max(0,Math.min(1,t||0))}function Me(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}function Le(t,e,i,n,r){var a=t*t,s=a*t;return((1-3*t+3*a-s)*e+(4-6*a+3*s)*i+(1+3*t+3*a-3*s)*n+s*r)/6}ae(oe,_e,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Se,formatHex:Se,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Te(this).formatHsl()},formatRgb:xe,toString:xe}),ae(Ee,Ne,se(oe,{brighter(t){return t=null==t?ce:Math.pow(ce,t),new Ee(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?le:Math.pow(le,t),new Ee(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ee(Je(this.r),Je(this.g),Je(this.b),je(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ie,formatHex:Ie,formatHex8:function(){return`#${$e(this.r)}${$e(this.g)}${$e(this.b)}${$e(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:ze,toString:ze})),ae(Ce,(function(t,e,i,n){return 1===arguments.length?Te(t):new Ce(t,e,i,null==n?1:n)}),se(oe,{brighter(t){return t=null==t?ce:Math.pow(ce,t),new Ce(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?le:Math.pow(le,t),new Ce(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new Ee(Me(t>=240?t-240:t+120,r,n),Me(t,r,n),Me(t<120?t+240:t-120,r,n),this.opacity)},clamp(){return new Ce(Be(this.h),Re(this.s),Re(this.l),je(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=je(this.opacity);return`${1===t?"hsl(":"hsla("}${Be(this.h)}, ${100*Re(this.s)}%, ${100*Re(this.l)}%${1===t?")":`, ${t})`}`}}));const Pe=t=>()=>t;function Fe(t,e){var i=e-t;return i?function(t,e){return function(i){return t+i*e}}(t,i):Pe(isNaN(t)?e:t)}const Ke=function t(e){var i=function(t){return 1==(t=+t)?Fe:function(e,i){return i-e?function(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}(e,i,t):Pe(isNaN(e)?i:e)}}(e);function n(t,e){var n=i((t=Ne(t)).r,(e=Ne(e)).r),r=i(t.g,e.g),a=i(t.b,e.b),s=Fe(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=a(e),t.opacity=s(e),t+""}}return n.gamma=t,n}(1);function Ge(t){return function(e){var i,n,r=e.length,a=new Array(r),s=new Array(r),o=new Array(r);for(i=0;i<r;++i)n=Ne(e[i]),a[i]=n.r||0,s[i]=n.g||0,o[i]=n.b||0;return a=t(a),s=t(s),o=t(o),n.opacity=1,function(t){return n.r=a(t),n.g=s(t),n.b=o(t),n+""}}}Ge((function(t){var e=t.length-1;return function(i){var n=i<=0?i=0:i>=1?(i=1,e-1):Math.floor(i*e),r=t[n],a=t[n+1],s=n>0?t[n-1]:2*r-a,o=n<e-1?t[n+2]:2*a-r;return Le((i-n/e)*e,s,r,a,o)}})),Ge((function(t){var e=t.length;return function(i){var n=Math.floor(((i%=1)<0?++i:i)*e),r=t[(n+e-1)%e],a=t[n%e],s=t[(n+1)%e],o=t[(n+2)%e];return Le((i-n/e)*e,r,a,s,o)}}));var De=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Qe=new RegExp(De.source,"g");function Ue(t,e){var i,n,r,a=De.lastIndex=Qe.lastIndex=0,s=-1,o=[],l=[];for(t+="",e+="";(i=De.exec(t))&&(n=Qe.exec(e));)(r=n.index)>a&&(r=e.slice(a,r),o[s]?o[s]+=r:o[++s]=r),(i=i[0])===(n=n[0])?o[s]?o[s]+=n:o[++s]=n:(o[++s]=null,l.push({i:s,x:Vt(i,n)})),a=Qe.lastIndex;return a<e.length&&(r=e.slice(a),o[s]?o[s]+=r:o[++s]=r),o.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var i,n=0;n<e;++n)o[(i=l[n]).i]=i.x(t);return o.join("")})}function We(t,e){var i;return("number"==typeof e?Vt:e instanceof _e?Ke:(i=_e(e))?(e=i,Ke):Ue)(t,e)}function Ve(t){return function(){this.removeAttribute(t)}}function He(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Xe(t,e,i){var n,r,a=i+"";return function(){var s=this.getAttribute(t);return s===a?null:s===n?r:r=e(n=s,i)}}function qe(t,e,i){var n,r,a=i+"";return function(){var s=this.getAttributeNS(t.space,t.local);return s===a?null:s===n?r:r=e(n=s,i)}}function Ye(t,e,i){var n,r,a;return function(){var s,o,l=i(this);if(null!=l)return(s=this.getAttribute(t))===(o=l+"")?null:s===n&&o===r?a:(r=o,a=e(n=s,l));this.removeAttribute(t)}}function Ze(t,e,i){var n,r,a;return function(){var s,o,l=i(this);if(null!=l)return(s=this.getAttributeNS(t.space,t.local))===(o=l+"")?null:s===n&&o===r?a:(r=o,a=e(n=s,l));this.removeAttributeNS(t.space,t.local)}}function ti(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&function(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}(t,r)),i}return r._value=e,r}function ei(t,e){var i,n;function r(){var r=e.apply(this,arguments);return r!==n&&(i=(n=r)&&function(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}(t,r)),i}return r._value=e,r}function ii(t,e){return function(){Qt(this,t).delay=+e.apply(this,arguments)}}function ni(t,e){return e=+e,function(){Qt(this,t).delay=e}}function ri(t,e){return function(){Ut(this,t).duration=+e.apply(this,arguments)}}function ai(t,e){return e=+e,function(){Ut(this,t).duration=e}}var si=mt.prototype.constructor;function oi(t){return function(){this.style.removeProperty(t)}}var li=0;function ci(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function di(){return++li}var hi=mt.prototype;ci.prototype=function(t){return mt().transition(t)}.prototype={constructor:ci,select:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=s(t));for(var n=this._groups,r=n.length,a=new Array(r),o=0;o<r;++o)for(var l,c,d=n[o],h=d.length,u=a[o]=new Array(h),f=0;f<h;++f)(l=d[f])&&(c=t.call(l,l.__data__,f,d))&&("__data__"in l&&(c.__data__=l.__data__),u[f]=c,Dt(u[f],e,i,f,u,Wt(l,i)));return new ci(a,this._parents,e,i)},selectAll:function(t){var e=this._name,i=this._id;"function"!=typeof t&&(t=l(t));for(var n=this._groups,r=n.length,a=[],s=[],o=0;o<r;++o)for(var c,d=n[o],h=d.length,u=0;u<h;++u)if(c=d[u]){for(var f,g=t.call(c,c.__data__,u,d),p=Wt(c,i),y=0,m=g.length;y<m;++y)(f=g[y])&&Dt(f,e,i,y,g,p);a.push(g),s.push(c)}return new ci(a,s,e,i)},selectChild:hi.selectChild,selectChildren:hi.selectChildren,filter:function(t){"function"!=typeof t&&(t=c(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a,s=e[r],o=s.length,l=n[r]=[],d=0;d<o;++d)(a=s[d])&&t.call(a,a.__data__,d,s)&&l.push(a);return new ci(n,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),s=new Array(n),o=0;o<a;++o)for(var l,c=e[o],d=i[o],h=c.length,u=s[o]=new Array(h),f=0;f<h;++f)(l=c[f]||d[f])&&(u[f]=l);for(;o<n;++o)s[o]=e[o];return new ci(s,this._parents,this._name,this._id)},selection:function(){return new si(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,i=di(),n=this._groups,r=n.length,a=0;a<r;++a)for(var s,o=n[a],l=o.length,c=0;c<l;++c)if(s=o[c]){var d=Wt(s,e);Dt(s,t,i,c,o,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new ci(n,this._parents,t,i)},call:hi.call,nodes:hi.nodes,node:hi.node,size:hi.size,empty:hi.empty,each:hi.each,on:function(t,e){var i=this._id;return arguments.length<2?Wt(this.node(),i).on.on(t):this.each(function(t,e,i){var n,r,a=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Qt:Ut;return function(){var s=a(this,t),o=s.on;o!==n&&(r=(n=o).copy()).on(e,i),s.on=r}}(i,t,e))},attr:function(t,e){var i=k(t),n="transform"===i?ee:We;return this.attrTween(t,"function"==typeof e?(i.local?Ze:Ye)(i,n,re(this,"attr."+t,e)):null==e?(i.local?He:Ve)(i):(i.local?qe:Xe)(i,n,e))},attrTween:function(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;var n=k(t);return this.tween(i,(n.local?ti:ei)(n,e))},style:function(t,e,i){var n="transform"==(t+="")?te:We;return null==e?this.styleTween(t,function(t,e){var i,n,r;return function(){var a=B(this,t),s=(this.style.removeProperty(t),B(this,t));return a===s?null:a===i&&s===n?r:r=e(i=a,n=s)}}(t,n)).on("end.style."+t,oi(t)):"function"==typeof e?this.styleTween(t,function(t,e,i){var n,r,a;return function(){var s=B(this,t),o=i(this),l=o+"";return null==o&&(this.style.removeProperty(t),l=o=B(this,t)),s===l?null:s===n&&l===r?a:(r=l,a=e(n=s,o))}}(t,n,re(this,"style."+t,e))).each(function(t,e){var i,n,r,a,s="style."+e,o="end."+s;return function(){var l=Ut(this,t),c=l.on,d=null==l.value[s]?a||(a=oi(e)):void 0;c===i&&r===d||(n=(i=c).copy()).on(o,r=d),l.on=n}}(this._id,t)):this.styleTween(t,function(t,e,i){var n,r,a=i+"";return function(){var s=B(this,t);return s===a?null:s===n?r:r=e(n=s,i)}}(t,n,e),i).on("end.style."+t,null)},styleTween:function(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;return this.tween(n,function(t,e,i){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&function(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}(t,a,i)),n}return a._value=e,a}(t,e,null==i?"":i))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(re(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,i;function n(){var n=t.apply(this,arguments);return n!==i&&(e=(i=n)&&function(t){return function(e){this.textContent=t.call(this,e)}}(n)),e}return n._value=t,n}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n,r=Wt(this.node(),i).tween,a=0,s=r.length;a<s;++a)if((n=r[a]).name===t)return n.value;return null}return this.each((null==e?ie:ne)(i,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ii:ni)(e,t)):Wt(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?ri:ai)(e,t)):Wt(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Ut(this,t).ease=e}}(e,t)):Wt(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var i=e.apply(this,arguments);if("function"!=typeof i)throw new Error;Ut(this,t).ease=i}}(this._id,t))},end:function(){var t,e,i=this,n=i._id,r=i.size();return new Promise((function(a,s){var o={value:s},l={value:function(){0==--r&&a()}};i.each((function(){var i=Ut(this,n),r=i.on;r!==t&&((e=(t=r).copy())._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),i.on=e})),0===r&&a()}))},[Symbol.iterator]:hi[Symbol.iterator]};var ui={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function fi(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}mt.prototype.interrupt=function(t){return this.each((function(){!function(t,e){var i,n,r,a=t.__transition,s=!0;if(a){for(r in e=null==e?null:e+"",a)(i=a[r]).name===e?(n=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(n?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete a[r]):s=!1;s&&delete t.__transition}}(this,t)}))},mt.prototype.transition=function(t){var e,i;t instanceof ci?(e=t._id,t=t._name):(e=di(),(i=ui).time=Tt(),t=null==t?null:t+"");for(var n=this._groups,r=n.length,a=0;a<r;++a)for(var s,o=n[a],l=o.length,c=0;c<l;++c)(s=o[c])&&Dt(s,t,e,c,o,i||fi(s,e));return new ci(n,this._parents,t,e)};const{abs:gi,max:pi,min:yi}=Math;function mi(t){return{type:t}}function vi(t){return function(){return t}}function bi(t){this._context=t}function wi(t){return new bi(t)}["w","e"].map(mi),["n","s"].map(mi),["n","w","e","s","nw","ne","sw","se"].map(mi),Array.prototype.slice,bi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};const Si=Math.PI,xi=2*Si,_i=1e-6,ki=xi-_i;function Oi(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=arguments[e]+t[e]}class Ni{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?Oi:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return Oi;const i=10**e;return function(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=Math.round(arguments[e]*i)/i+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,i,n){this._append`Q${+t},${+e},${this._x1=+i},${this._y1=+n}`}bezierCurveTo(t,e,i,n,r,a){this._append`C${+t},${+e},${+i},${+n},${this._x1=+r},${this._y1=+a}`}arcTo(t,e,i,n,r){if(t=+t,e=+e,i=+i,n=+n,(r=+r)<0)throw new Error(`negative radius: ${r}`);let a=this._x1,s=this._y1,o=i-t,l=n-e,c=a-t,d=s-e,h=c*c+d*d;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(h>_i)if(Math.abs(d*o-l*c)>_i&&r){let u=i-a,f=n-s,g=o*o+l*l,p=u*u+f*f,y=Math.sqrt(g),m=Math.sqrt(h),v=r*Math.tan((Si-Math.acos((g+h-p)/(2*y*m)))/2),b=v/m,w=v/y;Math.abs(b-1)>_i&&this._append`L${t+b*c},${e+b*d}`,this._append`A${r},${r},0,0,${+(d*u>c*f)},${this._x1=t+w*o},${this._y1=e+w*l}`}else this._append`L${this._x1=t},${this._y1=e}`}arc(t,e,i,n,r,a){if(t=+t,e=+e,a=!!a,(i=+i)<0)throw new Error(`negative radius: ${i}`);let s=i*Math.cos(n),o=i*Math.sin(n),l=t+s,c=e+o,d=1^a,h=a?n-r:r-n;null===this._x1?this._append`M${l},${c}`:(Math.abs(this._x1-l)>_i||Math.abs(this._y1-c)>_i)&&this._append`L${l},${c}`,i&&(h<0&&(h=h%xi+xi),h>ki?this._append`A${i},${i},0,1,${d},${t-s},${e-o}A${i},${i},0,1,${d},${this._x1=l},${this._y1=c}`:h>_i&&this._append`A${i},${i},0,${+(h>=Si)},${d},${this._x1=t+i*Math.cos(r)},${this._y1=e+i*Math.sin(r)}`)}rect(t,e,i,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${i=+i}v${+n}h${-i}Z`}toString(){return this._}}function Ei(t){return t[0]}function Ii(t){return t[1]}function zi(t,e){var i=vi(!0),n=null,r=wi,a=null,s=function(t){let e=3;return t.digits=function(i){if(!arguments.length)return e;if(null==i)e=null;else{const t=Math.floor(i);if(!(t>=0))throw new RangeError(`invalid digits: ${i}`);e=t}return t},()=>new Ni(e)}(o);function o(o){var l,c,d,h=(o=function(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}(o)).length,u=!1;for(null==n&&(a=r(d=s())),l=0;l<=h;++l)!(l<h&&i(c=o[l],l,o))===u&&((u=!u)?a.lineStart():a.lineEnd()),u&&a.point(+t(c,l,o),+e(c,l,o));if(d)return a=null,d+""||null}return t="function"==typeof t?t:void 0===t?Ei:vi(t),e="function"==typeof e?e:void 0===e?Ii:vi(e),o.x=function(e){return arguments.length?(t="function"==typeof e?e:vi(+e),o):t},o.y=function(t){return arguments.length?(e="function"==typeof t?t:vi(+t),o):e},o.defined=function(t){return arguments.length?(i="function"==typeof t?t:vi(!!t),o):i},o.curve=function(t){return arguments.length?(r=t,null!=n&&(a=r(n)),o):r},o.context=function(t){return arguments.length?(null==t?n=a=null:a=r(n=t),o):n},o}function ji(t,e,i){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+i)/6)}function Ji(t){this._context=t}function $i(t){return new Ji(t)}function Ai(t,e,i){this.k=t,this.x=e,this.y=i}Ji.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:ji(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:ji(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},Ai.prototype={constructor:Ai,scale:function(t){return 1===t?this:new Ai(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Ai(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new Ai(1,0,0),Ai.prototype;const Ti={RESIZE_GROUP:"icdt-resize-g",SELECT_GROUP:"icdt-select-g",SCAN_GROUP:"icdt-scan-g",CREATE_GROUP:"icdt-create-g",INTERACTIVE_GROUP:"icdt-interactive-g",INDEX_GROUP:"icdt-index-g",BACKGROUND_GROUP:"icdt-background-g",TEST_GROUP:"icdt-test-g"},Ci={POINTER:0,HAND:1,PEN:2,SHAPE:3,FOREIGNOBJECT:6,IMAGE:7,TEXT:4,ERASER:5,INDEX:8},Bi={DRAW:1,HIGHTLIGH:2,INTERACTIVE:3},Ri={GROUP:0,CIRCLE:1,ELLIPSE:2,LINE:5,RECT:3,POLYGON:4,FOREIGNOBJECT:6,IMAGE:9,TEXT:7,TSPAN:10,PATH:8,POLYLINE:11},Mi={TRIANGLE_ISOSCELES:3,TRIANGLE_EQUILATERAL:31,RECTANGLE:4,PENTAGON:5,HEXAGON:6,BOOKMARK:101,COMMENT:102,CROSS:104,ARROW_ONEWAY:201,ARROW_TWOWAY:202,STAR_FOUR:304,STAR_FIVE:305,STAR_SIX:306},Li=[{name:"tam giác vuông",type:Mi.TRIANGLE_ISOSCELES,ratios:[[0,0],[1,1],[0,1]]},{name:"tam giác cân",type:Mi.TRIANGLE_EQUILATERAL,ratios:[[.5,0],[0,1],[1,1]]},{name:"hình chữ nhật",type:Mi.RECTANGLE,ratios:[[0,0],[1,0],[1,1],[0,1]]},{name:"hình ngũ giác đều",type:Mi.PENTAGON,ratios:[[.5,0],[1,.4],[.8,1],[.2,1],[0,.4]]},{name:"hình lục giác đều",type:Mi.HEXAGON,ratios:[[.5,0],[1,.25],[1,.75],[.5,1],[0,.75],[0,.25]]},{name:"khung đánh dấu vị trí",type:Mi.BOOKMARK,ratios:[[0,0],[1,0],[1,.8],[.5,1],[0,.8]]},{name:"khung đánh trò chuyện",type:Mi.COMMENT,ratios:[[0,0],[1,0],[1,.9],[.3,.9],[.2,1],[.1,.9],[0,.9]]},{name:"hình chữ thập",type:Mi.CROSS,ratios:[[0,.3],[.3,.3],[.3,0],[.7,0],[.7,.3],[1,.3],[1,.7],[.7,.7],[.7,1],[.3,1],[.3,.7],[0,.7]]},{name:"hình mũi tên 1 chiều",type:Mi.ARROW_ONEWAY,ratios:[[0,.2],[.8,.2],[.8,0],[1,.5],[.8,1],[.8,.8],[0,.8]]},{name:"hình mũi tên 2 chiều",type:Mi.ARROW_TWOWAY,ratios:[[.2,0],[.2,.2],[.8,.2],[.8,0],[1,.5],[.8,1],[.8,.8],[.2,.8],[.2,1],[0,.5]]},{name:"hình ngôi sao 4 cánh",type:Mi.STAR_FOUR,ratios:[[.5,0],[.65,.35],[1,.5],[.65,.65],[.5,1],[.35,.65],[0,.5],[.35,.35]]},{name:"hình ngôi sao 5 cánh",type:Mi.STAR_FIVE,ratios:[[.5,0],[.625,.4],[1,.4],[.675,.625],[.8,1],[.5,.775],[.2,1],[.325,.625],[0,.4],[.375,.4]]},{name:"hình ngôi sao 6 cánh",type:Mi.STAR_SIX,ratios:[[.5,0],[.667,.25],[1,.25],[.5+.334,.5],[1,.75],[.667,.75],[.5,1],[.334,.75],[0,.75],[.167,.5],[0,.25],[.334,.25]]}],Pi={IMAGE:1,HTML:2,AUDIO:3,VIDEO:4},Fi={TEXT:900,IMAGE:901,AUDIO:902,VIDEO:903,LINK:904,ZIP:905,HTML:906,TRACK:907,OFFICE:908,WORD:916,EXCEL:917,POWERPOINT:918,PDF:909,PHET:910,IMAGE_ANIMATION:911,SCORM:912},Ki={ONEDRIVE:1e3,GOOGLEDRIVE:1001,YOUTUBE:1002,SCORM:1003,PHET:1005,OTHER:1004},Gi={Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,Digit0:48,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,Insert:45,Delete:46,Home:36,End:35,PageUp:33,PageDown:34,ArrowUp:38,ArrowDown:40,ArrowLeft:37,ArrowRight:39,Escape:27,Tab:9,Backspace:8,Enter:13,Space:32,BracketLeft:219,BracketRight:221,Minus:189,Equal:187},Di={fill:"transparent",stroke:"#129bff",strokeWidth:1},Qi={stroke:"#0D99FF",strokeWidth:1,strokeLinecap:"square",strokeDasharrays:[2,5]},Ui={fill:"#FFFFFF",stroke:"#0D99FF",strokeWidth:1,width:7,height:7},Wi={fill:"transparent",stroke:"transparent",strokeWidth:1},Vi={fill:"none",stroke:"#2299F8",strokeWidth:1},Hi={fill:"#0D99FF",rx:4},Xi={fill:"#fff",alignmentBaseline:"central",textAnchor:"middle",fontSize:14},qi={stroke:"#129bff",strokeWidth:1,strokeLinecap:"square",strokeDasharray:8},Yi={fill:"transparent"},Zi={fill:"none",stroke:"#999",strokeWidth:1,strokeDasharray:2},tn=(t,e)=>{if(!t.length)return;let i=n=>{n&&(document.head.querySelector(`:scope > style[rel="${n}"]`)||document.head.querySelector(`:scope > link[name="${n}"]`)?i(t.shift()):en([n],e).then((e=>{let r=window.document.createElement("style");r.setAttribute("rel",n),r.textContent=e,window.document.head.appendChild(r),i(t.shift())})))};i(t.shift())},en=async(t,e)=>{let i=`\n/*!\n * Tabca v1.0.0 (https://tabca.vn)\n * Copyright 2024, Created by Middle Kien. All rights reserved.\n *\n * Tabca commercial licenses may be obtained at https://tabca.vn\n *\n * If you do not own a commercial license, this file shall be governed by the trial license terms.\n * ${t}\n */\n`;var n=[];return t.map((t=>{let i=t.replace(/\s+/g,""),r=t.replace(/[^a-zA-Z0-9]/g,"");n=[...n,new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Regular.ttf`;fetch(s).then((e=>{e.ok?n(`/*normal*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Regular'),\n                                            local('${i}-Regular'),\n                                            url('${s}') format('truetype');\n                                        font-weight: normal;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }\n                                    `.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Italic.ttf`;fetch(s).then((e=>{e.ok?n(`/*italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Italic'),\n                                            local('${i}-Italic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: normal;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }\n                                    `.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Bold.ttf`;fetch(s).then((e=>{e.ok?n(`/*bold*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Bold'),\n                                            local('${i}-Bold'),\n                                            url('${s}') format('truetype');\n                                        font-weight: bold;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-BoldItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*bold italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Bold Italic'),\n                                            local('${i}-BoldItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: bold;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Thin.ttf`;fetch(s).then((e=>{e.ok?n(`/*100*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Thin'),\n                                            local('${i}-Thin'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 100;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-ThinItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*100 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Thin Italic'),\n                                            local('${i}-ThinItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 100;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-ExtraLight.ttf`;fetch(s).then((e=>{e.ok?n(`/*200*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} ExtraLight'),\n                                            local('${i}-ExtraLight'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 200;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-ExtraLightItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*200 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} ExtraLight Italic'),\n                                            local('${i}-ExtraLightItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 200;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-UltraLight.ttf`;fetch(s).then((e=>{e.ok?n(`/*200*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} UltraLight'),\n                                            local('${i}-UltraLight'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 200;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-UltraLightItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*200 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} UltraLight Italic'),\n                                            local('${i}-UltraLightItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 200;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Light.ttf`;fetch(s).then((e=>{e.ok?n(`/*300*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Light'),\n                                            local('${i}-Light'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 300;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-LightItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*300 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Light Italic'),\n                                            local('${i}-LightItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 300;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Regular.ttf`;fetch(s).then((e=>{e.ok?n(`/*400*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Regular'),\n                                            local('${i}-Regular'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 400;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Normal.ttf`;fetch(s).then((e=>{e.ok?n(`/*400*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Normal'),\n                                            local('${i}-Normal'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 400;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Italic.ttf`;fetch(s).then((e=>{e.ok?n(`/*400 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Italic'),\n                                            local('${i}-Italic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 400;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Medium.ttf`;fetch(s).then((e=>{e.ok?n(`/*500*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Medium'),\n                                            local('${i}-Medium'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 500;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-MediumItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*500 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Medium Italic'),\n                                            local('${i}-MediumItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 500;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-SemiBold.ttf`;fetch(s).then((e=>{e.ok?n(`/*600*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} SemiBold'),\n                                            local('${i}-SemiBold'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 600;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-SemiBoldItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*600 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} SemiBold Italic'),\n                                            local('${i}-SemiBoldItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 600;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-DemiBold.ttf`;fetch(s).then((e=>{e.ok?n(`/*600*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} DemiBold'),\n                                            local('${i}-DemiBold'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 600;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-DemiBoldItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*600 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} DemiBold Italic'),\n                                            local('${i}-DemiBoldItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 600;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Bold.ttf`;fetch(s).then((e=>{e.ok?n(`/*700*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Bold'),\n                                            local('${i}-Bold'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 700;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-BoldItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*700 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Bold Italic'),\n                                            local('${i}-BoldItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 700;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-ExtraBold.ttf`;fetch(s).then((e=>{e.ok?n(`/*800*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} ExtraBold'),\n                                            local('${i}-ExtraBold'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 800;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-ExtraBoldItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*800 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} ExtraBold Italic'),\n                                            local('${i}-ExtraBoldItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 800;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-UltraBold.ttf`;fetch(s).then((e=>{e.ok?n(`/*800*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} UltraBold'),\n                                            local('${i}-UltraBold'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 800;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-UltraBoldItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*800 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} UltraBold Italic'),\n                                            local('${i}-UltraBoldItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 800;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Black.ttf`;fetch(s).then((e=>{e.ok?n(`/*900*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Black'),\n                                            local('${i}-Black'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 900;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-BlackItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*900 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Black Italic'),\n                                            local('${i}-BlackItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 900;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-Heavy.ttf`;fetch(s).then((e=>{e.ok?n(`/*900*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Heavy'),\n                                            local('${i}-Heavy'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 900;\n                                        font-style: normal;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))})),new Promise(((n,a)=>{let s=`${e}/${r}/${r}-HeavyItalic.ttf`;fetch(s).then((e=>{e.ok?n(`/*900 italic*/\n                                    @font-face {\n                                        font-family: '${t}';\n                                        src: local('${t} Heavy Italic'),\n                                            local('${i}-HeavyItalic'),\n                                            url('${s}') format('truetype');\n                                        font-weight: 900;\n                                        font-style: italic;\n                                        font-display: swap;\n                                    }`.replace(/\t|\n|\s\s+/g,"").replace(/:\s/g,":")):n(null)})).catch((()=>{n(null)}))}))]})),Promise.all(n).then((t=>i+t.filter((t=>t)).join("\n")))},nn=t=>{var e={};let i=/Italic$/,n=/Thin$/,r=/ExtraLight|UltraLight$/i,a=/Light$/,s=/Regular|Normal$/,o=/Medium$/,l=/SemiBold|DemiBold$/i,c=/Bold$/,d=/ExtraBold|UltraBold$/i,h=/Black|Heavy$/;return(t=t.split(",")?.shift()?.trim().replace(/[^a-zA-Z_-\s]/g,"")??"").match(i)&&(e.fontStyle="italic",t=t.replace(i,"").trim()),t.match(n)?(e.fontWeight=100,t=t.replace(n,"").trim()):t.match(r)?(e.fontWeight=200,t=t.replace(r,"").trim()):t.match(a)?(e.fontWeight=300,t=t.replace(a,"").trim()):t.match(s)?(e.fontWeight=400,t=t.replace(s,"").trim()):t.match(o)?(e.fontWeight=500,t=t.replace(o,"").trim()):t.match(l)?(e.fontWeight=600,t=t.replace(l,"").trim()):t.match(c)?(e.fontWeight=700,t=t.replace(c,"").trim()):t.match(d)?(e.fontWeight=800,t=t.replace(d,"").trim()):t.match(h)&&(e.fontWeight=900,t=t.replace(h,"").trim()),e.fontFamily=t.replace(/[\-\_\s]+$/,""),e},rn=t=>{let e=[];return[/font-family\s*:\s*([^;]+);/g,/"fontFamily":"([a-zA-Z0-9\-\_\'\s]+)"/g].forEach((i=>{e=[...e,...t.replace(/&quot;/g,"'").match(i)?.filter(((t,e,i)=>i.indexOf(t)==e)).map((t=>t.replace(i,"$1").replace(/[^a-zA-Z0-9\-\_\s\,]/g,"").trim())).filter(((t,e,i)=>t&&i.indexOf(t)==e))??[]]})),e.filter(((t,e,i)=>i.indexOf(t)==e)).map((t=>nn(t).fontFamily)).filter((t=>!!t)).filter(((t,e,i)=>i.indexOf(t)==e))},an=(t,e)=>{if(!t)return"";let i=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),n=(i&&i[4]||"").trim(),r=i?(256|i[1]).toString(16).slice(1)+(256|i[2]).toString(16).slice(1)+(256|i[3]).toString(16).slice(1):t;if("0"==n)return"transparent";if(e){let t;t=""!==n?n:"01",t=(255*t|256).toString(16).slice(1),r+=t}return`#${r}`};var sn=/^#?[a-fA-F0-9]+$/;const on=(t,e)=>{if("none"==(t=t??""))return"none";if("transparent"==t)return"rgba(0,0,0,0)";if(t.includes("rgba("))return t;if(t.includes("rgb(")&&(t=an(t)),!(t=t.replace(/[^0-9a-fA-F]/g,"")))return"";if(!sn.test(t))return console.error(`hex2rgba -> ${t}: first argument has invalid hexadecimal characters`),"";if("#"===t[0]&&(t=t.slice(1)),3===t.length){let e=t.split("");e.splice(2,0,t[2]),e.splice(1,0,t[1]),e.splice(0,0,t[0]),t=e.join("")}if(6!==t.length)return console.error("hex2rgba: first argument has invalid hexadecimal length"),"";var i=[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)];return(e="number"==typeof e?e:parseFloat(e))>=0&&e<=1?i.push(e):i.push(1),"rgba("+i.join(",")+")"},ln=t=>{switch(t?.type){case Fi.IMAGE:return"www.tabca.vn"==location.hostname?`assets/iframe/lib/mk-image-viewer/viewer.html?url=${encodeURIComponent(t.readfileuploadurl+""+t.path)}`:""+t.readfileuploadurl+t.path;case Fi.AUDIO:return"www.tabca.vn"==location.hostname?`assets/iframe/lib/mk-audio-player-2/player.html?url=${encodeURIComponent(t.readfileuploadurl+""+t.path)}`:""+t.readfileuploadurl+t.path;case Fi.VIDEO:return"www.tabca.vn"==location.hostname?`assets/iframe/lib/mk-video-player/player.html?url=${encodeURIComponent(t.readfileuploadurl+""+t.path)}`:""+t.readfileuploadurl+t.path;case Fi.OFFICE:case Fi.WORD:case Fi.EXCEL:case Fi.POWERPOINT:return"www.tabca.vn"==location.hostname?`assets/iframe/lib/ONLYOFFICE/player.html?url=${encodeURIComponent(t.readfileuploadurl+""+t.path)}`:""+t.readfileuploadurl+t.path;case Fi.PDF:return"www.tabca.vn"==location.hostname?"assets/iframe/lib/PDFReader/web/viewer.html?file="+t.readfileuploadurl+t.path:""+t.readfileuploadurl+t.path;case Fi.HTML:case Fi.IMAGE_ANIMATION:case Fi.PHET:return""+t.readfileuploadurl+t.path;case Fi.ZIP:case Fi.SCORM:return"imsmanifest.xml"==t.path?.split("/")?.pop()?"assets/iframe/lib/ScormPool_Player/player.html?url="+t.readfileuploadurl+t.path:""+t.readfileuploadurl+t.path;case Fi.TRACK:case Fi.TEXT:return""+t.readfileuploadurl+t.path;case Fi.LINK:switch(t.oss){case Ki.SCORM:return"assets/iframe/lib/ScormPool_Player/player.html?url="+t.url;case Ki.YOUTUBE:return cn(t.url)??"";case Ki.PHET:default:return t.url??""}default:return""+t.readfileuploadurl+t.path}},cn=t=>{let e=dn(t);return e?"https://www.youtube.com/embed/"+e+"?"+jQuery.param({wmode:"opaque",border:0,hd:1,autoplay:!1,autohide:1,enablejsapi:1,modestbranding:1,version:3,hl:"vi_VN",rel:0,showinfo:0,iv_load_policy:3}):null},dn=t=>{let e=t?.match(/(?:.+?)?(?:\/v\/|watch\/|\?v\=|\&v\=|youtu\.be\/|\/v\=|^youtu\.be\/|embed\/)([a-zA-Z0-9_-]{11})+/);return e&&e.length>=2?e[1]:null},hn=(t,e)=>(e=e??100,Math.round((t+Number.EPSILON)*e)/e),un=t=>hn(t/ls.screen.scale),fn=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{fill:ls.attribute.fill,stroke:ls.attribute.stroke,strokeWidth:ls.attribute.strokeWidth};return{nodeId:t,element:mr(t,Ri.RECT,"rect",{size:n,attribute:r},i),size:n,attribute:r}},gn=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{preserveAspectRatio:"none"},a=e?.source||{type:"image",image:{url:"../../assets/image-svg/logo.svg",path:"assets/image-svg/logo.svg",name:"logo.svg"}};return{nodeId:t,element:mr(t,Ri.IMAGE,"image",{size:n,attribute:r,source:a},i),size:n,attribute:r,source:a}},pn=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{fill:ls.attribute.fill,stroke:ls.attribute.stroke,strokeWidth:ls.attribute.strokeWidth};return{nodeId:t,element:mr(t,Ri.CIRCLE,"circle",{size:n,attribute:r},i),size:n,attribute:r}},yn=(t,e,i)=>{if(!e.value)return void i();let n=jQuery("#"+t).parents("g");if(!n.length)return void i();let{size:r}=e.node;n.css("transform-origin",`${r.x+r.width/2}px ${r.y+r.height/2}px`);let a="",s=e.iteration??0,o=[];(e.value||"").match(/animation((-[a-zA-Z0-9]+)+)?(\s+||\")/gm)?o.push(e.value):e.value?["top-left","top","top-right","left","right","bottom-left","bottom","bottom-right"].includes(e.value)?(o.push("animation"),o.push(`animation-${e.value}`)):(o.push("animate__animated"),o.push(`animate__${e.value}`)):(o.push("animation"),o.push("animation-fadein")),s<0?(o.push("animation-iteration-infinite"),i(),i=function(){}):s>0&&o.push("animation-iteration-"+(s+1)),a=o.join(" "),function(t){let e=function(){n.data("animate-running")?n.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",(function(){n.data("animate-running",!1),setTimeout((function(){t()}),100)})):t()};n.hasClass("animation")?setTimeout((function(){e()})):e()}((function(){mn(t),(s>0||s<0)&&n.one("animationiteration",(function(){e.slideStatus===hr.slideStatus||(n.data("animate-running",!1),mn(t),e.slideStatus===hr.slideStatus&&i())})),n.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",(function(){switch(n.data("animate-running",!1),mn(t),e.finish){default:case 0:case 1:break;case 2:yn(t,{node:e.node,value:e.node.animate?.out,nodeStatus:e.nodeStatus,slideStatus:e.slideStatus},(()=>{n.addClass("hide")}))}e.slideStatus===hr.slideStatus&&i()})),n.attr("data-class",n.attr("class")??""),n.addClass(a),n.data("animate-running",!0)}))},mn=function(t){var e=jQuery("#"+t).parents("g"),i=e.attr("class")?.match(/animation((-[a-zA-Z0-9]+)+)?(\s+||\")/gm),n=e.attr("class")?.match(/animate((__[a-zA-Z0-9]+)+)?(\s+||\")/gm);i&&i.forEach((function(t){jQuery(e).removeClass(t)})),n&&n.forEach((function(t){jQuery(e).removeClass(t)}));let r=e.attr("data-class");r&&(e.attr("class",r),e.removeAttr("data-class")),jQuery(e).data("animation-running",!1)},vn=(t,e,i)=>{if(!e.value)return void i();let n=jQuery("#"+t).parents("g");if(!n.length)return void i();let{size:r}=e.node;n.css("transform-origin",`${r.x+r.width/2}px ${r.y+r.height/2}px`);let a="",s=e.iteration??0,o=[];(e.value||"").match(/animation((-[a-zA-Z0-9]+)+)?(\s+||\")/gm)?o.push(e.value):(o.push("animation"),e.value?o.push("animation-"+e.value):o.push("animation-fadein")),s<0?(o.push("animation-iteration-infinite"),i(),i=function(){}):s>0&&o.push("animation-iteration-"+(s+1)),a=o.join(" "),function(t){let e=function(){n.data("animate-running")?n.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",(function(){n.data("animate-running",!1),setTimeout((function(){t()}),100)})):t()};n.hasClass("animation")?setTimeout((function(){e()})):e()}((function(){bn(t),(s>0||s<0)&&n.one("animationiteration",(function(){e.slideStatus===hr.slideStatus||(n.data("animate-running",!1),bn(t),e.slideStatus===hr.slideStatus&&i())})),n.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",(function(){switch(n.data("animate-running",!1),bn(t),e.finish){default:case 0:case 1:break;case 2:yn(t,{node:e.node,value:e.node.animate?.out,nodeStatus:e.nodeStatus,slideStatus:e.slideStatus},(()=>{n.addClass("hide")}))}e.slideStatus===hr.slideStatus&&i()})),n.attr("data-class",n.attr("class")??""),n.addClass(a),n.data("animate-running",!0)}))},bn=function(t){var e=jQuery("#"+t).parents("g"),i=e.attr("class")?.match(/animation((-[a-zA-Z0-9]+)+)?(\s+||\")/gm);i&&i.forEach((function(t){jQuery(e).removeClass(t)}));let n=e.attr("data-class");n&&(e.attr("class",n),e.removeAttr("data-class")),jQuery(e).data("animation-running",!1)},wn=t=>t.split(/(?=[MLCSQTAHVZmlcsqtahvz])/)?.map((t=>{let e={type:t.substring(0,1)},i=(n=t.replace(/\s?\-?[0-9\.]+e-[0-9]+/g," 0").replace(/\,/g," ").replace(/\s?\-/g," -").replace(/(\.[0-9]+)(\.[0-9]+)/g,"$1 0$2").replace(/\-\./g,"-0.").replace(/[^0-9\.\-]/g," ").replace(/\s+/g," ").trim())?n.split(/\s/).map((t=>hn(parseFloat(t),1e6))):[];var n;return i.length&&(e.points=i),e})),Sn=t=>{let e=[],i=[],n=[],r=[];return t.forEach((t=>{switch(["M","L","C","S","Q","T"].includes(t.type)&&t.points&&t.points.forEach(((t,n)=>{n%2==0?e.push(t):i.push(t)})),t.type){case"A":7==t.points?.length&&(n.push(t.points[5]),r.push(t.points[6]));break;case"H":t.points?.length&&(e.push(t.points[0]),n.push(t.points[0]));break;case"V":t.points?.length&&(i.push(t.points[0]),r.push(t.points[0]));break;case"a":if(7==t.points?.length){let a=e[e.length-1];e.push(a+t.points[5]),n.push(a+t.points[5]);let s=i[i.length-1];i.push(s+t.points[6]),r.push(s+t.points[6])}break;case"h":if(t.points?.length){let i=e[e.length-1];e.push(i+t.points[0]),n.push(i+t.points[0])}break;case"v":if(t.points?.length){let e=i[i.length-1];i.push(e+t.points[0]),r.push(e+t.points[0])}break;case"M":case"L":case"C":case"S":case"Q":case"T":t.points?.forEach(((t,e)=>{e%2==0?n.push(t):r.push(t)}));break;case"m":case"l":case"c":case"s":case"q":case"t":t.points?.forEach(((t,a)=>{if(a%2==0){let i=e[e.length-1];e.push(i+t),n.push(i+t)}else{let e=i[i.length-1];i.push(e+t),r.push(e+t)}}))}})),{minX:Math.min.apply(null,n),minY:Math.min.apply(null,r),maxX:Math.max.apply(null,n),maxY:Math.max.apply(null,r)}},xn=(t,e)=>e.map((e=>{let i=[];switch(e.type){case"a":7==e.points?.length&&i.push([hn(e.points[0]/t.width,1e6),hn(e.points[1]/t.height,1e6),e.points[2],e.points[3],e.points[4],hn(e.points[5]/t.width,1e6),hn(e.points[6]/t.height,1e6)]);break;case"A":7==e.points?.length&&i.push([hn(e.points[0]/t.width,1e6),hn(e.points[1]/t.height,1e6),e.points[2],e.points[3],e.points[4],hn((e.points[5]-t.x)/t.width,1e6),hn((e.points[6]-t.y)/t.height,1e6)]);break;case"h":e.points?.length&&i.push([hn(e.points[0]/t.width,1e6)]);break;case"H":e.points?.length&&i.push([hn((e.points[0]-t.x)/t.width,1e6)]);break;case"v":e.points?.length&&i.push([hn(e.points[0]/t.height,1e6)]);break;case"V":e.points?.length&&i.push([hn((e.points[0]-t.y)/t.height,1e6)]);break;case"z":case"Z":break;case"M":case"L":case"C":case"S":case"Q":case"T":if(e.points?.length)for(let n=0,r=e.points.length-1;n<r;n+=2)i.push([hn((e.points[n]-t.x)/t.width,1e6),hn((e.points[n+1]-t.y)/t.height,1e6)]);break;case"m":case"l":case"c":case"s":case"q":case"t":if(e.points?.length)for(let n=0,r=e.points.length-1;n<r;n+=2)i.push([hn(e.points[n]/t.width,1e6),hn(e.points[n+1]/t.height,1e6)])}return i.length?{type:e.type,ratios:i}:{type:e.type}})),_n=(t,e)=>e.map((e=>{switch(e.type){case"a":return`${e.type}${e.ratios?.map((e=>[hn(t.width*(e[0]??0),1e6),hn(t.height*(e[1]??0),1e6),e[2]??0,e[3]??0,e[4]??0,hn(t.width*(e[5]??0),1e6),hn(t.height*(e[6]??0),1e6)]))?.map((t=>t.join(" ")))?.join(" ")??""}`;case"A":return`${e.type}${e.ratios?.map((e=>[hn(t.width*(e[0]??0),1e6),hn(t.height*(e[1]??0),1e6),e[2]??0,e[3]??0,e[4]??0,hn(t.x+t.width*(e[5]??0),1e6),hn(t.y+t.height*(e[6]??0),1e6)]))?.map((t=>t.join(" ")))?.join(" ")??""}`;case"h":return`${e.type}${e.ratios?.map((e=>hn(t.width*(e[0]??0),1e6)))?.join(" ")??""}`;case"H":return`${e.type}${e.ratios?.map((e=>hn(t.x+t.width*(e[0]??0),1e6)))?.join(" ")??""}`;case"v":return`${e.type}${e.ratios?.map((e=>hn(t.height*(e[0]??0),1e6)))?.join(" ")??""}`;case"V":return`${e.type}${e.ratios?.map((e=>hn(t.y+t.height*(e[0]??0),1e6)))?.join(" ")??""}`;case"z":case"Z":return e.type;case"M":case"L":case"C":case"S":case"Q":case"T":return`${e.type}${e.ratios?.map((e=>[hn(t.x+t.width*(e[0]??0),1e6),hn(t.y+t.height*(e[1]??0),1e6)]))?.map((t=>t.join(" ")))?.join(" ")??""}`;case"m":case"l":case"c":case"s":case"q":case"t":return`${e.type}${e.ratios?.map((e=>[hn(t.width*(e[0]??0),1e6),hn(t.height*(e[1]??0),1e6)]))?.map((t=>t.join(" ")))?.join(" ")??""}`;default:return""}})).join(""),kn=(t,e)=>{let i=[];for(let n=0,r=e.length-1;n<r;n+=2)i.push([(e[n]-t.x)/t.width,(e[n+1]-t.y)/t.height]);return i},On=(t,e)=>e.map((e=>[hn(t.x+t.width*e[0],1e6),hn(t.y+t.height*e[1],1e6)])).map((t=>t.join(" "))).join(" "),Nn=(t,e)=>{let i=En(e);if(i){let e=window.Snap.matrix(i.a,i.b,i.c,i.d,i.e,i.f);if(e){let{dx:i,dy:n,rotate:r,scalex:a,scaley:s}=e.split();return{x:t.x+i,y:t.y+n,dx:i,dy:n,rotate:r,scalex:a,scaley:s}}return{x:In(t.x,t.y,i),y:zn(t.x,t.y,i)}}return t},En=t=>{let e=t.replace(/\s?\-?[0-9\.]+e-[0-9]+/g," 0").replace(/\,/g," ").replace(/\s?\-/g," -").replace(/(\.[0-9]+)(\.[0-9]+)/g,"$1 0$2").replace(/\-\./g,"-0.").replace(/[^0-9\.\-]/g," ").replace(/\s+/g," ").trim().split(" ").map((t=>hn(parseFloat(t),1e6)));if(6==e.length)return{a:e[0],b:e[1],c:e[2],d:e[3],e:e[4],f:e[5]}},In=function(t,e,i){return hn(t*i.a+e*i.c+i.e,10)},zn=function(t,e,i){return hn(t*i.b+e*i.d+i.f,10)},jn=(t,e,i,n,r)=>{let a={x:Math.min(t,i),y:Math.min(e,n),width:Math.abs(i-t)||1,height:Math.abs(n-e)||1};return r?.ratio&&(a.width<=a.height?a.height=a.width*r?.ratio:a.width=a.height/r?.ratio),Object.assign(a,{ratios:r?.ratios||[[(t-a.x)/(a.width||1),(e-a.y)/(a.height||1)],[(i-a.x)/(a.width||1),(n-a.y)/(a.height||1)]]}),r?.points&&(a.points=r?.points),a},Jn=(t,e,i)=>{var n=(()=>{switch(t){case Ri.CIRCLE:return{cx:e.x+e.width/2,cy:e.y+e.height/2,r:Math.min(e.width/2,e.height/2)};case Ri.ELLIPSE:return{cx:e.x+e.width/2,cy:e.y+e.height/2,rx:e.width/2,ry:e.height/2};case Ri.LINE:{let t={};return e.ratios?.forEach(((i,n)=>{t[`x${n+1}`]=e.x+e.width*i[0],t[`y${n+1}`]=e.y+e.height*i[1]})),t}case Ri.RECT:case Ri.FOREIGNOBJECT:case Ri.IMAGE:return{x:e.x,y:e.y,width:e.width,height:e.height};case Ri.TEXT:case Ri.TSPAN:return{x:e.x,y:e.y+(i.alignmentBaseline||i.dominantBaseline?0:i.fontSize??16)};case Ri.POLYGON:case Ri.POLYLINE:if(e.ratios?.length)return{points:On(e,e.ratios)};break;case Ri.PATH:if(e.ratioMaps?.length)return{d:_n(e,e.ratioMaps)};if(e.points?.length)return{d:`M ${(n=e.points)[0][0]} ${n[0][1]} L ${(n.map((t=>[t[0],t[1]]))||[]).map((t=>t.join(" "))).join(" ")}`}}var n;return{}})();return e.rotate?(n.transform=`rotate(${e.rotate})`,n.transformOrigin=`${e.x+e.width/2} ${e.y+e.height/2}`):i.transform?.match(/^rotate/)&&(i.transform=null,i.transformOrigin=null),n},$n=(t,e,i)=>{if(!e.points||!e.points.length)return void i();let n=jQuery("#"+t),r=(t=>{if(1==t.length){let{size:i}=e.node;return[[i.x+i.width/2,i.y+i.height/2],...t]}return[...t]})(e.points||[]),a=function(t){let e=[];2===t.length&&t.splice(1,0,[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2]);let i,n,r,a=1,s=t.length;for(;a<s;){if(i=t[a-1],n=t[a],r=t[a+1],(Math.abs(i[0]-n[0])>=15||Math.abs(i[1]-n[1])>=15)&&Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2)>=Math.pow(15,2)&&r&&(Math.abs(i[0]-r[0])<=20||Math.abs(i[1]-r[1])<=20)&&Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2)<=Math.pow(20,2))e.push(n);else{let t=n[0]-i[0],r=n[1]-i[1],a=Math.max(Math.abs(t),Math.abs(r));for(var o=0;o<a;o+=15)e.push([i[0]+t*o/a,i[1]+r*o/a])}a++}return s>0&&(e.splice(0,0,t[0]),e.push(t[s-1])),e}(r),s=e.iteration??0;if(s<0&&(i(),i=function(){}),n.data("work-running")&&s<0)return;n.data("work-running",!0);let o,l=a.length,c=Math.max(20,1e3*(e.time||3)/l),{id:d,type:h,size:u,attribute:f}=hr.findNode(t),g=function(t){if(e.slideStatus!==hr.slideStatus)return n.data("work-running",!1),void(e.slideStatus===hr.slideStatus&&i());if(t<l){let e=a[t];e&&(o=Object.assign({},u,{x:e[0]-u.width/2,y:e[1]-u.height/2}),Object.assign(f,Jn(h,o,f)),vr(window.document.getElementById(d),f),setTimeout((function(){g(++t)}),c))}else if(s>0)s--,g(1);else if(s<0)g(1);else switch(n.data("work-running",!1),e.slideStatus===hr.slideStatus&&i(),e.finish){default:case 0:break;case 1:Object.assign(f,Jn(h,u,f)),vr(window.document.getElementById(d),f);break;case 2:yn(e.node.id,{node:e.node,value:e.node.animate?.out,nodeStatus:e.nodeStatus,slideStatus:e.slideStatus},(()=>{n.addClass("hide")}))}};g(1)},An=(t,e,i,n,r)=>{if(n.slideStatus!=hr.slideStatus)return e.async&&"change-slide"!=e.async?void 0:void r();if(n.nodeStatus!=hr.nodeStatus&&(!e.async||"change-node"==e.async))return void r();if(!e.source?.path&&!e.source?.url)return console.warn(`${t} -> audio no source!`),r(),void(r=()=>{});var a=jQuery("#"+t);let s=e.iteration??0;if(s<0&&(r(),r=function(){}),!(a.data("audio-running")&&s<0)){a.data("audio-running",!0);var o=function(t){t.pause(),t.remove(),a.data("audio-running",!1)},l=new Audio;return l.autoplay=!0,l.loop=0!=s,l.preload="auto",l.controls=!0,l.setAttributeNode(document.createAttribute("playsinline")),l.addEventListener("canplay",(function(){var t=l.play();t&&t.then((function(t){a.data("audio-running",!0),"time"==e.async?setTimeout((()=>{n.slideStatus===hr.slideStatus&&(o(l),r(),r=()=>{})}),1e3*(e.time??1)):"non-stop"==e.async&&(r(),r=()=>{})})).catch((function(t){a.data("audio-running",!1),n.slideStatus===hr.slideStatus&&(r(),r=()=>{})}))})),l.addEventListener("timeupdate",(function(){switch(e.async){case"time":case"change-slide":n.slideStatus!==hr.slideStatus&&(o(this),r(),r=()=>{});break;case"finish-action":i.total>=2&&i.total-i.counter==1&&(o(this),r(),r=()=>{});break;default:case"change-node":n.nodeStatus!==hr.nodeStatus&&(o(this),r(),r=()=>{});case"non-stop":}})),l.addEventListener("canplaythrough",(function(){this.loop&&(s>0?s--:0==s&&(this.loop=!1))})),l.addEventListener("play",(function(){})),l.addEventListener("pause",(function(){})),l.addEventListener("ended",(function(){this.remove(),a.data("audio-running",!1),n.slideStatus===hr.slideStatus&&(r(),r=()=>{})})),l.onerror=function(){this.remove(),a.data("audio-running",!1),n.slideStatus===hr.slideStatus&&(r(),r=()=>{})},l.src=(e.source?.path?ls.config?.readfileuploadurl+e.source?.path:e.source?.url)||"",l}},Tn=t=>{t.id?jQuery("#"+t.id).removeClass("hide"):t.ids&&t.ids.forEach((t=>{jQuery("#"+t).removeClass("hide")}))},Cn=t=>{t.id?(jQuery("#"+t.id).removeClass("hide"),Rn(hr.findNode(t.id),t.nodeStatus,t.slideStatus)):t.ids&&t.ids.forEach((e=>{jQuery("#"+e).removeClass("hide"),Rn(hr.findNode(e),t.nodeStatus,t.slideStatus)}))},Bn=t=>{if(t.id){let e=hr.findNode(t.id);yn(t.id,{node:e,value:e.animate?.out,nodeStatus:t.nodeStatus,slideStatus:t.slideStatus},(()=>{jQuery("#"+t.id).addClass("hide")}))}else t.ids&&t.ids.forEach((e=>{let i=hr.findNode(e);yn(e,{node:i,value:i.animate?.out,nodeStatus:t.nodeStatus,slideStatus:t.slideStatus},(()=>{jQuery("#"+e).addClass("hide")}))}))},Rn=(t,e,i,n)=>{let r={total:0,counter:0},{triggershow:a,triggerrun:s,triggerhide:o,action:l,audio:c,slide:d,media:h}=t.interactive?.click??{};if(console.log(`node(${t.id}) | nodeStatus(${e}) | slideStatus(${i}) | click`),a){let{id:t,ids:n,time:r,async:s}=a;"asynctrue"==s?Tn({id:t,ids:n,nodeStatus:e,slideStatus:i}):"time"==s&&setTimeout((()=>{Tn({id:t,ids:n,nodeStatus:e,slideStatus:i})}),1e3*(r??0))}if(s){let{id:t,ids:n,time:r,async:a}=s;"asynctrue"==a?Cn({id:t,ids:n,nodeStatus:e,slideStatus:i}):"time"==a&&setTimeout((()=>{Cn({id:t,ids:n,nodeStatus:e,slideStatus:i})}),1e3*(r??0))}if(o){let{id:t,ids:n,time:r,async:a}=o;"asynctrue"==a?Bn({id:t,ids:n,nodeStatus:e,slideStatus:i}):"time"==a&&setTimeout((()=>{Bn({id:t,ids:n,nodeStatus:e,slideStatus:i})}),1e3*(r??0))}let u=()=>{setTimeout((()=>{if(r.counter>=r.total){if(n&&n(),a){let{id:t,ids:n,async:r}=a;r&&"asyncfalse"!=r||Tn({id:t,ids:n,nodeStatus:e,slideStatus:i})}if(s){let{id:t,ids:n,async:r}=s;r&&"asyncfalse"!=r||Cn({id:t,ids:n,nodeStatus:e,slideStatus:i})}if(o){let{id:t,ids:n,async:r}=o;r&&"asyncfalse"!=r||Bn({id:t,ids:n,nodeStatus:e,slideStatus:i})}}}))};if(l?.value){r.total+=1;let n=()=>{r.counter+=1,u()};switch(l?.value){case"hide":yn(t.id,{node:t,value:t.animate?.out,nodeStatus:e,slideStatus:i},(()=>{jQuery("#"+t.id).addClass("hide"),n()}));break;case"points":{let{points:r,time:a,iteration:s,finish:o}=l;r&&$n(t.id,{node:t,points:r,time:a,iteration:s,finish:o,nodeStatus:e,slideStatus:i},n);break}default:{let{value:r,time:a,iteration:s,finish:o}=l;vn(t.id,{node:t,value:r,time:a,iteration:s,finish:o,nodeStatus:e,slideStatus:i},n);break}}}if(c?.source?.path){r.total+=1;let n=()=>{r.counter+=1,u()};An(t.id,c,r,{nodeStatus:e,slideStatus:i},n)}if(r.total||u(),d?.id)switch(d.id){case-1:hr.runSlide(hr.slideIdx-1);break;case-2:hr.runSlide(hr.slideIdx+1);break;default:hr.runSlide(void 0,d.id,d.code?.toString())}if(h?.type){let t=ln({readfileuploadurl:ls.config?.readfileuploadurl,type:h?.type,oss:h?.oss,path:h?.path,url:h?.url}),e=jQuery(`<div class="popup-media-viewer"><iframe src="${t}" frameborder="0" allowfullscreen\n        webkitallowfullscreen allowtransparency="true" allow="fullscreen"></iframe><div class="btn-close"><img src="assets/icon-svg/close-outline.svg"/></div></div>`).appendTo(window.document.body);e.find(".btn-close").click((function(t){t.preventDefault(),e.remove()}))}},Mn=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:320,height:80},r=e?.attribute||{fill:ls.attribute.stroke,fontFamily:ls.attribute.fontFamily,fontSize:ls.attribute.fontSize,textLength:ls.attribute.textLength},a=e?.source||{type:"text",text:{textContent:""}};return{nodeId:t,element:mr(t,Ri.TEXT,"text",{size:n,attribute:r,source:a},i),size:n,attribute:r,source:a}},Ln=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{};return{nodeId:t,element:mr(t,Ri.GROUP,"g",{size:n,attribute:r},i),size:n,attribute:r}},Pn=(t,e,i)=>{let n=1,r=new Image;r.onload=()=>{n=hn(r.naturalWidth/r.naturalHeight,100);let t=0,a=0,s=0,o=0;n>=1?(s=Math.min(r.naturalWidth,hr.slide.svg?.viewBox?.width??0),o=s/n):(o=Math.min(r.naturalHeight,hr.slide.svg?.viewBox?.height??0),s=o/n),t=((hr.slide.svg?.viewBox?.width??0)-s)/2,a=((hr.slide.svg?.viewBox?.height??0)-o)/2,e.size={x:t,y:a,width:s,height:o},Fn(e,i)},r.onerror=t=>{console.error(`ImgSrc load failed -> ${JSON.stringify(e.source)}`,t)},r.src=(e.source?.path?ls.config?.readfileuploadurl+e.source?.path:e.source?.url)||""},Fn=(t,e)=>{if(t.slideStatus!=hr.slideStatus)return void e();let{element:i}=gn(Math.ceil(1e9*Math.random()),{size:t.size,source:{type:"image",image:t?.source}});setTimeout((()=>{i?.remove(),e()}),3e3)},Kn=(t,e,i)=>{let n=new Image;n.onload=()=>{Gn(t,{width:n.naturalWidth,height:n.naturalHeight},e,i)},n.onerror=t=>{console.error(`ImgSrc load failed -> ${JSON.stringify(e.source)}`,t),i()},n.src=(e.source?.path?ls.config?.readfileuploadurl+e.source?.path:e.source?.url)||""},Gn=(t,e,i,n)=>{if(i.slideStatus!=hr.slideStatus)return void n();let r=hn(e.width/e.height,100),a=0,s=0,o=0,l=0;r>=1?(o=e.width,o=Math.max(o,40),o=Math.min(o,40),l=o/r):(l=e.height,l=Math.max(l,40),l=Math.min(l,40),o=l/r);let{size:c}=t;a=c.x+c.width-o/2,s=c.y-l/2;let d=xr(Ti.TEST_GROUP,"g",void 0,ls.target),{element:h}=gn(`icon-${t.id}`,{size:{x:a,y:s,width:o,height:l},source:{type:"image",image:i?.source}},d);setTimeout((()=>{n()}),3e3)},Dn=(t,e,i)=>{if(e.slideStatus!=hr.slideStatus)return void i();if(!e.source?.path&&!e.source?.url)return console.warn(`${t.id} -> audio no source!`),void i();var n=jQuery("#"+t.id);let r=e.iteration??0;if(r<0&&(i(),i=function(){}),!(n.data("audio-running")&&r<0)){n.data("audio-running",!0);var a=new Audio;return a.autoplay=!0,a.loop=0!=r,a.preload="auto",a.controls=!0,a.setAttributeNode(document.createAttribute("playsinline")),a.addEventListener("canplay",(function(){var t=a.play();t&&t.then((function(t){n.data("audio-running",!0)})).catch((function(t){n.data("audio-running",!1),e.slideStatus===hr.slideStatus&&i()}))})),a.addEventListener("timeupdate",(function(){e.slideStatus!==hr.slideStatus&&function(t){t.pause(),t.remove(),n.data("audio-running",!1)}(this)})),a.addEventListener("canplaythrough",(function(){this.loop&&(r>0?r--:0==r&&(this.loop=!1))})),a.addEventListener("play",(function(){})),a.addEventListener("pause",(function(){})),a.addEventListener("ended",(function(){this.remove(),n.data("audio-running",!1),e.slideStatus===hr.slideStatus&&i()})),a.onerror=function(){this.remove(),n.data("audio-running",!1),e.slideStatus===hr.slideStatus&&i()},a.src=(e.source?.path?ls.config?.readfileuploadurl+e.source?.path:e.source?.url)||"",a}};var Qn=/^#[a-fA-F0-9]+$/i,Un=/^rgb\((\d+),(\d+),(\d+)\)$/i,Wn=/^rgba\((\d+),(\d+),(\d+),([0-9\.]+)\)$/i;const Vn=t=>{let e=null,i=null;if(t)if("transparent"==t)e="#000000",i=0;else if(t.match(Qn))e=t;else{let n=(t=t.replace(/\s+/g,"")).match(Wn);if(n)e="#"+(256|n[1]).toString(16).slice(1)+(256|n[2]).toString(16).slice(1)+(256|n[3]).toString(16).slice(1),i=hn(parseFloat(n[4]),100);else{let i=t.match(Un);i&&(e="#"+(256|i[1]).toString(16).slice(1)+(256|i[2]).toString(16).slice(1)+(256|i[3]).toString(16).slice(1))}}return{hex:e,alpha:i}},Hn=t=>Xn(t?.url,t?.path,t?.src,t?.name);var Xn=(t,e,i,n)=>{let r,a,s,o;return t&&(r=t.replace(/\\/g,"/")),e&&(a=e.replace(/\\/g,"/")),i&&(s=i.replace(/\\/g,"/")),a&&!r&&(r=ls.config?.readfileuploadurl+a),!s||a||r||(a=s.replace(/^[a-zA-Z0-9\-\_\/\\\:\.]+(upload|FileUpload|files|readfileupload|filereader|readfile)\//g,""),r=ls.config?.readfileuploadurl+a),o=n||(r??"").split("/").pop()||(a??"").split("/").pop()||"",{url:r,path:a,name:o}};const qn=t=>{let e={x:0,y:0,width:t.screen.w,height:t.screen.h},i=[];return t.data.forEach(((t,n)=>{let r={id:"number"==typeof t.id?t.id:ls.data.newSlideId,code:t.id?.toString(),name:"string"==typeof t.id?t.id:`Trang ${n+1}`,svg:{viewBox:e,nodes:[]},test:(a=t.test2,a?(a.audiotrue&&(a.audiotrue=Hn({path:a.audiotrue.path})),a.audiofalse&&(a.audiofalse=Hn({path:a.audiofalse.path})),a.effecttrue&&(a.effecttrue=Hn({path:a.effecttrue.path})),a.effectfalse&&(a.effectfalse=Hn({path:a.effectfalse.path})),a.icontrue&&(a.icontrue=Hn({path:a.icontrue.path})),a.iconfalse&&(a.iconfalse=Hn({path:a.iconfalse.path})),a):{})};var a,s;t.background&&r.svg&&(!(s=t.background)||null===s.match(/#([a-zA-Z0-9]+)/)&&null===s.match(/rgb\([0-9]+,[0-9]+,[0-9]+\)/)&&null===s.match(/rgba\([0-9]+,[0-9]+,[0-9]+,[0-9\.]+\)/)?function(t){return t&&null!==t.match(/data:[^;]+;base64,/)}(t.background)?r.svg.background={base64:t.background}:function(t){return t&&null!==t.match(/http(s)?:\/\//)}(t.background)?r.svg.background=Xn(t.background):r.svg.background=Xn(void 0,t.background):r.svg.background={color:t.background}),jQuery(t.svg??"").find(".indexs").find("polygon,path,circle,ellipse,line,rect,foreignObject").each(((e,i)=>{let n=jQuery(i).parents(".indexs"),a=(o=n.attr("data-index"))?parseInt(o):0,s=(t=>a&&t?parseInt(t):0)(n.attr("data-time"));var o;let l=i.getAttribute("id")??(1e9*Math.random()).toFixed(),c={id:parseInt(l),code:`${i.nodeName}-${l}`,name:i.nodeName,idx:a,time:s,type:(()=>{switch(i.nodeName){case"polygon":return Ri.POLYGON;case"path":return Ri.PATH;case"circle":return Ri.CIRCLE;case"ellipse":return Ri.ELLIPSE;case"line":return Ri.LINE;case"rect":return Ri.RECT;case"foreignObject":return Ri.FOREIGNOBJECT}return 0})(),size:(()=>{let t={},e=0,n=0,r=0,a=0,s=null,o=null,l=parseFloat(i.getAttribute("transform")?.replace("rotate(","").replace(")","")||"0")||null;switch(i.nodeName){case"polygon":{let t=[],l=[],c=999999999,d=999999999,h=0,u=0;s=JSON.parse(i.getAttribute("ratios")||"[]"),o=i.getAttribute("points")?.split(",").map((function(t){return t.split(" ").map((function(t){return parseFloat(t)}))}))??[],o.forEach((function(e){t.push(e[0]),l.push(e[1])})),c=Math.min.apply(null,t),d=Math.min.apply(null,l),h=Math.max.apply(null,t),u=Math.max.apply(null,l),e=c,n=d,r=h-e,a=u-n;break}case"path":{let s=i.getAttribute("d");if(s){let i=wn(s),{minX:o,minY:l,maxX:c,maxY:d}=Sn(i);e=o,n=l,r=c-e||1,a=d-n||1,Object.assign(t,{ratioMaps:xn({x:e,y:n,width:r,height:a},i)})}break}case"circle":{let t=parseFloat(i.getAttribute("cx")||"0"),s=parseFloat(i.getAttribute("cy")||"0"),o=parseFloat(i.getAttribute("r")||"0");e=t-o,n=s-o,r=2*o,a=2*o;break}case"ellipse":{let t=parseFloat(i.getAttribute("cx")||"0"),s=parseFloat(i.getAttribute("cy")||"0"),o=parseFloat(i.getAttribute("rx")||"0"),l=parseFloat(i.getAttribute("ry")||"0");e=t-o,n=s-l,r=2*o,a=2*l;break}case"line":{let t=parseFloat(i.getAttribute("x1")||"0"),o=parseFloat(i.getAttribute("y1")||"0"),l=parseFloat(i.getAttribute("x2")||"0"),c=parseFloat(i.getAttribute("y2")||"0"),d=999999999,h=999999999,u=0,f=0;d=Math.min(t,l),h=Math.min(o,c),u=Math.max(t,l),f=Math.max(o,c),e=d,n=h,r=u-e,a=f-n,s=[[(t-e)/(r||1),(o-n)/(a||1)],[(l-e)/(r||1),(c-n)/(a||1)]];break}case"rect":case"foreignObject":e=parseFloat(i.getAttribute("x")||"0"),n=parseFloat(i.getAttribute("y")||"0"),r=parseFloat(i.getAttribute("width")||"0"),a=parseFloat(i.getAttribute("height")||"0")}return Object.assign(t,{x:e,y:n,width:r,height:a,ratios:s,points:o,rotate:l})})(),attribute:(()=>{let t={};switch(i.nodeName){case"polygon":case"circle":case"ellipse":case"line":case"rect":{let e=i.getAttribute("fill")??null,n=i.getAttribute("stroke")??null,r=parseFloat(i.getAttribute("stroke-opacity")??"1")??null,a=parseFloat(i.getAttribute("stroke-width")||"0")??null,s=i.getAttribute("stroke-linecap")??null,o=i.getAttribute("stroke-linejoin")??null,l=parseFloat(i.getAttribute("stroke-dasharray")||"0")??null;Object.assign(t,{fill:e,stroke:n,strokeOpacity:r,strokeWidth:a,strokeLinecap:s,strokeLinejoin:o,strokeDasharray:l});break}case"path":{let e=n.get(0);if(e){let i=e.getAttribute("fill")??null,n=e.getAttribute("stroke")??null,r=parseFloat(e.getAttribute("stroke-opacity")??"1")??null,a=parseFloat(e.getAttribute("stroke-width")||"0")??null,s=e.getAttribute("stroke-linecap")??null,o=e.getAttribute("stroke-linejoin")??null,l=parseFloat(e.getAttribute("stroke-dasharray")||"0")??null;Object.assign(t,{fill:i,stroke:n,strokeOpacity:r,strokeWidth:a,strokeLinecap:s,strokeLinejoin:o,strokeDasharray:l})}break}}return t})(),style:(()=>{let t={};switch(i.nodeName){case"polygon":case"path":case"circle":case"ellipse":case"line":case"rect":break;case"foreignObject":{let e=jQuery(i).find(".svg-container");if(e.length){let i=parseFloat(e.css("border-width")||"0")||null,n=e.css("border-style")||null,r=e.css("border-color")||null,a=null,s=e.css("background-color")||null,o=null;(()=>{let{hex:t,alpha:e}=Vn(r);r=t,a=e})(),(()=>{let{hex:t,alpha:e}=Vn(s);s=t,o=e})(),Object.assign(t,{borderWidth:i,borderStyle:n,borderColor:r,borderOpacity:a,backgroundColor:s,backgroundOpacity:o})}let n=jQuery(i).find(".svg-editor-content");if(n.length){let e=JSON.parse((n.attr("data-style")||"{}").replace(/\&quot\;/gm,'"')),{hex:i,alpha:r}=Vn(e.TextColor);Object.assign(t,{fontFamily:e.FontFamily??null,fontSize:e.FontSize??null,color:i,opacity:r})}break}}return t})(),source:(()=>{let e={};switch(i.nodeName){case"polygon":case"path":case"circle":case"ellipse":case"line":case"rect":break;case"foreignObject":if(n.hasClass("editors")){let t="div,h1,h2,h3,h4,h5,h6,p,span,strong,b,i",n=e=>{e?.forEach((e=>{let i=e.querySelectorAll(`:scope > ${t}`);i.length&&n(i),e.querySelectorAll(":scope > *").length||""!=e.textContent||e.remove()}))},r=t=>{let e=t?.querySelectorAll(":scope > div,h1,h2,h3,h4,h5,h6,p,strong,span");if(e?.length){let i=e[e.length-1];if(""==i.textContent?.trim()){let e=i.querySelectorAll(":scope > *");if(e.length){let i=e[e.length-1];["br","BR"].includes(i?.nodeName)&&(i.remove(),r(t))}else i.remove(),r(t)}}};n(jQuery(i).find(".svg-editor-content").get(0)?.querySelectorAll(`:scope > ${t}`)),r(jQuery(i).find(".svg-editor-content").get(0));let a=jQuery(i).find(".svg-editor-content");if(a.length){let t=a.html(),i=(t??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[];Object.assign(e,{type:"html",html:{htmlContent:t,variableKeywords:i}})}}else if(n.hasClass("inputs")||n.hasClass("textareas"))Object.assign(e,{type:"input",input:{input:!!jQuery(i).find("input").length,textarea:!!jQuery(i).find("textarea").length}});else if(n.hasClass("tests")){let r=jQuery(i).find(".svg-test");if(n.hasClass("tests-truefalse")){let i=r.find(".svg-editor-content").html(),n=(i??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[];Object.assign(e,{type:"test",test:{type:"truefalse",truefalse:{iscorrect:t.test2.truefalse?.includes(l)}},html:{htmlContent:i,variableKeywords:n}})}else if(n.hasClass("tests-singlechoice")){let i=r.find(".svg-editor-content").html(),n=(i??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[];Object.assign(e,{type:"test",test:{type:"singlechoice",singlechoice:{iscorrect:t.test2.singlechoice?.includes(l)}},html:{htmlContent:i,variableKeywords:n}})}else if(n.hasClass("tests-multichoice")){let i=r.find(".svg-editor-content").html(),n=(i??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[];Object.assign(e,{type:"test",test:{type:"multichoice",multichoice:{iscorrect:t.test2.multichoice?.includes(l)}},html:{htmlContent:i,variableKeywords:n}})}else if(n.hasClass("tests-fill")){let i=r.find(".svg-editor-content").html(),n=(i??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[],a=(i??"").match(/\[\[[a-zA-Z0-9]+\]\]/gm)??[];a=a.filter(((t,e,i)=>i.indexOf(t)==e)),Object.assign(e,{type:"test",test:{type:"fill",fill:a.map((e=>({key:e,value:t.test2.fill?.find((t=>t.id==l))?.vals?.map((t=>t.text)).filter((t=>!["",null,void 0,NaN].includes(t)))})))},html:{htmlContent:i,variableKeywords:n,fillKeywords:a}})}else if(n.hasClass("tests-matching")){if(r.hasClass("svg-test-empty"))Object.assign(e,{type:"test",test:{type:"matching-empty",matching:{key:r.attr("data-name")||null}}});else if(r.hasClass("svg-test-content")){let t=r.find(".svg-editor-content").html(),i=(t??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[];Object.assign(e,{type:"test",test:{type:"matching-content",matching:{key:r.attr("data-name")||null}},html:{htmlContent:t,variableKeywords:i}})}}else if(n.hasClass("tests-speech"))Object.assign(e,{type:"speech",speech:{value:t.test2.speech?.find((t=>t.id==l))?.vals?.map((t=>t.text)).filter((t=>!["",null,void 0,NaN].includes(t)))}});else if(n.hasClass("tests-submit")){let t=jQuery(i).find(".svg-container img");Object.assign(e,{type:"test",test:{type:"submit"},image:Xn(t.attr("url"),t.attr("path"),t.attr("src"))})}}else if(n.hasClass("images")){let t=jQuery(i).find(".svg-editor-content img");if(t.length)Object.assign(e,{type:"image",image:Xn(t.attr("url"),t.attr("path"),t.attr("src"))});else{let t=jQuery(i).find("iframe");Object.assign(e,{type:"iframe",iframe:Xn(t.attr("url"),t.attr("path"),t.attr("src"))})}}else if(n.hasClass("sounds")){let t=jQuery(i).find(".svg-editor-content img");t.length&&Object.assign(e,{type:"image",image:Xn(t.attr("url"),t.attr("path"),t.attr("src"))})}else if(n.hasClass("htmls")){let t=jQuery(i).find("iframe");t.length&&Object.assign(e,{type:"iframe",iframe:Xn(t.attr("url"),t.attr("path"),t.attr("src"))})}else if(n.hasClass("svgs")){let t=jQuery(i).find("svg");t.length&&Object.assign(e,{type:"svg",svg:Object.assign(Xn(t.attr("url"),t.attr("path"),t.attr("src")),{svgContent:t.get(0)?.outerHTML??null})})}else if(n.hasClass("medias")){let t=jQuery(i).find(".media-item");if(t.length)switch(t.attr("type")){case"audio":Object.assign(e,{type:"audio",audio:Xn(t.attr("url"),t.attr("path"),t.attr("src"))});break;case"video":Object.assign(e,{type:"video",video:Xn(t.attr("url"),t.attr("path"),t.attr("src"))});break;case"file":Object.assign(e,{type:"file",file:Xn(t.attr("url"),t.attr("path"),t.attr("src"))});break;default:Object.assign(e,{type:"link",link:{url:t.attr("url")??null}})}let n=jQuery(i).find("img");n.length&&(Object.assign(e,{image:Xn(n.attr("url"),n.attr("path"),n.attr("src"))}),e.type||Object.assign(e,{type:"image"}))}}return e})(),animate:(()=>{let e={},i=t.animates?.find((t=>t.elementId==l));return i&&Object.assign(e,{value:i.value}),e})(),interactive:(()=>{let e={},i=t.actions.show.filter((t=>t.elementId==l&&t.active));i.length&&(e.show={},i.forEach((t=>{let{source:i}=t;switch(i?.type){case"work":e.show.action={},Object.assign(e.show.action,{value:i.value??null,iteration:i.iteration??null,finish:i.end??null,time:i.time??null,points:i.points??null});break;case"audio":e.show.audio={},Object.assign(e.show.audio,{source:Xn(null,null,i.url),iteration:i.iteration??null,finish:i.end??null,time:i.time??null,async:-1==i.iteration?"change-slide":"change-node"});break;case"node":case"node2":i.options.includes("show")&&(e.show.triggershow={},Object.assign(e.show.triggershow,{id:parseInt(i.id??"0")??null,ids:i.ids?.map((t=>parseInt(t))),async:i.async??null,time:i.time??null})),i.options.includes("run")&&(e.show.triggerrun={},Object.assign(e.show.triggerrun,{id:parseInt(i.id??"0")??null,ids:i.ids?.map((t=>parseInt(t))),async:i.async??null,time:i.time??null})),i.options.includes("hide")&&(e.show.triggerhide={},Object.assign(e.show.triggerhide,{id:parseInt(i.id??"0")??null,ids:i.ids?.map((t=>parseInt(t))),async:i.async??null,time:i.time??null}))}})));let n=t.actions.click.filter((t=>t.elementId==l&&t.active));return n&&(e.click={},n.forEach((t=>{let{source:i}=t;switch(i?.type){case"work":e.click.action={},Object.assign(e.click.action,{value:i.value??null,iteration:i.iteration??null,finish:i.end??null,time:i.time??null,points:i.points??null});break;case"audio":e.click.audio={},Object.assign(e.click.audio,{source:Xn(null,null,i.url),iteration:i.iteration??null,finish:i.end??null,time:i.time??null,async:-1==i.iteration?"change-slide":"change-node"});break;case"video":{e.click.video={},Object.assign(e.click.video,{source:Xn(i.url,i.path)});let{url:t,path:n,name:r}=Xn(i.url,i.path);e.click.media={},Object.assign(e.click.media,{url:t,path:n,name:r,type:Fi.VIDEO});break}case"image":{e.click.image={},Object.assign(e.click.image,{source:Xn(i.url,i.path)});let{url:t,path:n,name:r}=Xn(i.url,i.path);e.click.media={},Object.assign(e.click.media,{url:t,path:n,name:r,type:Fi.IMAGE});break}case"link":{e.click.link={},Object.assign(e.click.link,{url:i.url,target:i.target});let{url:t,path:n,name:r}=Xn(i.url,i.path);e.click.media={},Object.assign(e.click.media,{url:t,path:n,name:r,type:Fi.LINK});break}case"text":e.click.text={},Object.assign(e.click.text,{content:i.content});break;case"node":case"node2":i.options.includes("show")&&(e.click.triggershow={},Object.assign(e.click.triggershow,{id:parseInt(i.id??"0")??null,ids:i.ids?.map((t=>parseInt(t))),async:i.async??null,time:i.time??null})),i.options.includes("run")&&(e.click.triggerrun={},Object.assign(e.click.triggerrun,{id:parseInt(i.id??"0")??null,ids:i.ids?.map((t=>parseInt(t))),async:i.async??null,time:i.time??null})),i.options.includes("hide")&&(e.click.triggerhide={},Object.assign(e.click.triggerhide,{id:parseInt(i.id??"0")??null,ids:i.ids?.map((t=>parseInt(t))),async:i.async??null,time:i.time??null}));break;case"slide":e.click.slide={},Object.assign(e.click.slide,{id:parseInt(i.id??"0")||i.num||null,code:i.id})}}))),e})(),variable:(()=>{let e={};i.getAttribute("data-variable")&&(e.input={},Object.assign(e.input,{variable:i.getAttribute("data-variable")??null}));let n=t.nodes?.find((t=>t.id==l))?.variable;return n&&(e.click={},Object.assign(e.click,{variable:n.variable??null,operator:n.operator??null,valuetype:n.valuetype??null,value:n.value??null})),e})()};r.svg?.nodes.push(c)})),i.push(r)})),{screen:{width:t.screen.w,height:t.screen.h},data:{slides:i},variable:t.variable,fonts:[]}},Yn=(t,e)=>{e.test?.answer?.matching?.filter((e=>e.id==t.id)).forEach((t=>t.value="")),jQuery(`#node-${t.id}`).remove()},Zn=(t,e,i,n,r,a)=>{r.iscorrect?(e.test?.audiotrue?.path&&Dn(t,{source:Hn(e.test?.audiotrue),iteration:0,nodeStatus:i,slideStatus:n},a),e.test?.effecttrue?.path&&Pn(0,{source:Hn(e.test?.effecttrue),iteration:0,nodeStatus:i,slideStatus:n},a)):(e.test?.audiofalse?.path&&Dn(t,{source:Hn(e.test?.audiofalse),iteration:0,nodeStatus:i,slideStatus:n},a),e.test?.effectfalse?.path&&Pn(0,{source:Hn(e.test?.effectfalse),iteration:0,nodeStatus:i,slideStatus:n},a)),tr(e,i,n,a)},tr=(t,e,i,n)=>{switch(t.test?.type){case"truefalse":{let{value:r,iscorrect:a}=t?.test?.answer?.truefalse??{};if(r){let s=hr.findNode(r);a?t.test?.icontrue?.path&&Kn(s,{source:Hn(t.test?.icontrue),iteration:0,nodeStatus:e,slideStatus:i},n):t.test?.iconfalse?.path&&Kn(s,{source:Hn(t.test?.iconfalse),iteration:0,nodeStatus:e,slideStatus:i},n)}break}case"singlechoice":{let{value:r,iscorrect:a}=t?.test?.answer?.singlechoice??{};if(r){let s=hr.findNode(r);a?t.test?.icontrue?.path&&Kn(s,{source:Hn(t.test?.icontrue),iteration:0,nodeStatus:e,slideStatus:i},n):t.test?.iconfalse?.path&&Kn(s,{source:Hn(t.test?.iconfalse),iteration:0,nodeStatus:e,slideStatus:i},n)}break}case"multichoice":t?.test?.answer?.multichoice?.forEach((r=>{let{value:a,iscorrect:s}=r;if(a){let r=hr.findNode(a);s?t.test?.icontrue?.path&&Kn(r,{source:Hn(t.test?.icontrue),iteration:0,nodeStatus:e,slideStatus:i},n):t.test?.iconfalse?.path&&Kn(r,{source:Hn(t.test?.iconfalse),iteration:0,nodeStatus:e,slideStatus:i},n)}}));break;case"fill":t?.test?.answer?.fill?.forEach((r=>{let{id:a,key:s,value:o,iscorrect:l}=r;if(o){let r=hr.findNode(a);l?t.test?.icontrue?.path&&Kn(r,{source:Hn(t.test?.icontrue),iteration:0,nodeStatus:e,slideStatus:i},n):t.test?.iconfalse?.path&&Kn(r,{source:Hn(t.test?.iconfalse),iteration:0,nodeStatus:e,slideStatus:i},n)}}));break;case"matching":t?.test?.answer?.matching?.forEach((r=>{let{id:a,key:s,value:o}=r;if(o){let r=hr.findNode(a);s==o?t.test?.icontrue?.path&&Kn(r,{source:Hn(t.test?.icontrue),iteration:0,nodeStatus:e,slideStatus:i},n):t.test?.iconfalse?.path&&Kn(r,{source:Hn(t.test?.iconfalse),iteration:0,nodeStatus:e,slideStatus:i},n)}}))}},er=(t,e,i,n)=>{var r;e.animate?.value&&((t,e,i)=>{let{value:n}=t.animate??{};yn(t.id,{node:t,value:n,nodeStatus:e,slideStatus:i},(()=>{}))})(e,i.nodeStatus,i.slideStatus),e.interactive?.show?(console.log(`node(${e.id}) | nodeStatus(${i.nodeStatus}) | slideStatus(${i.slideStatus}) | show`),((t,e,i,n)=>{let r={total:0,counter:0},{triggershow:a,triggerrun:s,triggerhide:o,action:l,audio:c}=t.interactive?.show??{};if(console.log(`node(${t.id}) | nodeStatus(${e}) | slideStatus(${i}) | show`),a){let{id:t,ids:n,time:r,async:s}=a;"asynctrue"==s?setTimeout((()=>{Tn({id:t,ids:n,nodeStatus:e,slideStatus:i})})):"time"==s&&setTimeout((()=>{Tn({id:t,ids:n,nodeStatus:e,slideStatus:i})}),1e3*(r??0))}if(s){let{id:t,ids:n,time:r,async:a}=s;"asynctrue"==a?setTimeout((()=>{Cn({id:t,ids:n,nodeStatus:e,slideStatus:i})})):"time"==a&&setTimeout((()=>{Cn({id:t,ids:n,nodeStatus:e,slideStatus:i})}),1e3*(r??0))}if(o){let{id:t,ids:n,time:r,async:a}=o;"asynctrue"==a?setTimeout((()=>{Bn({id:t,ids:n,nodeStatus:e,slideStatus:i})})):"time"==a&&setTimeout((()=>{Bn({id:t,ids:n,nodeStatus:e,slideStatus:i})}),1e3*(r??0))}let d=()=>{setTimeout((()=>{if(r.counter>=r.total){if(n&&n(),a){let{id:t,ids:n,async:r}=a;r&&"asyncfalse"!=r||Tn({id:t,ids:n,nodeStatus:e,slideStatus:i})}if(s){let{id:t,ids:n,async:r}=s;r&&"asyncfalse"!=r||Cn({id:t,ids:n,nodeStatus:e,slideStatus:i})}if(o){let{id:t,ids:n,async:r}=o;r&&"asyncfalse"!=r||Bn({id:t,ids:n,nodeStatus:e,slideStatus:i})}}}))};if(l?.value){r.total+=1;let n=()=>{r.counter+=1,d()};switch(l?.value){case"hide":jQuery("#"+t.id).addClass("hide"),n();break;case"points":{let{points:r,time:a,iteration:s,finish:o}=l;$n(t.id,{node:t,points:r,time:a,iteration:s,finish:o,nodeStatus:e,slideStatus:i},n);break}default:{let{value:r,time:a,iteration:s,finish:o}=l;vn(t.id,{node:t,value:r,time:a,iteration:s,finish:o,nodeStatus:e,slideStatus:i},n);break}}}if(c?.source?.path){r.total+=1;let n=()=>{r.counter+=1,d()},a=An(t.id,c,r,{nodeStatus:e,slideStatus:i},n);-1==c?.iteration&&jQuery("#"+t.id).click((t=>{t.preventDefault(),a&&(a.volume>=1?a.volume=0:a.volume=a.volume+.25),console.log(a?.volume)}))}r.total||d()})(e,i.nodeStatus,i.slideStatus,n)):n&&n(),e.interactive?.click&&(r=e.interactive?.click,Object.keys(r??{}).map((t=>r[t]?1:0)).includes(1)&&jQuery("#"+e.id).addClass("interactive-click"),jQuery("#"+e.id).click((t=>{t.preventDefault(),i.nodeStatus=hr.refreshNodeStatus(),console.log(`node(${e.id}) | nodeStatus(${i.nodeStatus}) | slideStatus(${i.slideStatus}) | click`),Rn(e,i.nodeStatus,i.slideStatus)}))),e.variable?.input&&jQuery("#"+e.id).on("change","input,textarea",(i=>{i.preventDefault(),((t,e,i)=>{ls.variable.setValue(e.variable?.input?.variable??"",t),(t=>{let e=(t,i)=>{t?.forEach((t=>{switch(t.type){case Ri.GROUP:Ln(t.id,{},i?window.document.getElementById(i):null),e(t.nodes,t.id);break;case Ri.POLYGON:break;case Ri.TEXT:Mn(t.id,{size:t.size,attribute:t.attribute,source:t.source},i?window.document.getElementById(i):null)}}))};e(t.svg?.nodes)})(i)})(i.target.value,e,t)})),e.variable?.click&&(e.variable?.click?.variable&&jQuery("#"+e.id).addClass("variable-click"),jQuery("#"+e.id).click((i=>{i.preventDefault(),((t,e)=>{ls.variable.setValueOperator(t.variable?.click),(t=>{let e=(t,i)=>{t?.forEach((t=>{switch(t.type){case Ri.GROUP:Ln(t.id,{},i?window.document.getElementById(i):null),e(t.nodes,t.id);break;case Ri.POLYGON:break;case Ri.TEXT:Mn(t.id,{size:t.size,attribute:t.attribute,source:t.source},i?window.document.getElementById(i):null)}}))};e(t.svg?.nodes)})(e)})(e,t)}))),"test"==e.source?.type&&((t,e)=>{let i=()=>{};switch(t.source?.test?.type){case"truefalse":{jQuery("#"+t.id).click((n=>{n.preventDefault();let r=hr.nodeStatus,a=hr.slideStatus;((t,e,i,n,r)=>{let a=t.source?.test?.truefalse?.iscorrect;e.test?e.test.answer?e.test.answer.truefalse={value:t.id,iscorrect:a}:e.test.answer={truefalse:{value:t.id,iscorrect:a}}:e.test={answer:{truefalse:{value:t.id,iscorrect:a}}},e.svg?.nodes.find((t=>"submit"==t.source?.test?.type))||Zn(t,e,i,n,{iscorrect:a},r);let s=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(s,e,t)})(t,e,r,a,i)}));let n=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(n,e,t);break}case"singlechoice":{jQuery("#"+t.id).click((n=>{n.preventDefault();let r=hr.nodeStatus,a=hr.slideStatus;((t,e,i,n,r)=>{let a=t.source?.test?.singlechoice?.iscorrect;e.test?e.test.answer?e.test.answer.singlechoice={value:t.id,iscorrect:a}:e.test.answer={singlechoice:{value:t.id,iscorrect:a}}:e.test={answer:{singlechoice:{value:t.id,iscorrect:a}}},e.svg?.nodes.find((t=>"submit"==t.source?.test?.type))||Zn(t,e,i,n,{iscorrect:a},r);let s=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(s,e,t)})(t,e,r,a,i)}));let n=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(n,e,t);break}case"multichoice":{jQuery("#"+t.id).click((n=>{n.preventDefault();let r=hr.nodeStatus,a=hr.slideStatus;((t,e,i,n,r)=>{let a=t.source?.test?.multichoice?.iscorrect;e.test?e.test.answer?e.test.answer.multichoice?e.test.answer.multichoice.find((e=>e.value==t.id))?e.test.answer.multichoice=e.test.answer.multichoice.filter((e=>e.value!=t.id)):e.test.answer.multichoice.push({value:t.id,iscorrect:a}):e.test.answer.multichoice=[{value:t.id,iscorrect:a}]:e.test.answer={multichoice:[{value:t.id,iscorrect:a}]}:e.test={answer:{multichoice:[{value:t.id,iscorrect:a}]}},e.svg?.nodes.find((t=>"submit"==t.source?.test?.type))||Zn(t,e,i,n,{iscorrect:a},r);let s=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(s,e,t)})(t,e,r,a,i)}));let n=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(n,e,t);break}case"fill":{jQuery("#"+t.id).on("keyup",'input[type="text"]',(t=>{let e=jQuery("<div/>").css({"font-size":jQuery(t.target).css("font-size"),visibility:"hidden",float:"left"}).text(t.target.value).appendTo(window.document.body);jQuery(t.target).css({width:(e.width()??0)+30})})).on("keypress",'input[type="text"]',(t=>{13===(t.keyCode||t.charCode||t.which)&&(t.preventDefault(),t.stopPropagation(),jQuery(t.target).blur())})).on("change",'input[type="text"]',(n=>{let r=n.target?.getAttribute("data-key"),a=n.target?.value?.trim();jQuery("#"+t.id).find(`input[type="text"][data-key="${r}"]`).val(a);let s=hr.nodeStatus,o=hr.slideStatus;((t,e,i,n,r,a)=>{let{value:s}=t.source?.test?.fill?.find((t=>t.key==`[[${r.key}]]`))??{},o=s&&s.map((t=>t?.toLocaleLowerCase())).includes(r.value?.toLocaleLowerCase());r.iscorrect=o,e.test?e.test.answer?e.test.answer.fill?e.test.answer.fill.find((t=>t.key==r.key))?e.test.answer.fill.filter((t=>t.key==r.key)).forEach((t=>{t.value=r.value,t.iscorrect=r.iscorrect})):e.test.answer.fill.push(r):e.test.answer.fill=[r]:e.test.answer={fill:[r]}:e.test={answer:{fill:[r]}};let l=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(l,e,t),e.svg?.nodes.find((t=>"submit"==t.source?.test?.type))||Zn(t,e,i,n,{iscorrect:o},a)})(t,e,s,o,{id:t.id,key:r,value:a},i)})),e.test?.showselection||jQuery("#"+t.id).addClass("hide-selection");let n=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(n,e,t);break}case"matching-empty":{jQuery("#"+t.id).on("touchmove",".ondrag-item",(function(t){t.preventDefault()})).kendoDraggable({filter:".ondrag-item",hint:function(e){return`<div class="ondrag-hint" style="transform: translateX(100%) translateY(100%);width:64px;height:${t.size.height/t.size.width*64}px;border-radius:8px;border:1px dashed #DADADA;padding:8px;box-sizing:content-box;background-color:rgba(255,255,255,0.8);">${e.prop("outerHTML")}</div>`.replace(/\s+/g," ")},dragstart:function(i){jQuery('svg foreignObject .ondrop-here[data-type2="matching-content"]:empty').addClass("actived"),jQuery('svg foreignObject .ondrop-here[data-type2="matching-empty"]').addClass("actived"),e.test?.showselection||jQuery('svg foreignObject .ondrop-here[data-type="matching"]').addClass("hide-selection"),Yn(t,e)},drag:function(t){},dragend:function(t){jQuery("svg foreignObject .ondrop-here").removeClass("actived"),jQuery("svg foreignObject .ondrop-here").removeClass("focused")},dragcancel:function(){jQuery("svg foreignObject .ondrop-here").removeClass("actived"),jQuery("svg foreignObject .ondrop-here").removeClass("focused")}}),jQuery(`#${t.id} .ondrop-here`).kendoDropTarget({dragenter:function(t){t.dropTarget.hasClass("actived")&&t.dropTarget.addClass("focused")},dragleave:function(t){t.dropTarget.hasClass("actived")&&t.dropTarget.removeClass("focused")},drop:function(n){if(!n.dropTarget.hasClass("actived"))return;n.dropTarget.removeClass("focused");let r=n.dropTarget,a=n.draggable.currentTarget;r.is(":empty")||r.find(".ondrag-item").appendTo($('svg foreignObject .ondrop-here[data-type2="matching-content"]:empty').first()),a.appendTo(r);let s=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(s,e,t);let o=hr.nodeStatus,l=hr.slideStatus;((t,e,i,n,r,a)=>{let{key:s}=t.source?.test?.matching??{key:"KIEN"},o=r.key==s;Yn(t,e);let l={id:t.id,key:s??"",value:r.key};e.test?e.test.answer?e.test.answer.matching?e.test.answer.matching.find((t=>t.id==l.id))?e.test.answer.matching.filter((t=>t.id==l.id)).forEach((t=>{t.key=l.key,t.value=l.value})):e.test.answer.matching.push(l):e.test.answer.matching=[l]:e.test.answer={matching:[l]}:e.test={answer:{matching:[l]}},e.svg?.nodes.find((t=>"submit"==t.source?.test?.type))||Zn(t,e,i,n,{iscorrect:o},a)})(t,e,o,l,{key:a.data("key")},i)}});let n=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(n,e,t);break}case"matching-content":{jQuery("#"+t.id).on("touchmove",".ondrag-item",(function(t){t.preventDefault()})).kendoDraggable({filter:".ondrag-item",hint:function(e){return`<div class="ondrag-hint" style="transform: translateX(100%) translateY(100%);width:64px;height:${t.size.height/t.size.width*64}px;border-radius:8px;border:1px dashed #DADADA;padding:8px;box-sizing:content-box;background-color:rgba(255,255,255,0.8);">${e.prop("outerHTML")}</div>`.replace(/\s+/g," ")},dragstart:function(t){jQuery('svg foreignObject .ondrop-here[data-type2="matching-content"]:empty').addClass("actived"),jQuery('svg foreignObject .ondrop-here[data-type2="matching-empty"]').addClass("actived"),e.test?.showselection||jQuery('svg foreignObject .ondrop-here[data-type="matching"]').addClass("hide-selection")},drag:function(t){},dragend:function(t){jQuery("svg foreignObject .ondrop-here").removeClass("actived"),jQuery("svg foreignObject .ondrop-here").removeClass("focused")},dragcancel:function(){jQuery("svg foreignObject .ondrop-here").removeClass("actived"),jQuery("svg foreignObject .ondrop-here").removeClass("focused")}}),jQuery(`#${t.id} .ondrop-here`).kendoDropTarget({dragenter:function(t){t.dropTarget.hasClass("actived")&&t.dropTarget.addClass("focused")},dragleave:function(t){t.dropTarget.hasClass("actived")&&t.dropTarget.removeClass("focused")},drop:function(n){if(!n.dropTarget.hasClass("actived"))return;n.dropTarget.removeClass("focused");let r=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(r,e,t);let a=n.dropTarget;n.draggable.currentTarget.appendTo(a);let s=hr.nodeStatus,o=hr.slideStatus;tr(e,s,o,i)}});let n=xr(Ti.TEST_GROUP,"g",void 0,ls.target);Jr(n,e,t);break}case"speech":break;case"submit":jQuery("#"+t.id).click((n=>{n.preventDefault();let r=hr.nodeStatus,a=hr.slideStatus;((t,e,i,n,r)=>{let a;e?.test?.answer?.truefalse?a=e?.test?.answer?.truefalse?.iscorrect:e?.test?.answer?.singlechoice?a=e?.test?.answer?.singlechoice?.iscorrect:e?.test?.answer?.multichoice?a=1==[e?.test?.answer?.multichoice?.length,e?.test?.answer?.multichoice?.map((t=>t.iscorrect?1:0))?.reduce(((t,e)=>t+e)),e?.svg?.nodes?.filter((t=>"multichoice"==t.source?.test?.type&&t.source?.test?.multichoice?.iscorrect))?.length].filter(((t,e,i)=>i.indexOf(t)==e)).length:e?.test?.answer?.fill?a=e?.test?.answer?.fill?.map((t=>t.iscorrect?1:0))?.reduce(((t,e)=>t+e))==e.svg?.nodes?.filter((t=>"fill"==t.source?.test?.type))?.length:e?.test?.answer?.matching&&(a=e.svg?.nodes?.filter((t=>"matching-empty"==t.source?.test?.type))?.length==(e?.test?.answer?.matching||[]).map((t=>t.key==t.value?1:0)).reduce(((t,e)=>t+e))),Zn(t,e,i,n,{iscorrect:a},r)})(t,e,r,a,i)}))}})(e,t)},ir=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{fill:ls.attribute.fill,stroke:ls.attribute.stroke,strokeWidth:ls.attribute.strokeWidth};return{nodeId:t,element:mr(t,Ri.ELLIPSE,"ellipse",{size:n,attribute:r},i),size:n,attribute:r}},nr=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{stroke:ls.attribute.stroke,strokeWidth:ls.attribute.strokeWidth,strokeLinecap:ls.attribute.strokeLinecap};return{nodeId:t,element:mr(t,Ri.LINE,"line",{size:n,attribute:r},i),size:n,attribute:r}},rr=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{fill:ls.attribute.fill,stroke:ls.attribute.stroke,strokeWidth:ls.attribute.strokeWidth};return{nodeId:t,element:mr(t,Ri.POLYGON,"polygon",{size:n,attribute:r},i),size:n,attribute:r}},ar=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:320,height:80},r=e?.attribute||{},a=e?.source||{type:"html",html:{htmlContent:""}},s=e?.style||{};return{nodeId:t,element:mr(t,Ri.FOREIGNOBJECT,"foreignObject",{size:n,attribute:r,style:s,source:a},i),size:n,attribute:r,style:s,source:a}},sr=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{stroke:ls.attribute.stroke,strokeWidth:ls.attribute.strokeWidth};return{nodeId:t,element:mr(t,Ri.PATH,"path",{size:n,attribute:r},i),size:n,attribute:r}},or=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:10,height:10},r=e?.attribute||{fill:ls.attribute.fill,stroke:ls.attribute.stroke,strokeWidth:ls.attribute.strokeWidth};return{nodeId:t,element:mr(t,Ri.POLYLINE,"polyline",{size:n,attribute:r},i),size:n,attribute:r}},lr=(t,e,i)=>{let n=e?.size||{x:0,y:0,width:320,height:80},r=e?.attribute||{fill:ls.attribute.stroke,fontFamily:ls.attribute.fontFamily,fontSize:ls.attribute.fontSize,textLength:ls.attribute.textLength},a=e?.source||{type:"text",text:{textContent:""}};return{nodeId:t,element:mr(t,Ri.TSPAN,"tspan",{size:n,attribute:r,source:a},i),size:n,attribute:r,source:a}},cr=(t,e,i)=>{if(i.slideStatus!=hr.slideStatus)return;if(!e.length)return;let n=e.shift(),r=t.filter((t=>(t.idx??0)==n));if(!r.length)return;let a=Math.max.apply(null,r.map((t=>t.time??0))),s=!1,o=a<.5?0:setTimeout((()=>{s||(s=!0,cr(t,e,i))}),1e3*a);dr(t,e,r,0,i,{idx:n,total:r.length,counter:0,isRecursive:s,timeoutRecursive:o,maxTimeCoundown:a,uid:Math.floor(1e9*Math.random())})},dr=(t,e,i,n,r,a)=>{if(r.slideStatus!=hr.slideStatus)return;let s=i[n];if(s){switch(s.type){case Ri.GROUP:break;case Ri.CIRCLE:pn(s.id,{size:s.size,attribute:s.attribute},s.pid?window.document.getElementById(s.pid):null);break;case Ri.ELLIPSE:ir(s.id,{size:s.size,attribute:s.attribute},s.pid?window.document.getElementById(s.pid):null);break;case Ri.LINE:nr(s.id,{size:s.size,attribute:s.attribute},s.pid?window.document.getElementById(s.pid):null);break;case Ri.RECT:fn(s.id,{size:s.size,attribute:s.attribute},s.pid?window.document.getElementById(s.pid):null);break;case Ri.POLYGON:rr(s.id,{size:s.size,attribute:s.attribute},s.pid?window.document.getElementById(s.pid):null);break;case Ri.POLYLINE:or(s.id,{size:s.size,attribute:s.attribute},s.pid?window.document.getElementById(s.pid):null);break;case Ri.FOREIGNOBJECT:ar(s.id,{size:s.size,attribute:s.attribute,style:s.style,source:s.source},s.pid?window.document.getElementById(s.pid):null);break;case Ri.IMAGE:gn(s.id,{size:s.size,attribute:s.attribute,source:s.source},s.pid?window.document.getElementById(s.pid):null);break;case Ri.TEXT:Mn(s.id,{size:s.size,attribute:s.attribute,source:s.source},s.pid?window.document.getElementById(s.pid):null);break;case Ri.TSPAN:lr(s.id,{size:s.size,attribute:s.attribute,source:s.source},s.pid?window.document.getElementById(s.pid):null);break;case Ri.PATH:sr(s.id,{size:s.size,attribute:s.attribute},s.pid?window.document.getElementById(s.pid):null)}er(r.slide,s,r,(()=>{a.counter+=1,a.maxTimeCoundown<.5&&a.counter>=a.total&&(a.total=a.counter=0,a.isRecursive||(clearTimeout(a.timeoutRecursive),a.isRecursive=!0,setTimeout((()=>{cr(t,e,r)}),250)))})),dr(t,e,i,++n,r,a)}},hr=new class{constructor(){this._nodeStatus=0,this._slideStatus=0,this._slideIdx=0,this._fnChangeSlides=[]}set data(t){this._dataSource=t.data||{},ls.variable.set=t.variable||{}}get nodeStatus(){return this._nodeStatus}refreshNodeStatus(){return this._nodeStatus=Math.floor(999999999*Math.random()),this._nodeStatus}get slideStatus(){return this._slideStatus}refreshSlideStatus(){return this._slideStatus=Math.floor(999999999*Math.random()),this._slideStatus}get slideIdx(){return this._slideIdx}get slideTotal(){return this._dataSource?.slides?.length??0}get slides(){return this._dataSource?.slides||[]}get slide(){return(this._dataSource?.slides||[])[this._slideIdx]||{}}findNode(t){let e=this._dataSource?.slides?.find(((t,e)=>e==this._slideIdx)),i=e?.svg,n=(e,i)=>{let r=e?.find((e=>e.id==t));if(r)return r;let a=0,s=e.length||0;for(;a<s&&!r&&(r=n(e[a].nodes||[],e[a].id),!r);)a++;return r},r=n(i?.nodes||[]);return r?(r.style=r.style??{},r.source=r.source??{},r.animate=r.animate??{},r.interactive=r.interactive??{},r.variable=r.variable??{},r):{id:0,size:{x:0,y:0,width:0,height:0},attribute:{},isfake:!0}}runSlide(t,e,i){let n;if(this.refreshNodeStatus(),this.refreshSlideStatus(),i?(n=this._dataSource?.slides?.find((t=>t.code==i||t.id==i)),n&&(this._slideIdx=this._dataSource?.slides?.indexOf(n)||0)):e?(n=this._dataSource?.slides?.find((t=>t.id==e)),n&&(this._slideIdx=this._dataSource?.slides?.indexOf(n)||0)):(this._slideIdx=Math.min(Math.max(t||0,0),this.slideTotal-1),n=this.slide),n){ur(ls.container,ls.svg,n,!0),jQuery(ls.svg).find("#"+Ti.BACKGROUND_GROUP)?.empty();let t=xr(Ti.BACKGROUND_GROUP,"g",void 0,ls.svg);jr(t,n),(t=>{t.test&&(t.test.answer=void 0);let e=hr.nodeStatus,i=hr.slideStatus;t.svg?.nodes.forEach((t=>{t.pid=Math.ceil(1e9*Math.random()),Ln(t.pid)}));let n=t.svg?.nodes?.map((t=>t.idx??0)).filter(((t,e,i)=>i.indexOf(t)==e)).sort(((t,e)=>(t??0)-(e??0)));cr(t.svg?.nodes??[],n??[],{slide:t,nodeStatus:e,slideStatus:i})})(n)}this.changeSlide(this.slides,this.slide?.id,this.slideIdx,this.slides.length,n)}set onChangeSlide(t){this._fnChangeSlides.push(t)}changeSlide(t,e,i,n,r){this._fnChangeSlides.forEach((a=>a(t,e,i,n,r)))}},ur=(t,e,i,n)=>{let r=window.document.querySelector(e);r||(r=document.createElementNS("http://www.w3.org/2000/svg","svg"),window.document.querySelector(t)?.appendChild(r)),n&&(r.textContent=null);let{x:a,y:s,width:o,height:l}=i?.svg?.viewBox??ls.screen.frameSize;r.setAttributeNS(null,"viewBox",a+" "+s+" "+o+" "+l),r.setAttribute("id",e.replace("#",""));var c,d,h=jQuery(t).width()??1080,u=jQuery(t).height()??1080,f=o/l;f>=h/u?d=(c=h)/f:c=(d=u)*f,r.setAttributeNS(null,"width",c.toString()),r.setAttributeNS(null,"height",d.toString())};class fr{constructor(t,e){let i=window.document.querySelector(e);i||(i=window.document.createElementNS("http://www.w3.org/2000/svg","svg"),window.document.querySelector(t)?.appendChild(i));let{svgViewBox:n,svgSize:r}=ls.screen.init();i.setAttributeNS(null,"viewBox",`${n.x} ${n.y} ${n.width} ${n.height}`),i.setAttribute("id",e.replace("#","")),i.style.display="block",i.style.width=`${r.width}px`,i.style.height=`${r.height}px`,i.style.backgroundColor="#fafafa",i.style.cursor="default"}}const gr=t=>{jQuery(ls.target).find("#"+Ti.BACKGROUND_GROUP).empty();let e=xr(Ti.BACKGROUND_GROUP,"g",void 0,ls.target);jr(e,t),(()=>{let e=window.document.getElementById(t?.id);jQuery(e).find("#"+Ti.BACKGROUND_GROUP).empty();let i=xr(Ti.BACKGROUND_GROUP,"g",void 0,e);jr(i,t)})()},pr=()=>{let t=ls.screen.svgViewBox,e=ls.screen.svgSize;ls.target&&(ls.target.setAttributeNS(null,"viewBox",`${t.x} ${t.y} ${t.width} ${t.height}`),ls.target.style.left=`${e.x}px`,ls.target.style.top=`${e.y}px`,ls.target.style.width=`${e.width}px`,ls.target.style.height=`${e.height}px`)},yr=()=>{jQuery(ls.target).find(">*:not(defs)").remove()},mr=(t,e,i,n,r)=>{let a;if(!i)switch(e){case Ri.GROUP:i="g";break;case Ri.CIRCLE:i="circle";break;case Ri.ELLIPSE:i="ellipse";break;case Ri.LINE:i="line";break;case Ri.RECT:i="rect";break;case Ri.POLYGON:i="polygon";break;case Ri.POLYLINE:i="polyline";break;case Ri.PATH:i="path";break;case Ri.FOREIGNOBJECT:i="foreignObject";break;case Ri.IMAGE:i="image";break;case Ri.TEXT:i="text";break;case Ri.TSPAN:i="tspan"}if(e&&n?.size&&n?.attribute&&Object.assign(n.attribute,Jn(e,n.size,n.attribute)),t)if(a=jQuery(r||ls.target).find("#"+t).get(0),a){if(a.nodeName!=i){let n=window.document.createElementNS("http://www.w3.org/2000/svg",i);n.setAttribute("id",t),e==Ri.FOREIGNOBJECT&&n.setAttribute("xmlns:html","http://www.w3.org/1999/xhtml"),jQuery(a).replaceWith(n),a=n}}else a=window.document.createElementNS("http://www.w3.org/2000/svg",i),a.setAttribute("id",t),e==Ri.FOREIGNOBJECT&&a.setAttribute("xmlns:html","http://www.w3.org/1999/xhtml"),jQuery(a).appendTo(r||ls.target);else a=window.document.createElementNS("http://www.w3.org/2000/svg",i),jQuery(a).appendTo(r||ls.target);return n?.attribute&&vr(a,n?.attribute),n?.style&&br(a,n?.style),n?.source&&wr(a,e,n?.source,t),a},vr=(t,e)=>{var i;return jQuery(t).attr((i=Object.assign({},e||{}),Object.keys(i)?.forEach((t=>{switch(t){case"fill":break;case"fillRule":Object.assign(i,{"fill-rule":i.fillRule??null,fillRule:null});break;case"stroke":Object.assign(i,{"stroke-width":i.strokeWidth??null,strokeWidth:null});break;case"strokeLinecap":Object.assign(i,{"stroke-linecap":i.strokeLinecap??null,strokeLinecap:null});break;case"strokeLinejoin":Object.assign(i,{"stroke-linejoin":i.strokeLinejoin??null,strokeLinejoin:null});break;case"strokeMiterlimit":Object.assign(i,{"stroke-miterlimit":i.strokeMiterlimit??null,strokeMiterlimit:null});break;case"strokeDasharray":Object.assign(i,{"stroke-dasharray":i.strokeDasharray??null,strokeDasharray:null});break;case"strokeDasharrays":Object.assign(i,{"stroke-dasharray":i.strokeDasharrays?.join(" ")??null,strokeDasharrays:null});break;case"fontFamily":Object.assign(i,{"font-family":i.fontFamily??null,fontFamily:null});break;case"fontWeight":Object.assign(i,{"font-weight":i.fontWeight??null,fontWeight:null});break;case"fontStyle":Object.assign(i,{"font-style":i.fontStyle??null,fontStyle:null});break;case"fontSize":Object.assign(i,{"font-size":i.fontSize??null,fontSize:null});break;case"textLength":Object.assign(i,{textLength:i.textLength?`${i.textLength}px`:null});break;case"letterSpacing":Object.assign(i,{"letter-spacing":i.letterSpacing??null,letterSpacing:null});break;case"wordSpacing":Object.assign(i,{"word-spacing":i.wordSpacing??null,wordSpacing:null});break;case"alignmentBaseline":Object.assign(i,{"alignment-baseline":i.alignmentBaseline??null,alignmentBaseline:null});break;case"dominantBaseline":Object.assign(i,{"dominant-baseline":i.dominantBaseline??null,dominantBaseline:null});break;case"textAnchor":Object.assign(i,{"text-anchor":i.textAnchor??null,textAnchor:null});break;case"textDecoration":Object.assign(i,{"text-decoration":i.textDecoration??null,textDecoration:null});break;case"transformOrigin":Object.assign(i,{"transform-origin":i.transformOrigin??null,transformOrigin:null})}})),Object.assign({},i??{},{fill:i?.fill?on(i.fill,i?.fillOpacity??1):"rgba(0,0,0,0)",fillOpacity:null,stroke:i?.stroke?on(i.stroke,i?.strokeOpacity??1):"rgba(0,0,0,0)",strokeOpacity:null}))),t},br=(t,e)=>{return jQuery(t).css((i=Object.assign({},e||{}),Object.keys(i)?.forEach((t=>{switch(t){case"padding":Object.assign(i,{padding:i.padding?`${i.padding}px`:null});break;case"borderWidth":i.borderWidth&&i.borderColor?Object.assign(i,{"border-width":`${i.borderWidth}px`,"border-style":i.borderStyle||"solid","border-color":on(i.borderColor,i.borderOpacity??1)}):Object.assign(i,{"border-width":"","border-style":"","border-color":""}),Object.assign(i,{borderWidth:null,borderStyle:null,borderColor:null,borderOpacity:null});break;case"borderRadius":Object.assign(i,{"border-radius":i.borderRadius?`${i.borderRadius}px`:null,borderRadius:null});break;case"backgroundColor":i.backgroundColor?Object.assign(i,{"background-color":on(i.backgroundColor,i.backgroundOpacity??1)}):Object.assign(i,{"background-color":""}),Object.assign(i,{backgroundColor:null,backgroundOpacity:null})}})),i)),t;var i},wr=(t,e,i,n)=>{switch(e){case Ri.TEXT:{let e=n==ls.dataSelect.contenteditable_id,r=i?.text?.textContent||"Hãy nhập nội dung của bạn!";if(!e&&i?.text?.variableKeywords&&i?.text?.variableKeywords.length){let t=ls.variable.getKeys();i.text.variableKeywords.forEach((e=>{var i=e.replace(/[^a-zA-Z0-9_]/gm,"");if(t.indexOf(i)>=0){var n=ls.variable.getValue(i);r=r.replace(e,n)}}))}e?jQuery(t).attr("editable",`${e}`).html(`<div contenteditable="${e}" xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`):jQuery(t).attr("editable",`${e}`).text(r);break}case Ri.TSPAN:jQuery(t).text(i?.text?.textContent??"");break;case Ri.IMAGE:jQuery(t).attr("href",i?.image?.base64||(i?.image?.path?ls.config?.readfileuploadurl+i?.image?.path:i?.image?.url)||"");break;case Ri.FOREIGNOBJECT:switch(i?.type){case"text":{let e=n==ls.dataSelect.contenteditable_id,r=i.text?.textContent||"Hãy nhập nội dung của bạn!";if(!e&&i.text?.variableKeywords&&i.text?.variableKeywords.length){let t=ls.variable.getKeys();i.text.variableKeywords.forEach((e=>{var i=e.replace(/[^a-zA-Z0-9_]/gm,"");if(t.indexOf(i)>=0){var n=ls.variable.getValue(i);r=r.replace(e,n)}}))}e?jQuery(t).attr("editable",`${e}`).html(`<div contenteditable="${e}" xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`):jQuery(t).attr("editable",`${e}`).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`);break}case"html":{let e=n==ls.dataSelect.contenteditable_id,r=i?.html?.htmlContent||'<span style="font-family: Roboto; font-size: 24px;">Hãy nhập nội dung của bạn!</span>';if(!e&&i.html?.variableKeywords&&i.html?.variableKeywords.length){let t=ls.variable.getKeys();i.html.variableKeywords.forEach((e=>{var i=e.replace(/[^a-zA-Z0-9_]/gm,"");if(t.indexOf(i)>=0){var n=ls.variable.getValue(i);r=r.replace(e,n)}}))}jQuery(t).attr("editable",`${e}`).html(`<div contenteditable="${e}" xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`).find("img[path],video[path],iframe[path]").each(((t,e)=>{e.setAttribute("src",(ls.config?.readfileuploadurl??"")+e.getAttribute("path")),e.removeAttribute("path")}));break}case"input":i.input?.input?jQuery(t).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;"><input type="text" placeholder="${i.input?.placeholder??""}" maxlength="100" /></div>`):i.input?.textarea&&jQuery(t).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;"><textarea placeholder="${i.input?.placeholder??""}" maxlength="1000"></textarea></div>`);break;case"image":jQuery(t).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;"><img src="${i.image?.base64||(i.image?.path?ls.config?.readfileuploadurl+i.image?.path:i.image?.url)||""}" style="width:100%;height:100%;display:block;"/></div>`);break;case"iframe":jQuery(t).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;"><iframe src="${(i.iframe?.path?ls.config?.readfileuploadurl+i.iframe?.path:i.iframe?.url)||""}" frameborder="0" allowfullscreen\n                    webkitallowfullscreen allowtransparency="true" allow="fullscreen" style="width:100%;height:100%;display:block;"></iframe></div>`);break;case"embed":{let e=ln({readfileuploadurl:ls.config?.readfileuploadurl,type:i.embed?.type,oss:i.embed?.oss,path:i.embed?.path,url:i.embed?.url});jQuery(t).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;"><iframe src="${e}" frameborder="0" allowfullscreen\n                    webkitallowfullscreen allowtransparency="true" allow="fullscreen" style="width:100%;height:100%;display:block;"></iframe></div>`);break}case"svg":jQuery(t).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;">${i.svg?.svgContent??""}</div>`);break;case"test":{let e=n==ls.dataSelect.contenteditable_id,r=i?.html?.htmlContent||"";if(!e&&i.html?.variableKeywords&&i.html?.variableKeywords.length){let t=ls.variable.getKeys();i.html.variableKeywords.forEach((e=>{var i=e.replace(/[^a-zA-Z0-9_]/gm,"");if(t.indexOf(i)>=0){var n=ls.variable.getValue(i);r=r.replace(e,n)}}))}switch(i?.test?.type){case"truefalse":e?jQuery(t).attr("editable",`${e}`).html(`<div contenteditable="${e}" xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`):jQuery(t).attr("editable",`${e}`).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;" data-node="test" data-type="${i?.test.type}" data-correct="${i?.test.truefalse?.iscorrect?1:0}"><div style="display:flex;align-items:center;width:100%;height:100%;"><div style="width:100%">${r}</div></div></div>`);break;case"singlechoice":e?jQuery(t).attr("editable",`${e}`).html(`<div contenteditable="${e}" xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`):jQuery(t).attr("editable",`${e}`).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;" data-node="test" data-type="${i?.test.type}" data-correct="${i?.test.singlechoice?.iscorrect?1:0}"><div style="display:flex;align-items:center;width:100%;height:100%;"><div style="width:100%">${r}</div></div></div>`);break;case"multichoice":e?jQuery(t).attr("editable",`${e}`).html(`<div contenteditable="${e}" xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`):jQuery(t).attr("editable",`${e}`).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;" data-node="test" data-type="${i?.test.type}" data-correct="${i?.test.multichoice?.iscorrect?1:0}"><div style="display:flex;align-items:center;width:100%;height:100%;"><div style="width:100%">${r}</div></div></div>`);break;case"matching-empty":jQuery(t).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;" class="ondrop-here" data-node="test" data-type="matching" data-type2="matching-empty" data-key="${i?.test.matching?.key}"></div>`);break;case"matching-content":e?jQuery(t).attr("editable",`${e}`).html(`<div contenteditable="${e}" xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`):jQuery(t).attr("editable",`${e}`).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;" class="ondrop-here" data-node="test" data-type="matching" data-type2="matching-content" data-key="${i?.test.matching?.key}"><div class="ondrag-item" data-key="${i?.test?.matching?.key??"MIDDLEKIEN"}"><div style="display:flex;align-items:center;width:100%;height:100%;"><div style="width:100%">${r}</div></div></div></div>`);break;case"fill":e||(i.html?.fillKeywords||[]).forEach((t=>{var e=`<input type="text" maxlength="128" style="display:inline-block;width:100px;min-width:100px;max-width:100%;padding:0px 10px;margin:0px;box-sizing:border-box;outline:none;box-shadow:none;border-width:0px 0px 1px;border-top-style:initial;border-right-style:initial;border-left-style:initial;border-top-color:initial;border-right-color:initial;border-left-color:initial;border-image:initial;border-bottom-style:dashed;border-bottom-color:rgb(123,146,254);background:transparent;animation:0.3s ease-in-out 0s 1 normal none running width;text-align:inherit;" data-key="${t.replace(/[^a-zA-Z0-9]+/gm,"")}"/>`;r=r.replace(new RegExp(t.replace(/\[/g,"\\[").replace(/\]/g,"\\]"),"g"),e)})),e?jQuery(t).attr("editable",`${e}`).html(`<div contenteditable="${e}" xmlns="http://www.w3.org/1999/xhtml" style="width:100%;min-height:100%;display:block;">${r}</div>`):jQuery(t).attr("editable",`${e}`).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;" data-node="test"><div style="display:flex;align-items:center;width:100%;height:100%;"><div style="width:100%">${r}</div></div></div>`);break;case"speech":jQuery(t).html('<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;" data-node="test"><div style="display:flex;align-items:center;width:100%;height:100%;"><img src="images/svg/component/microphone4.svg" width="60" height="60"/></div></div>');break;case"submit":jQuery(t).html(`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;display:block;" data-node="test"><img src="${(i.image?.path?ls.config?.readfileuploadurl+i.image?.path:i.image?.url)??""}" style="width:100%;height:100%;display:block;"/></div>`)}jQuery(t).find("img[path],video[path],iframe[path]").each(((t,e)=>{e.setAttribute("src",(ls.config?.readfileuploadurl??"")+e.getAttribute("path")),e.removeAttribute("path")}))}}}},Sr=(t,e)=>(e?jQuery(t).css({filter:"url(#nodeSelected)"}):jQuery(ls.target).find("[style]").css("filter",""),t),xr=(t,e,i,n)=>{let r=jQuery(n||ls.target).find("#"+t).get(0);return r||(r=window.document.createElementNS("http://www.w3.org/2000/svg",e),r.setAttribute("id",t),jQuery(r).appendTo(n||ls.target)),jQuery(r).attr(i?.attribute||{}),jQuery(r).css(i?.style||{}),r},_r=(t,e)=>{let i=un(2),n={fill:Di.fill,stroke:Di.stroke,"stroke-width":un(Di.strokeWidth)};return[{element:xr("icdt-temp-create-rect-center","rect",{attribute:Object.assign({x:e.x-i,y:e.y-i,width:e.width+2*i,height:e.height+2*i},n)},t),posType:"rect-center"}]},kr=(t,e)=>{let i=[],{size:n}=e,r=un(1),a=un(2),s=un(3),o=(un(5),un(7),un(10)),l={stroke:Qi.stroke,"stroke-width":un(Qi.strokeWidth),"stroke-linecap":Qi.strokeLinecap,"stroke-dasharray":Qi.strokeDasharrays.map((t=>un(t))).join(" ")},c={fill:Wi.fill,stroke:Wi.stroke,"stroke-width":un(Wi.strokeWidth)},d={fill:Ui.fill,stroke:Ui.stroke,"stroke-width":un(Ui.strokeWidth),width:un(Ui.width),height:un(Ui.height)},h={fill:Ui.fill,stroke:Ui.stroke,"stroke-width":un(Ui.strokeWidth),width:un(Ui.width),height:un(Ui.height)},u=xr("icdt-temp-resize-rect-center","rect",{attribute:Object.assign({x:n.x,y:n.y,width:n.width,height:n.height},c),style:{cursor:"move"}},t);if(xr("icdt-temp-resize-line-left","line",{attribute:Object.assign({x1:n.x-r,y1:n.y-r,x2:n.x-r,y2:n.y+n.height+r},l)},t),xr("icdt-temp-resize-line-top","line",{attribute:Object.assign({x1:n.x-r,y1:n.y-r,x2:n.x+n.width+r,y2:n.y-r},l)},t),xr("icdt-temp-resize-line-right","line",{attribute:Object.assign({x1:n.x+n.width+r,y1:n.y-r,x2:n.x+n.width+r,y2:n.y+n.height+r},l)},t),xr("icdt-temp-resize-line-bottom","line",{attribute:Object.assign({x1:n.x-r,y1:n.y+n.height+r,x2:n.x+n.width+r,y2:n.y+n.height+r},l)},t),e.type==Ri.LINE){let{size:n}=e,s=[];return n.ratios?.forEach((function(t){s.push([n.x+n.width*t[0],n.y+n.height*t[1]])})),s.forEach(((e,n)=>{i.push({posType:`point-${n}`,element:xr(`icdt-temp-resize-point-${n+1}`,"circle",{attribute:Object.assign(Jn(Ri.CIRCLE,{x:e[0]-a-r,y:e[1]-a-r,width:h.width,height:h.height},{}),h)},t)})})),i.concat([{element:u,posType:"rect-center"}])}if(e.type==Ri.POLYGON){let{size:n}=e,s=[];n.ratios?.forEach((function(t){s.push([n.x+n.width*t[0],n.y+n.height*t[1]])})),s.forEach(((e,n)=>{i.push({posType:`point-${n}`,element:xr(`icdt-temp-resize-point-${n+1}`,"circle",{attribute:Object.assign(Jn(Ri.CIRCLE,{x:e[0]-a-r,y:e[1]-a-r,width:h.width,height:h.height},{}),h)},t)})}))}let f=xr("icdt-temp-resize-rect-top-left","rect",{attribute:Object.assign({x:n.x-o,y:n.y-o},d),style:{cursor:"nw-resize"}},t),g=xr("icdt-temp-resize-rect-top-right","rect",{attribute:Object.assign({x:n.x+n.width+s,y:n.y-o},d),style:{cursor:"ne-resize"}},t),p=xr("icdt-temp-resize-rect-bottom-left","rect",{attribute:Object.assign({x:n.x-o,y:n.y+n.height+s},d),style:{cursor:"sw-resize"}},t),y=xr("icdt-temp-resize-rect-bottom-right","rect",{attribute:Object.assign({x:n.x+n.width+s,y:n.y+n.height+s},d),style:{cursor:"se-resize"}},t),m=xr("icdt-temp-resize-rect-left","rect",{attribute:Object.assign({x:n.x-o,y:n.y+n.height/2-a-r},d),style:{cursor:"w-resize"}},t),v=xr("icdt-temp-resize-rect-top","rect",{attribute:Object.assign({x:n.x+n.width/2-a-r,y:n.y-o},d),style:{cursor:"n-resize"}},t),b=xr("icdt-temp-resize-rect-right","rect",{attribute:Object.assign({x:n.x+n.width+s,y:n.y+n.height/2-a-r},d),style:{cursor:"e-resize"}},t),w=xr("icdt-temp-resize-rect-bottom","rect",{attribute:Object.assign({x:n.x+n.width/2-a-r,y:n.y+n.height+s},d),style:{cursor:"s-resize"}},t);return i.concat([{element:u,posType:"rect-center"},{element:f,posType:"rect-top-left"},{element:g,posType:"rect-top-right"},{element:p,posType:"rect-bottom-left"},{element:y,posType:"rect-bottom-right"},{element:m,posType:"rect-left"},{element:v,posType:"rect-top"},{element:b,posType:"rect-right"},{element:w,posType:"rect-bottom"}])},Or=(t,e,i)=>{let n=un(1),r=un(2),a=un(5),s={stroke:Qi.stroke,"stroke-width":un(Qi.strokeWidth),"stroke-linecap":Qi.strokeLinecap},o={fill:Wi.fill,stroke:Wi.stroke,"stroke-width":un(Wi.strokeWidth)},l={fill:Ui.fill,stroke:Ui.stroke,"stroke-width":un(Ui.strokeWidth),width:un(Ui.width),height:un(Ui.height)},c={fill:Hi.fill,rx:un(Hi.rx)},d={fill:Xi.fill,"alignment-baseline":Xi.alignmentBaseline,"text-anchor":Xi.textAnchor,"font-size":un(Xi.fontSize)},h={fill:Vi.fill,stroke:Vi.stroke,"stroke-width":un(Vi.strokeWidth)},u=(xr("icdt-temp-resize-line-left","line",{attribute:Object.assign({x1:i.x-n,y1:i.y-n,x2:i.x-n,y2:i.y+i.height+n},s)},t),xr("icdt-temp-resize-line-top","line",{attribute:Object.assign({x1:i.x-n,y1:i.y-n,x2:i.x+i.width+n,y2:i.y-n},s)},t),xr("icdt-temp-resize-line-right","line",{attribute:Object.assign({x1:i.x+i.width+n,y1:i.y-n,x2:i.x+i.width+n,y2:i.y+i.height+n},s)},t),xr("icdt-temp-resize-line-bottom","line",{attribute:Object.assign({x1:i.x-n,y1:i.y+i.height+n,x2:i.x+i.width+n,y2:i.y+i.height+n},s)},t),xr("icdt-temp-resize-rect-center","rect",{attribute:Object.assign({x:i.x,y:i.y,width:i.width,height:i.height},o)},t)),f=`${i.width} x ${i.height}`,g=8*f.length;return xr("icdt-temp-select-rect-text","rect",{attribute:Object.assign({x:i.x+i.width/2-un(g/2),y:i.y+i.height+un(10),width:un(g),height:un(20)},c)},t),xr("icdt-temp-select-text","text",{attribute:Object.assign({x:i.x+i.width/2,y:i.y+i.height+un(20)},d)},t).textContent=f,e.length>1&&e.forEach((e=>{let{size:i}=e;xr("icdt-temp-select-rect-node-"+e.id,"rect",{attribute:Object.assign({x:i.x,y:i.y,width:i.width,height:i.height},h)},t)})),[{element:u,posType:"rect-center"},{element:xr("icdt-temp-resize-rect-top-left","rect",{attribute:Object.assign({x:i.x-a,y:i.y-a},l),style:{cursor:"nw-resize"}},t),posType:"rect-top-left"},{element:xr("icdt-temp-resize-rect-top-right","rect",{attribute:Object.assign({x:i.x+i.width-r,y:i.y-a},l),style:{cursor:"ne-resize"}},t),posType:"rect-top-right"},{element:xr("icdt-temp-resize-rect-bottom-left","rect",{attribute:Object.assign({x:i.x-a,y:i.y+i.height-r},l),style:{cursor:"sw-resize"}},t),posType:"rect-bottom-left"},{element:xr("icdt-temp-resize-rect-bottom-right","rect",{attribute:Object.assign({x:i.x+i.width-r,y:i.y+i.height-r},l),style:{cursor:"se-resize"}},t),posType:"rect-bottom-right"},{element:xr("icdt-temp-resize-rect-left","rect",{attribute:Object.assign({x:i.x-a,y:i.y+i.height/2-r-n},l),style:{cursor:"w-resize"}},t),posType:"rect-left"},{element:xr("icdt-temp-resize-rect-top","rect",{attribute:Object.assign({x:i.x+i.width/2-r-n,y:i.y-a},l),style:{cursor:"n-resize"}},t),posType:"rect-top"},{element:xr("icdt-temp-resize-rect-right","rect",{attribute:Object.assign({x:i.x+i.width-r,y:i.y+i.height/2-r-n},l),style:{cursor:"e-resize"}},t),posType:"rect-right"},{element:xr("icdt-temp-resize-rect-bottom","rect",{attribute:Object.assign({x:i.x+i.width/2-r-n,y:i.y+i.height-r},l),style:{cursor:"s-resize"}},t),posType:"rect-bottom"}]},Nr=(t,e,i)=>{let n=un(1),r={stroke:Qi.stroke,"stroke-width":un(Qi.strokeWidth),"stroke-linecap":Qi.strokeLinecap},a={fill:Wi.fill,stroke:Wi.stroke,"stroke-width":un(Wi.strokeWidth)},s={fill:Vi.fill,stroke:Vi.stroke,"stroke-width":un(Vi.strokeWidth)},o=(xr("icdt-temp-select-line-left","line",{attribute:Object.assign({x1:i.x-n,y1:i.y,x2:i.x-n,y2:i.y+i.height},r)},t),xr("icdt-temp-select-line-top","line",{attribute:Object.assign({x1:i.x,y1:i.y-n,x2:i.x+i.width,y2:i.y-n},r)},t),xr("icdt-temp-select-line-right","line",{attribute:Object.assign({x1:i.x+i.width+n,y1:i.y,x2:i.x+i.width+n,y2:i.y+i.height},r)},t),xr("icdt-temp-select-line-bottom","line",{attribute:Object.assign({x1:i.x,y1:i.y+i.height+n,x2:i.x+i.width,y2:i.y+i.height+n},r)},t),xr("icdt-temp-select-rect-center","rect",{attribute:Object.assign({x:i.x,y:i.y,width:i.width,height:i.height},a)},t));return e.forEach((e=>{let{size:i}=e;xr("icdt-temp-select-rect-node-"+e.id,"rect",{attribute:Object.assign({x:i.x,y:i.y,width:i.width,height:i.height},s)},t)})),[{element:o,posType:"rect-center"}]},Er=(t,e)=>{let i=un(1),n={stroke:Qi.stroke,"stroke-width":un(Qi.strokeWidth),"stroke-linecap":Qi.strokeLinecap},r={fill:Wi.fill,stroke:Wi.stroke,"stroke-width":un(Wi.strokeWidth)};return xr("icdt-temp-scan-line-left","line",{attribute:Object.assign({x1:e.x-i,y1:e.y,x2:e.x-i,y2:e.y+e.height},n)},t),xr("icdt-temp-scan-line-top","line",{attribute:Object.assign({x1:e.x,y1:e.y-i,x2:e.x+e.width,y2:e.y-i},n)},t),xr("icdt-temp-scan-line-right","line",{attribute:Object.assign({x1:e.x+e.width+i,y1:e.y,x2:e.x+e.width+i,y2:e.y+e.height},n)},t),xr("icdt-temp-scan-line-bottom","line",{attribute:Object.assign({x1:e.x,y1:e.y+e.height+i,x2:e.x+e.width,y2:e.y+e.height+i},n)},t),[{element:xr("icdt-temp-scan-rect-center","rect",{attribute:Object.assign({x:e.x,y:e.y,width:e.width,height:e.height},r)},t),posType:"rect-center"}]},Ir=(t,e)=>{un(-1),qi.stroke,un(qi.strokeWidth),qi.strokeLinecap,un(qi.strokeDasharray);let i={fill:Yi.fill};return xr("icdt-temp-interactive-rect-center","rect",{attribute:Object.assign({x:e.x,y:e.y,width:e.width,height:e.height,class:"cursor-draw"},i)},t),[]},zr=(t,e)=>{let i={fill:Zi.fill,stroke:Zi.stroke,"stroke-width":un(Zi.strokeWidth),"stroke-dasharray":un(Zi.strokeDasharray)};jQuery(t).empty(),e.forEach((n=>{let{size:r}=n;if(!n.idx)return;xr("icdt-temp-index-rect-node-"+n.id,"rect",{attribute:Object.assign({x:r.x-5,y:r.y-5,width:r.width+10,height:r.height+10},i)},t);let{element:a}=ar(Math.ceil(1e9*Math.random()),{size:{x:r.x-76,y:r.y-6,width:70,height:80},attribute:{},style:{},source:{type:"html",html:{htmlContent:`<div class="position-slide" style="position:relative;width:100%;height:100%;">\n                  <div style="position:absolute;top:0;right:0;line-height:22px;">\n                    <div title="Thứ tự xuất hiện">\n                        <div style="float:right;">\n                          <span style="display:block;width:18px;float:left;text-align:center;">\n                            <i class="fa fa-play" style="margin:6px 0;color:#7da7d9;font-size:12px;"></i>\n                          </span>\n                          <span style="display:block;width:50px;float:left;">\n                            <input type="number" name="idx" value="${n.idx??0}" min="0" max="999" step="1" style="box-sizing:border-box;width:100%;padding:0;border:1px solid #ddd;outline:0;text-align:center;background:#eee;background: radial-gradient(#fff, #eee);font-size:12px;">\n                          </span>\n                        </div>\n                        <div style="clear:both;"></div>\n                    </div>\n                    <div title="Thời gian đợi(s), nếu giá trị = 0 sẽ chuyển sang đợi hoàn tất hoạt động và âm thanh" style="margin-top:2px;">\n                        <div style="float:right;">\n                          <span style="display:block;width:18px;float:left;text-align:center;">\n                            <i class="fa fa-clock-o" style="margin:5px 0;color:#7da7d9;font-size:14px;"></i>\n                          </span>\n                          <span style="display:block;width:50px;float:left;">\n                            <input type="number" name="time" value="${n.time??0}" min="0" max="999" step="0.5" style="box-sizing:border-box;width:100%;padding:0;border:1px solid #ddd;outline:0;text-align:center;background:#eee;background: radial-gradient(#fff, #eee);font-size:12px;">\n                          </span>\n                        </div>\n                        <div style="clear:both;"></div>\n                    </div>\n                    <div title="Hủy thiết lập" style="margin-top:2px;">\n                        <div style="float:right;">\n                          <button name="remove" style="box-sizing:border-box;width:24px;height:24px;padding:0;border:1px solid #ddd;line-height: 0;outline:none;background:#eee;background: radial-gradient(#fff, #eee);">\n                            <img src="assets/icon-png/xoa2.png" height="18">\n                          </button>\n                        </div>\n                        <div style="clear:both;"></div>\n                    </div>\n                  </div>\n              </div>`}}},t);a.classList.add("node-input"),jQuery(a).on("change",'input[name="idx"]',(t=>{n.idx=parseInt(t.target.value??"0")})).on("change",'input[name="time"]',(t=>{n.time=parseFloat(t.target.value??"0")})).on("click",'button[name="remove"]',(i=>{n.idx=0,n.time=null,zr(t,e)}))}))},jr=(t,e)=>{let{color:i,opacity:n,path:r,url:a,base64:s}=e?.svg?.background??{},{x:o,y:l,width:c,height:d}=e?.svg?.viewBox??{x:0,y:0,width:0,height:0};Mn(void 0,{size:{x:0,y:un(-10),width:100,height:20},attribute:{fill:"#999",textAnchor:"start",alignmentBaseline:"central",fontSize:un(12),class:"hide-on-viewer"},source:{type:"text",text:{textContent:e?.name??e?.code??void 0}}},t),fn(void 0,{size:{x:o,y:l,width:c,height:d},attribute:{fill:"#fff",stroke:"#999",strokeWidth:un(1),strokeDasharray:un(10),class:"hide-on-viewer"}},t),i&&fn(void 0,{size:{x:o,y:l,width:c,height:d},attribute:{fill:i,fillOpacity:n}},t),r&&gn(void 0,{size:{x:o,y:l,width:c,height:d},source:{type:"image",image:{path:r,url:a,base64:s}}},t)},Jr=(t,e,i)=>{switch(jQuery(t).empty(),e.test?.type){case"truefalse":if(e.test?.showselection){let i=e?.test?.answer?.truefalse?.value;e.svg?.nodes.filter((t=>"truefalse"==t.source?.test?.type&&t.id!=i)).forEach((e=>{let{x:i,y:n,width:r,height:a}=e?.size??{x:0,y:0,width:0,height:0};pn(Math.ceil(1e9*Math.random()),{size:{x:i-.5,y:n-.5,width:r+1,height:a+1},attribute:{fill:"none",stroke:"#5F6CE1",strokeWidth:1,strokeDasharray:4}},t)})),e?.test?.answer?.truefalse&&i&&(()=>{let e=hr.findNode(i),{x:n,y:r,width:a,height:s}=e?.size??{x:0,y:0,width:0,height:0};pn(Math.ceil(1e9*Math.random()),{size:{x:n-2,y:r-2,width:a+4,height:s+4},attribute:{fill:"none",stroke:"#5F6CE1",strokeWidth:4}},t)})()}break;case"singlechoice":if(e.test?.showselection){let i=e?.test?.answer?.singlechoice?.value;e.svg?.nodes.filter((t=>"singlechoice"==t.source?.test?.type&&t.id!=i)).forEach((e=>{let{x:i,y:n,width:r,height:a}=e?.size??{x:0,y:0,width:0,height:0};pn(Math.ceil(1e9*Math.random()),{size:{x:i-.5,y:n-.5,width:r+1,height:a+1},attribute:{fill:"none",stroke:"#5F6CE1",strokeWidth:1,strokeDasharray:4}},t)})),e?.test?.answer?.singlechoice&&i&&(()=>{let e=hr.findNode(i),{x:n,y:r,width:a,height:s}=e?.size??{x:0,y:0,width:0,height:0};pn(Math.ceil(1e9*Math.random()),{size:{x:n-2,y:r-2,width:a+4,height:s+4},attribute:{fill:"none",stroke:"#5F6CE1",strokeWidth:4}},t)})()}break;case"multichoice":if(e.test?.showselection){let i=e?.test?.answer?.multichoice?.map((t=>t.value))??[];e.svg?.nodes.filter((t=>"multichoice"==t.source?.test?.type&&!i.includes(t.id))).forEach((e=>{let{x:i,y:n,width:r,height:a}=e?.size??{x:0,y:0,width:0,height:0};fn(Math.ceil(1e9*Math.random()),{size:{x:i-.5,y:n-.5,width:r+1,height:a+1},attribute:{fill:"none",stroke:"#5F6CE1",strokeWidth:1,strokeDasharray:4}},t)})),e?.test?.answer?.multichoice&&i.length&&e?.test?.answer?.multichoice.forEach((e=>{let i=hr.findNode(e.value),{x:n,y:r,width:a,height:s}=i?.size??{x:0,y:0,width:0,height:0};fn(Math.ceil(1e9*Math.random()),{size:{x:n-2,y:r-2,width:a+4,height:s+4},attribute:{fill:"none",stroke:"#5F6CE1",strokeWidth:4}},t)}))}break;case"fill":e?.test?.answer?.fill&&e?.test?.answer?.fill.forEach((t=>{jQuery("#"+i.id).find(`input[type="text"][data-key="${t.key}"]`).val(t.value)}));break;case"matching":e?.test?.answer?.matching&&("matching-empty"==i.source?.test?.type?e?.test?.answer?.matching.filter((t=>t.key==i.source?.test?.matching?.key)).forEach((t=>{})):"matching-content"==i.source?.test?.type&&e?.test?.answer?.matching.filter((t=>t.value==i.source?.test?.matching?.key)).forEach((t=>{})))}};class $r{constructor(t){this._points=[],this._options=t}start(t){this._points.length=0,this._points.push([t.x,t.y]),this._options.start(t)}move(t,e){this._points.push([t.x,t.y]),this._options.move(t,this._points,e)}end(){this._options.end(this.offsetLast,this._points)}get offsetFirst(){return this._points.length>=1?{x:(t=this._points[0])[0],y:t[1]}:{x:0,y:0};var t}get offsetLast(){return this._points.length>=1?{x:(t=this._points[this._points.length-1])[0],y:t[1]}:{x:0,y:0};var t}}const Ar=(t,e,i,n)=>(t.x-=n.x,t.y-=n.y,t.x/=e,t.y/=e,t.x-=i.x,t.y-=i.y,t.x=hn(t.x),t.y=hn(t.y),t),Tr=(t,e,i,n,r)=>{let a=null,s=0,o=0;t.mouseEvent?(a=t.mouseEvent.target,s=t.mouseEvent.offsetX,o=t.mouseEvent.offsetY):t.touchEvent&&(a=t.touchEvent.target,t.touchEvent.touches.length&&(s=t.touchEvent.touches[0].clientX,o=t.touchEvent.touches[0].clientY));let l=i??ls.screen.scale,c=n??ls.screen.dislocation,d=r??ls.screen.offset,h=()=>{};var u=new $r({start:e?.start??h,move:e?.move??h,end:e?.end??h});t.mouseEvent?u.start(Ar({x:s,y:o},l,c,{x:0,y:0})):t.touchEvent&&u.start(Ar({x:s,y:o},l,c,d));let f=t=>{u.move(Ar({x:t.clientX,y:t.clientY},l,c,d),{ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey})},g=t=>{u.end(),[Ci.SHAPE,Ci.FOREIGNOBJECT,Ci.IMAGE,Ci.TEXT].includes(ls.pointer.pointer_type)&&(t.shiftKey||(ls.pointer.pointer_type=Ci.POINTER))},p=t=>{t.touches.length&&f({clientX:t.touches[0].clientX,clientY:t.touches[0].clientY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey})},y=t=>{g({ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey}),window.removeEventListener("touchmove",p,!1),window.removeEventListener("touchend",y,!1)},m=t=>{0==t.button&&f({clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey})},v=t=>{0==t.button&&(g({shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,altKey:t.altKey}),window.removeEventListener("mousemove",m,!1),window.removeEventListener("mouseup",v,!1))};t.mouseEvent?(window.addEventListener("mousemove",m,!1),window.addEventListener("mouseup",v,!1)):t.touchEvent&&(window.addEventListener("touchmove",p,!1),window.addEventListener("touchend",y,!1),a?.addEventListener("touchmove",(function(t){t.preventDefault()})))},Cr=(t,e,i,n,r)=>{let{x:a,y:s,width:o,height:l}=i;0==o&&(o=1),0==l&&(l=1);let c=n.map((t=>Object.assign({},t.size))),d=[],h=!1,u={start:t=>{n.forEach((t=>{let{id:e,size:i,attribute:n}=t;d.push({id:e,type:"size",from:JSON.parse(JSON.stringify({id:e,size:i,attribute:n}))})}))},move:(t,d,u)=>{((t,d,h,u,f)=>{let g=h-t,p=u-d;(()=>{let y,m=(o||1)/(l||1);switch(e){case"rect-center":y=f?.shiftKey?Math.abs(h-t)>=Math.abs(u-d)?{x:a+h-t,y:s,width:o,height:l}:{x:a,y:s+u-d,width:o,height:l}:{x:a+h-t,y:s+u-d,width:o,height:l};break;case"rect-top-left":y=f?.shiftKey&&f?.altKey?m>=1?{x:a+(h-t),y:s+(h-t)/m,width:o-2*(h-t),height:l-2*(h-t)/m}:{x:a+(u-d)*m,y:s+(u-d),width:o-2*(u-d)*m,height:l-2*(u-d)}:f?.shiftKey?m>=1?{x:a+(h-t),y:s+(h-t)/m,width:o-(h-t),height:l-(h-t)/m}:{x:a+(u-d)*m,y:s+(u-d),width:o-(u-d)*m,height:l-(u-d)}:f?.altKey?{x:a+(h-t),y:s+(u-d),width:o-2*(h-t),height:l-2*(u-d)}:{x:a+(h-t),y:s+(u-d),width:o-(h-t),height:l-(u-d)};break;case"rect-top-right":y=f?.shiftKey&&f?.altKey?m>=1?{x:a-(h-t),y:s-(h-t)/m,width:o+2*(h-t),height:l+2*(h-t)/m}:{x:a+(u-d)*m,y:s+(u-d),width:o-2*(u-d)*m,height:l-2*(u-d)}:f?.shiftKey?m>=1?{x:a,y:s-(h-t)/m,width:o+(h-t),height:l+(h-t)/m}:{x:a,y:s+(u-d),width:o-(u-d)*m,height:l-(u-d)}:f?.altKey?{x:a-(h-t),y:s+(u-d),width:o+2*(h-t),height:l-2*(u-d)}:{x:a,y:s+(u-d),width:o+(h-t),height:l-(u-d)};break;case"rect-bottom-left":y=f?.shiftKey&&f?.altKey?m>=1?{x:a+(h-t),y:s+(h-t)/m,width:o-2*(h-t),height:l-2*(h-t)/m}:{x:a-(u-d)*m,y:s-(u-d),width:o+2*(u-d)*m,height:l+2*(u-d)}:f?.shiftKey?m>=1?{x:a+(h-t),y:s,width:o-(h-t),height:l-(h-t)/m}:{x:a-(u-d)*m,y:s,width:o+(u-d)*m,height:l+(u-d)}:f?.altKey?{x:a+(h-t),y:s-(u-d),width:o-2*(h-t),height:l+2*(u-d)}:{x:a+(h-t),y:s,width:o-(h-t),height:l+(u-d)};break;case"rect-bottom-right":y=f?.shiftKey&&f?.altKey?m>=1?{x:a-(h-t),y:s-(h-t)/m,width:o+2*(h-t),height:l+2*(h-t)/m}:{x:a-(u-d)*m,y:s-(u-d),width:o+2*(u-d)*m,height:l+2*(u-d)}:f?.shiftKey?m>=1?{x:a,y:s,width:o+(h-t),height:l+(h-t)/m}:{x:a,y:s,width:o+(u-d)*m,height:l+(u-d)}:f?.altKey?{x:a-(h-t),y:s-(u-d),width:o+2*(h-t),height:l+2*(u-d)}:{x:a,y:s,width:o+(h-t),height:l+(u-d)};break;case"rect-top":y=f?.shiftKey?{x:a+p/2*m,y:s+p,width:o-p*m,height:l-p}:f?.altKey?{x:a,y:s+p,width:o,height:l-2*p}:{x:a,y:s+p,width:o,height:l-p};break;case"rect-bottom":y=f?.shiftKey?{x:a-p/2*m,y:s,width:o+p*m,height:l+p}:f?.altKey?{x:a,y:s-p,width:o,height:l+2*p}:{x:a,y:s,width:o,height:l+p};break;case"rect-left":y=f?.shiftKey?{x:a+g,y:s+g/2/m,width:o-g,height:l-g/m}:f?.altKey?{x:a+g,y:s,width:o-2*g,height:l}:{x:a+g,y:s,width:o-g,height:l};break;case"rect-right":y=f?.shiftKey?{x:a,y:s-g/2/m,width:o+g,height:l+g/m}:f?.altKey?{x:a-g,y:s,width:o+2*g,height:l}:{x:a,y:s,width:o+g,height:l};break;default:y={x:a+h-t,y:s+u-d,width:o,height:l}}y.width<=0&&(y.width=1),y.height<=0&&(y.height=1),y.x=hn(y.x,1),y.y=hn(y.y,1),y.width=hn(y.width,1),y.height=hn(y.height,1),Object.assign(i,y),Or(r,n,y),(()=>{let t=a-y.x,e=s-y.y,i=(y.width-o)/o,r=(y.height-l)/l;n.forEach(((n,o)=>{let l=c[o],d=a-l.x,h=s-l.y,u={x:hn(l.x-(t+d*i),100),y:hn(l.y-(e+h*r),100),width:hn(l.width+l.width*i,100),height:hn(l.height+l.height*r,100)},{id:f,type:g,size:p,attribute:y}=n;Object.assign(p,u),Object.assign(y,Jn(g,p,y)),vr(window.document.getElementById(f),y)}))})()})()})(d[0][0],d[0][1],t.x,t.y,u),h=!0},end:(t,e)=>{h&&(n.forEach((t=>{let{id:e,size:i,attribute:n}=t,r=d.find((t=>t.id==e));r&&(r.to=JSON.parse(JSON.stringify({id:e,size:i,attribute:n})))})),ls.history.push(d))}};Tr(t,u)},Br=(t,e,i,n)=>{let r,{id:a,type:s,size:o,attribute:l}=i,{x:c,y:d,width:h,height:u,ratios:f}=o,g=(h||1)/(u||1),p=null,y=!1;Tr(t,{start:t=>{p=JSON.parse(JSON.stringify({id:a,size:o,attribute:l}))},move:(t,p,m)=>{((t,p,y,m,v)=>{let b=y-t,w=m-p;switch(e){case"rect-center":r=v?.shiftKey?Math.abs(b)>=Math.abs(w)?{x:c+b,y:d,width:h,height:u}:{x:c,y:d+w,width:h,height:u}:{x:c+b,y:d+w,width:h,height:u};break;case"rect-top-left":r=v?.shiftKey&&v?.altKey?g>=1?{x:c+b,y:d+b/g,width:h-2*b,height:u-2*b/g}:{x:c+w*g,y:d+w,width:h-2*w*g,height:u-2*w}:v?.shiftKey?g>=1?{x:c+b,y:d+b/g,width:h-b,height:u-b/g}:{x:c+w*g,y:d+w,width:h-w*g,height:u-w}:v?.altKey?{x:c+b,y:d+w,width:h-2*b,height:u-2*w}:{x:c+b,y:d+w,width:h-b,height:u-w};break;case"rect-top-right":r=v?.shiftKey&&v?.altKey?g>=1?{x:c-b,y:d-b/g,width:h+2*b,height:u+2*b/g}:{x:c+w*g,y:d+w,width:h-2*w*g,height:u-2*w}:v?.shiftKey?g>=1?{x:c,y:d-b/g,width:h+b,height:u+b/g}:{x:c,y:d+w,width:h-w*g,height:u-w}:v?.altKey?{x:c-b,y:d+w,width:h+2*b,height:u-2*w}:{x:c,y:d+w,width:h+b,height:u-w};break;case"rect-bottom-left":r=v?.shiftKey&&v?.altKey?g>=1?{x:c+b,y:d+b/g,width:h-2*b,height:u-2*b/g}:{x:c-w*g,y:d-w,width:h+2*w*g,height:u+2*w}:v?.shiftKey?g>=1?{x:c+b,y:d,width:h-b,height:u-b/g}:{x:c-w*g,y:d,width:h+w*g,height:u+w}:v?.altKey?{x:c+b,y:d-w,width:h-2*b,height:u+2*w}:{x:c+b,y:d,width:h-b,height:u+w};break;case"rect-bottom-right":r=v?.shiftKey&&v?.altKey?g>=1?{x:c-b,y:d-b/g,width:h+2*b,height:u+2*b/g}:{x:c-w*g,y:d-w,width:h+2*w*g,height:u+2*w}:v?.shiftKey?g>=1?{x:c,y:d,width:h+b,height:u+b/g}:{x:c,y:d,width:h+w*g,height:u+w}:v?.altKey?{x:c-b,y:d-w,width:h+2*b,height:u+2*w}:{x:c,y:d,width:h+b,height:u+w};break;case"rect-top":r=v?.shiftKey?{x:c+w/2*g,y:d+w,width:h-w*g,height:u-w}:v?.altKey?{x:c,y:d+w,width:h,height:u-2*w}:{x:c,y:d+w,width:h,height:u-w};break;case"rect-bottom":r=v?.shiftKey?{x:c-w/2*g,y:d,width:h+w*g,height:u+w}:v?.altKey?{x:c,y:d-w,width:h,height:u+2*w}:{x:c,y:d,width:h,height:u+w};break;case"rect-left":r=v?.shiftKey?{x:c+b,y:d+b/2/g,width:h-b,height:u-b/g}:v?.altKey?{x:c+b,y:d,width:h-2*b,height:u}:{x:c+b,y:d,width:h-b,height:u};break;case"rect-right":r=v?.shiftKey?{x:c,y:d-b/2/g,width:h+b,height:u+b/g}:v?.altKey?{x:c-b,y:d,width:h+2*b,height:u}:{x:c,y:d,width:h+b,height:u};break;default:{let t=e.match(/^point-(\d+)/);r=t?{x:c,y:d,width:h,height:u}:{x:c+b,y:d+w,width:h,height:u};break}}r.width<=0&&(r.width=1),r.height<=0&&(r.height=1);let S=e.match(/^point-(\d+)/);if(S){let t=parseInt(S[1]);if("number"==typeof t){r.ratios=f?.map(((e,i)=>i==t?[hn(e[0]+(0==r.width?0:b/r.width),100),hn(e[1]+(0==r.height?0:w/r.height),100)]:e));let e=Rr(r.x,r.y,r.width,r.height,r.ratios??[]),i=Lr(e),n=Mr(i.x,i.y,i.width,i.height,e);r={x:i.x,y:i.y,width:i.width,height:i.height,ratios:n}}}r.x=hn(r.x,1),r.y=hn(r.y,1),r.width=hn(r.width,1),r.height=hn(r.height,1),Object.assign(o,r),Object.assign(l,Jn(s,o,l)),vr(window.document.getElementById(a),l),kr(n,i)})(p[0][0],p[0][1],t.x,t.y,m),y=!0},end:(t,e)=>{y&&p&&ls.history.push([{type:"size",from:p,to:JSON.parse(JSON.stringify({id:a,size:o,attribute:l}))}])}})},Rr=(t,e,i,n,r)=>r.map((r=>[t+i*r[0],e+n*r[1]])),Mr=(t,e,i,n,r)=>r.map((r=>[0==i?0:hn((r[0]-t)/i,100),0==n?0:hn((r[1]-e)/n,100)])),Lr=t=>{let e=[],i=[];t.map((t=>{e.push(t[0]),i.push(t[1])}));let n=Math.min.apply(null,e),r=Math.min.apply(null,i);return{x:n,y:r,width:Math.max.apply(null,e)-n||1,height:Math.max.apply(null,i)-r||1}},Pr=t=>{t.length>1?(t=>{let e=999999,i=999999,n=-999999,r=-999999;t.forEach((t=>{e=Math.min(e,t.size.x),i=Math.min(i,t.size.y),n=Math.max(n,t.size.x+t.size.width),r=Math.max(r,t.size.y+t.size.height)}));let a=xr(Ti.RESIZE_GROUP,"g"),s=jn(e,i,n,r);s.x=hn(s.x,100),s.y=hn(s.y,100),s.width=hn(s.width,100),s.height=hn(s.height,100),Or(a,t,s).forEach((e=>{((t,e,i,n,r)=>{let a=!1;t?.addEventListener("touchstart",(t=>{a=!0,Cr({touchEvent:t},e,i,n,r)})),t?.addEventListener("mousedown",(t=>{0==t.button&&(a?a=!1:Cr({mouseEvent:t},e,i,n,r))}))})(e.element,e.posType,s,t,a)}))})(t):1==t.length&&(t=>{let e=xr(Ti.RESIZE_GROUP,"g");if(t.length>0){let i=t[0];kr(e,i).forEach((t=>{((t,e,i,n)=>{let r=!1;t?.addEventListener("touchstart",(t=>{r=!0,Br({touchEvent:t},e,i,n)})),t?.addEventListener("mousedown",(t=>{0==t.button&&(r?r=!1:Br({mouseEvent:t},e,i,n))}))})(t.element,t.posType,i,e)}))}})(t)},Fr=(t,e,i)=>{let{id:n,type:r,source:a}=t;e=e?.replace(/<[^>]+>/g,"");let s=JSON.parse(JSON.stringify({id:n,type:r,source:a}));a?a.text?(a.text.textContent=e,a.text.variableKeywords=(e??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[]):a.text={textContent:e,variableKeywords:(e??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[]}:a={text:{textContent:e,variableKeywords:(e??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[]}},i||wr(window.document.getElementById(n),r,a),ls.history.push([{type:"source",from:s,to:JSON.parse(JSON.stringify({id:n,type:r,source:a}))}])},Kr=(t,e,i)=>{let{id:n,type:r,source:a}=t,s=JSON.parse(JSON.stringify({id:n,type:r,source:a})),o=t=>(t??"").match(/\{[a-zA-Z0-9_]+\}/gm)??[],l=t=>((t??"").match(/\[\[[a-zA-Z0-9]+\]\]/gm)??[]).filter(((t,e,i)=>i.indexOf(t)==e));a?a.html?(a.html.htmlContent=e,a.html.variableKeywords=o(e),a.html.fillKeywords=l(e)):a.html={htmlContent:e,variableKeywords:o(e),fillKeywords:l(e)}:a={html:{htmlContent:e,variableKeywords:o(e),fillKeywords:l(e)}},"fill"==a.test?.type&&(a.test.fill=l(e).map((t=>({key:t,value:a?.test?.fill?.find((e=>e.key==t))?.value??[]})))),i||wr(window.document.getElementById(n),r,a),ls.history.push([{type:"source",from:s,to:JSON.parse(JSON.stringify({id:n,type:r,source:a}))}])},Gr=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.link?(r.link.url=e.url,r.link.title=e.title,r.link.description=e.description):r.link=e:r={link:e},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},Dr=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.image?(r.image.url=e?.url,r.image.path=e?.path,r.image.name=e?.name,r.image.base64=void 0):r.image=e:r={image:e},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},Qr=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.audio?(r.audio.url=e.url,r.audio.path=e.path,r.audio.name=e.name):r.audio=e:r={audio:e},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},Ur=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.video?(r.video.url=e.url,r.video.path=e.path,r.video.name=e.name):r.video=e:r={video:e},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},Wr=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.file?(r.file.url=e.url,r.file.path=e.path,r.file.name=e.name):r.file=e:r={file:e},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},Vr=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.iframe?(r.iframe.url=e?.url,r.iframe.path=e?.path,r.iframe.name=e?.name):r.iframe=e:r={iframe:e},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},Hr=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.track?(r.track.url=e.url,r.track.path=e.path):r.track=e:r={track:e},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},Xr=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.input?r.input.placeholder=e:r.input={placeholder:e}:r={input:{placeholder:e}},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},qr=(t,e)=>{let{id:i,type:n,source:r}=t,a=JSON.parse(JSON.stringify({id:i,type:n,source:r}));r?r.embed?(r.embed.type=e?.type,r.embed.oss=e?.oss,r.embed.name=e?.name,r.embed.path=e?.path,r.embed.url=e?.url):r.embed=e:r={embed:e},wr(window.document.getElementById(i),n,r),ls.history.push([{type:"source",from:a,to:JSON.parse(JSON.stringify({id:i,type:n,source:r}))}])},Yr=t=>{let e=t.mouseEvent?.target||t.touchEvent?.target,i=e?.getAttribute("id")||"",n=e?.nodeName;ls.dataSelect.nodeName.includes(n)||(e=jQuery(e).parents("foreignObject").get(0),e&&(i=e.getAttribute("id")||"",n=e.nodeName));let r=e?.parentNode?.getAttribute("id")||"";if([Ti.RESIZE_GROUP,Ti.SELECT_GROUP].includes(r))t.mouseEvent?.stopPropagation(),t.mouseEvent?.preventDefault(),"dblclick"==t.mouseEvent?.type&&1==ls.dataSelect.ids.length&&(t=>{if(1!=t.length)return;let e=t[0];if(!(e.type==Ri.FOREIGNOBJECT&&["html","text"].includes(e.source?.type??"")||e.type==Ri.FOREIGNOBJECT&&"test"==e.source?.type&&["truefalse","singlechoice","multichoice","matching-content","fill"].includes(e.source?.test?.type??"")||e.type==Ri.TEXT))return;ls.dataSelect.openEditable();let i=$(`#${e.id}`).find("[contenteditable]");i.on("input",(()=>{"html"==e.source?.type||"test"==e.source?.type?Kr(e,i.html(),!0):"text"==e.source?.type&&Fr(e,i.text(),!0)})).on("focusout",(()=>{ls.dataSelect.closeEditable()})).focus();let n=i.get(0);if(n){let t=document.createRange(),e=window.getSelection();e&&(t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t))}})(ls.dataSelect.nodes);else if(t.mouseEvent?.altKey||t.touchEvent?.altKey||!i||i.match(/[^0-9]/)||!ls.dataSelect.nodeName.includes(n))ls.dataSelect.ids.length&&(ls.dataSelect.ids=[]),(0==t.mouseEvent?.button||t.touchEvent)&&(t=>{let e=xr(Ti.SCAN_GROUP,"g"),i=jn(0,0,1,1);Er(e,i),((t,e,i)=>{Tr(t,{start:t=>{},move:(t,n)=>{var r,a,s,o;r=n[0][0],a=n[0][1],s=t.x,o=t.y,e=jn(r,a,s,o),Er(i,e)},end:(t,e)=>{i?.remove(),ls.dataSelect.ids=ls.data.getNodeInArea(Math.min(e[0][0],t.x),Math.min(e[0][1],t.y),Math.max(e[0][0],t.x),Math.max(e[0][1],t.y)),Pr(ls.dataSelect.nodes)}})})(t,i,e)})(t);else{let e=parseFloat(i||"0");if(e==ls.dataSelect.contenteditable_id)return;t.mouseEvent?.shiftKey||t.touchEvent?.shiftKey?ls.dataSelect.ids=[e].concat(ls.dataSelect.ids).filter(((t,e,i)=>i.indexOf(t)==e)):ls.dataSelect.ids=[e],Pr(ls.dataSelect.nodes)}};class Zr{constructor(){let{x:t,y:e}=ls.screen.dislocation;var i=(i,n,r,a)=>{ls.screen.move({x:t,y:e},{x:r-i,y:a-n})};return{start:t=>{},move:(t,e)=>{i(e[0][0],e[0][1],t.x,t.y)},end:(t,e)=>{i(e[0][0],e[0][1],t.x,t.y)}}}}class ta{constructor(){let t=xr(Ti.CREATE_GROUP,"g"),{nodeId:e,element:i,attribute:n,size:r}=pn(Math.ceil(1e9*Math.random())),a=(e,a,s,o)=>{r=jn(e,a,s,o,{ratio:1}),r.x=hn(r.x),r.y=hn(r.y),r.width=hn(r.width),r.height=hn(r.height),Object.assign(n,Jn(Ri.CIRCLE,r,n)),vr(i,n),_r(t,r)};return{start:t=>{a(t.x,t.y,t.x+r.width,t.y+r.height)},move:(t,e)=>{a(e[0][0],e[0][1],t.x,t.y)},end:(a,s)=>{(r.width<=8||r.height<=8)&&(r.width=80,r.height=80,r.x=r.x-r.width/2,r.y=r.y-r.height/2,Object.assign(n,Jn(Ri.CIRCLE,r,n)),vr(i,n)),ls.data.node=Object.assign({id:e,type:Ri.CIRCLE,name:"Circle"},{size:r,attribute:n}),t?.remove()}}}}class ea{constructor(){let t=xr(Ti.CREATE_GROUP,"g"),{nodeId:e,element:i,attribute:n,size:r}=ir(Math.ceil(1e9*Math.random()));var a=(e,a,s,o)=>{r=jn(e,a,s,o),r.x=hn(r.x),r.y=hn(r.y),r.width=hn(r.width),r.height=hn(r.height),Object.assign(n,Jn(Ri.ELLIPSE,r,n)),vr(i,n),_r(t,r)};return{start:t=>{a(t.x,t.y,t.x+r.width,t.y+r.height)},move:(t,e)=>{a(e[0][0],e[0][1],t.x,t.y)},end:(a,s)=>{r.width<4&&(r.width=4),r.height<4&&(r.height=4),r.width+r.height<8&&(r.width=90,r.height=60,r.x=r.x-r.width/2,r.y=r.y-r.height/2,Object.assign(n,Jn(Ri.ELLIPSE,r,n)),vr(i,n)),ls.data.node=Object.assign({id:e,type:Ri.ELLIPSE,name:"Ellipse"},{size:r,attribute:n}),t?.remove()}}}}class ia{constructor(){let t=xr(Ti.CREATE_GROUP,"g"),{nodeId:e,element:i,attribute:n,size:r}=fn(Math.ceil(1e9*Math.random()));var a=(e,a,s,o)=>{r=jn(e,a,s,o),r.x=hn(r.x),r.y=hn(r.y),r.width=hn(r.width),r.height=hn(r.height),Object.assign(n,Jn(Ri.RECT,r,n)),vr(i,n),_r(t,r)};return{start:t=>{a(t.x,t.y,t.x+r.width,t.y+r.height)},move:(t,e)=>{a(e[0][0],e[0][1],t.x,t.y)},end:(a,s)=>{r.width<1&&(r.width=1),r.height<1&&(r.height=1),r.width+r.height<8&&(r.width=80,r.height=80,r.x=r.x-r.width/2,r.y=r.y-r.height/2,Object.assign(n,Jn(Ri.RECT,r,n)),vr(i,n)),ls.data.node=Object.assign({id:e,type:Ri.RECT,name:"Rect"},{size:r,attribute:n}),t?.remove()}}}}class na{constructor(t){let e=xr(Ti.CREATE_GROUP,"g"),i=t||[[0,0],[1,1],[0,1]],{nodeId:n,element:r,attribute:a,size:s}=rr(Math.ceil(1e9*Math.random()));s.ratios=i;var o=(t,n,o,l)=>{s=jn(t,n,o,l,{ratios:i}),s.x=hn(s.x),s.y=hn(s.y),s.width=hn(s.width),s.height=hn(s.height),Object.assign(a,Jn(Ri.POLYGON,s,a)),vr(r,a),_r(e,s)};return{start:t=>{o(t.x,t.y,t.x+s.width,t.y+s.height)},move:(t,e)=>{o(e[0][0],e[0][1],t.x,t.y)},end:(t,i)=>{s.width<1&&(s.width=1),s.height<1&&(s.height=1),s.width+s.height<8&&(s.width=80,s.height=80,s.x=s.x-s.width/2,s.y=s.y-s.height/2,Object.assign(a,Jn(Ri.POLYGON,s,a)),vr(r,a)),ls.data.node=Object.assign({id:n,type:Ri.POLYGON,name:"Polygon"},{size:s,attribute:a}),e?.remove()}}}}class ra{constructor(){let t=xr(Ti.CREATE_GROUP,"g"),{nodeId:e,element:i,attribute:n,size:r}=nr(Math.ceil(1e9*Math.random()));return{start:t=>{},move:(e,a)=>{var s,o,l,c;s=a[0][0],o=a[0][1],l=e.x,c=e.y,r=jn(s,o,l,c),r.x=hn(r.x),r.y=hn(r.y),r.width=hn(r.width),r.height=hn(r.height),Object.assign(n,Jn(Ri.LINE,r,n)),vr(i,n),_r(t,r)},end:(a,s)=>{s.length>=2?(r.width<8&&(r.width=0),r.height<8&&(r.height=0),r.width+r.height<8&&(r.width=80,r.height=0,r.x=r.x-r.width/2,r.y=r.y-r.height/2,Object.assign(n,Jn(Ri.LINE,r,n)),vr(i,n)),ls.data.node=Object.assign({id:e,type:Ri.LINE,name:"Line"},{size:r,attribute:n})):i?.remove(),t?.remove()}}}}class aa{constructor(){let{nodeId:t,element:e,attribute:i,size:n}=sr(Math.ceil(1e9*Math.random())),r="";return{start:t=>{r=`M ${t.x} ${t.y} L ${t.x} ${t.y}`},move:(t,i)=>{var n,a;n=t.x,a=t.y,r+=` ${n} ${a}`,e.setAttribute("d",r)},end:(e,a)=>{let s=wn(r),{minX:o,minY:l,maxX:c,maxY:d}=Sn(s);n.x=o,n.y=l,n.width=c-o||1,n.height=d-l||1,n.ratioMaps=xn(n,s),ls.data.node=Object.assign({id:t,type:Ri.PATH,name:"Path"},{size:n,attribute:i})}}}}class sa{constructor(){let t=xr(Ti.CREATE_GROUP,"g"),{nodeId:e,element:i,size:n,attribute:r,style:a,source:s}=ar(Math.ceil(1e9*Math.random()));var o=(e,a,s,o)=>{n=jn(e,a,s,o),n.x=hn(n.x),n.y=hn(n.y),n.width=hn(n.width),n.height=hn(n.height),Object.assign(r,Jn(Ri.FOREIGNOBJECT,n,r)),vr(i,r),_r(t,n)};return{start:t=>{o(t.x,t.y,t.x+n.width,t.y+n.height)},move:(t,e)=>{o(e[0][0],e[0][1],t.x,t.y)},end:(o,l)=>{(n.width<=16||n.height<=16)&&(n.width=90,n.height=60,n.x=n.x-n.width/2,n.y=n.y-n.height/2,Object.assign(r,Jn(Ri.FOREIGNOBJECT,n,r)),vr(i,r)),ls.data.node=Object.assign({id:e,type:Ri.FOREIGNOBJECT,name:"ForeignObject"},{size:n,attribute:r,style:a,source:s}),t?.remove()}}}}class oa{constructor(){let t=xr(Ti.CREATE_GROUP,"g"),{nodeId:e,element:i,size:n,attribute:r,source:a}=gn(Math.ceil(1e9*Math.random())),s=1;(t=>{if(!t)return;let e=new Image;e.onload=()=>{s=hn(e.naturalWidth/e.naturalHeight,100)},e.onerror=e=>{console.error(`ImgSrc load failed -> ${t}`,e)},e.src=t})(a.image?.url??"");var o=(e,a,o,l)=>{n=jn(e,a,o,l,{ratio:s}),n.x=hn(n.x),n.y=hn(n.y),n.width=hn(n.width),n.height=hn(n.height),Object.assign(r,Jn(Ri.IMAGE,n,r)),vr(i,r),_r(t,n)};return{start:t=>{o(t.x,t.y,t.x+n.width,t.y+n.height)},move:(t,e)=>{o(e[0][0],e[0][1],t.x,t.y)},end:(s,o)=>{(n.width<=16||n.height<=16)&&(n.width=80,n.height=80,n.x=n.x-n.width/2,n.y=n.y-n.height/2,Object.assign(r,Jn(Ri.IMAGE,n,r)),vr(i,r)),ls.data.node=Object.assign({id:e,type:Ri.IMAGE,name:"Image"},{size:n,attribute:r,source:a}),t?.remove()}}}}n.config({driver:[n.INDEXEDDB,n.LOCALSTORAGE,n.WEBSQL],name:"_localDataDB",version:1});const la=async()=>r,ca=async t=>n.getItem(t),da=async(t,e)=>n.setItem(t,e),ha=async t=>{await la();var e=await ca("icdt-data")||[];"function"==typeof t.callback&&t.callback(e)},ua=async t=>{await la(),t.params=t.params||{};try{await da("icdt-data",t.params),"function"==typeof t.callback&&t.callback(t.params)}catch(e){"function"==typeof t.callback&&t.callback(null),console.error(e)}},fa=async t=>{await la();try{var e=await ca("icdt-config")||{};"function"==typeof t.callback&&t.callback(e)}catch(e){"function"==typeof t.callback&&t.callback(null),console.error(e)}},ga=async t=>{await la(),t.params=t.params||{};try{await da("icdt-config",t.params),"function"==typeof t.callback&&t.callback(t.params)}catch(e){"function"==typeof t.callback&&t.callback(null),console.error(e)}},pa=async t=>{await la();try{var e=await ca("icdt-clipboard")||{};"function"==typeof t.callback&&t.callback(e)}catch(e){"function"==typeof t.callback&&t.callback(null),console.error(e)}},ya=async t=>{await la(),t.params=t.params||{};try{await da("icdt-clipboard",t.params),"function"==typeof t.callback&&t.callback(t.params)}catch(e){"function"==typeof t.callback&&t.callback(null),console.error(e)}},ma=(t,e,i)=>{if(e&&!(i??window).document.getElementById(e))return;if(e){let n=(i??window).document.getElementById(e);jQuery(n).find("#"+Ti.BACKGROUND_GROUP).empty();let r=xr(Ti.BACKGROUND_GROUP,"g",void 0,n);jr(r,t)}else{jQuery(ls.target).find("#"+Ti.BACKGROUND_GROUP).empty();let e=xr(Ti.BACKGROUND_GROUP,"g",void 0,ls.target);jr(e,t)}let n=(t,r)=>{r=e&&r?`${e}-${r}`:e??r,t?.forEach((t=>{let a=e?`${e}-${t.id}`:t.id;if(t.isdeleted)(i??window).document.getElementById(a)?.remove();else switch(t.type){case Ri.GROUP:Ln(a,{},r?(i??window).document.getElementById(r):null),n(t.nodes,t.id);break;case Ri.CIRCLE:pn(a,{size:t.size,attribute:t.attribute},r?(i??window).document.getElementById(r):null);break;case Ri.ELLIPSE:ir(a,{size:t.size,attribute:t.attribute},r?(i??window).document.getElementById(r):null);break;case Ri.LINE:nr(a,{size:t.size,attribute:t.attribute},r?(i??window).document.getElementById(r):null);break;case Ri.RECT:fn(a,{size:t.size,attribute:t.attribute},r?(i??window).document.getElementById(r):null);break;case Ri.POLYGON:rr(a,{size:t.size,attribute:t.attribute},r?(i??window).document.getElementById(r):null);break;case Ri.POLYLINE:or(a,{size:t.size,attribute:t.attribute},r?(i??window).document.getElementById(r):null);break;case Ri.FOREIGNOBJECT:ar(a,{size:t.size,attribute:t.attribute,style:t.style,source:t.source},r?(i??window).document.getElementById(r):null);break;case Ri.IMAGE:gn(a,{size:t.size,attribute:t.attribute,source:t.source},r?(i??window).document.getElementById(r):null);break;case Ri.TEXT:Mn(a,{size:t.size,attribute:t.attribute,source:t.source},r?(i??window).document.getElementById(r):null);break;case Ri.TSPAN:lr(a,{size:t.size,attribute:t.attribute,source:t.source},r?(i??window).document.getElementById(r):null);break;case Ri.PATH:sr(a,{size:t.size,attribute:t.attribute},r?(i??window).document.getElementById(r):null)}}))};n(t?.svg?.nodes)},va=(t,e)=>{if(e&&!window.document.getElementById(e))return;let i=(t,n)=>{n=n?`${e}-${n}`:e,t?.forEach((t=>{let r=e?`${e}-${t.id}`:t.id;jQuery("#"+r).appendTo(n?window.document.getElementById(n):ls.target),t.type==Ri.GROUP&&i(t.nodes,t.id)}))};i(t?.svg?.nodes)},ba=(t,e)=>{let{id:i,type:n,size:r,attribute:a}=t,s=JSON.parse(JSON.stringify({id:i,size:r,attribute:a}));r.x=hn(e||0),Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(i),a),ls.history.push([{type:"size",from:s,to:JSON.parse(JSON.stringify({id:i,size:r,attribute:a}))}])},wa=(t,e)=>{let{id:i,type:n,size:r,attribute:a}=t,s=JSON.parse(JSON.stringify({id:i,size:r,attribute:a}));r.y=hn(e||0),Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(i),a),ls.history.push([{type:"size",from:s,to:JSON.parse(JSON.stringify({id:i,size:r,attribute:a}))}])},Sa=(t,e,i)=>{let{id:n,type:r,size:a,attribute:s}=t;e<=0&&(e=1);let o=JSON.parse(JSON.stringify({id:n,size:a,attribute:s}));i&&(a.height=hn(e*a.height/(a.width||1))),a.width=hn(e),Object.assign(s,Jn(r,a,s)),vr(window.document.getElementById(n),s),ls.history.push([{type:"size",from:o,to:JSON.parse(JSON.stringify({id:n,size:a,attribute:s}))}])},xa=(t,e,i)=>{let{id:n,type:r,size:a,attribute:s}=t;e<=0&&(e=1);let o=JSON.parse(JSON.stringify({id:n,size:a,attribute:s}));i&&(a.width=hn(e*a.width/(a.height||1))),a.height=hn(e),Object.assign(s,Jn(r,a,s)),vr(window.document.getElementById(n),s),ls.history.push([{type:"size",from:o,to:JSON.parse(JSON.stringify({id:n,size:a,attribute:s}))}])},_a=(t,e)=>{let{id:i,type:n,size:r,attribute:a}=t,s=JSON.parse(JSON.stringify({id:i,size:r,attribute:a}));r.rotate="number"==typeof e?hn(e,100):void 0,Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(i),a),ls.history.push([{type:"size",from:s,to:JSON.parse(JSON.stringify({id:i,size:r,attribute:a}))}])},ka=new class{constructor(){this._fnChanges=[],this.onchange={type:"keydown",key:Gi.Escape,fn:()=>{ls.dataSelect.ids.length&&(ls.dataSelect.ids=[])}},this.onchange={type:"keydown",key:Gi.Delete,fn:()=>{ls.dataSelect.deleteNode()}},this.onchange={type:"keydown",key:Gi.Space,fn:()=>{ls.pointer.pointer_type_temp=Ci.HAND}},this.onchange={type:"keyup",key:Gi.Space,fn:()=>{ls.pointer.pointer_type_temp=Ci.POINTER}},this.onchange={type:"keydown",key:Gi.ArrowLeft,fn:()=>{ls.dataSelect.ids.length||ls.data.backSlide()}},this.onchange={type:"keydown",key:Gi.ArrowRight,fn:()=>{ls.dataSelect.ids.length||ls.data.nextSlide()}},this.onchange={type:"keydown",key:Gi.PageDown,fn:()=>{ls.dataSelect.ids.length||ls.data.backSlide()}},this.onchange={type:"keydown",key:Gi.PageUp,fn:()=>{ls.dataSelect.ids.length||ls.data.nextSlide()}},this.onchange={type:"keydown",key:Gi.ArrowLeft,fn:()=>{ls.dataSelect.ids.length&&(ls.dataSelect.nodes.forEach((t=>{ba(t,hn(t.size.x-un(1)))})),Pr(ls.dataSelect.nodes))}},this.onchange={type:"keydown",key:Gi.ArrowRight,fn:()=>{ls.dataSelect.ids.length&&(ls.dataSelect.nodes.forEach((t=>{ba(t,hn(t.size.x+un(1)))})),Pr(ls.dataSelect.nodes))}},this.onchange={type:"keydown",key:Gi.ArrowUp,fn:()=>{ls.dataSelect.ids.length&&(ls.dataSelect.nodes.forEach((t=>{wa(t,hn(t.size.y-un(1)))})),Pr(ls.dataSelect.nodes))}},this.onchange={type:"keydown",key:Gi.ArrowDown,fn:()=>{ls.dataSelect.ids.length&&(ls.dataSelect.nodes.forEach((t=>{wa(t,hn(t.size.y+un(1)))})),Pr(ls.dataSelect.nodes))}},this.onchange={type:"keydown",key:Gi.Digit1,fn:t=>{t.shiftKey&&(ls.reloadView(),ls.screen.zoomTo="fit")}},this.onchange={type:"keydown",key:Gi.Digit0,fn:t=>{t.ctrlKey&&(ls.screen.zoomTo=100)}},this.onchange={type:"keydown",key:Gi.Equal,fn:t=>{t.ctrlKey&&ls.screen.zoomIn()}},this.onchange={type:"keydown",key:Gi.Minus,fn:t=>{t.ctrlKey&&ls.screen.zoomOut()}},this.onchange={type:"keydown",key:Gi.KeyA,fn:t=>{t.ctrlKey&&(ls.dataSelect.ids=ls.data.getNodeAll(),Pr(ls.dataSelect.nodes))}},this.onchange={type:"keydown",key:Gi.KeyC,fn:t=>{if(t.ctrlKey){let t=ls.dataSelect.nodes;t&&ya({params:{type:"nodes",nodes:t}})}}},this.onchange={type:"keydown",key:Gi.KeyV,fn:t=>{t.ctrlKey&&pa({callback:e=>{"nodes"==e?.type&&e?.nodes?.length&&(e?.nodes?.forEach((e=>{t.shiftKey||ls.data.findNode(e.id).id&&(e.size.x+=16,e.size.y+=16),e.id=Math.ceil(1e9*Math.random()),ls.data.node=e})),ma(ls.data.slide))}})}},this.onchange={type:"keydown",key:Gi.KeyZ,fn:t=>{t.ctrlKey&&t.shiftKey?ls.history.redo():t.ctrlKey&&ls.history.undo()}},this.onchange={type:"keydown",key:Gi.BracketLeft,fn:t=>{t.ctrlKey&&t.shiftKey?ls.data.sendToBack(ls.dataSelect.ids):t.ctrlKey?ls.data.sendToBackStep(ls.dataSelect.ids,-2):ls.data.sendToBackArea(ls.dataSelect.ids)}},this.onchange={type:"keydown",key:Gi.BracketRight,fn:t=>{t.ctrlKey&&t.shiftKey?ls.data.bringToFront(ls.dataSelect.ids):t.ctrlKey?ls.data.bringToFrontStep(ls.dataSelect.ids,1):ls.data.bringToFrontArea(ls.dataSelect.ids)}}}set onchange(t){let e=this._fnChanges.find((e=>e.eventType==t.type&&e.eventKey==t.key));e?e.fns.push(t.fn):this._fnChanges.push({eventType:t.type,eventKey:t.key,fns:[t.fn]})}change(t,e,i){ls.dataSelect.contenteditable_id||this._fnChanges.find((i=>i.eventType==t&&i.eventKey==e))?.fns.forEach((t=>t(i)))}},Oa=t=>{ka.change(t.type,t.keyCode||t.which||t.charCode||0,t)};class Na{constructor(){let t={stroke:ls.attribute.stroke,strokeWidth:ls.attribute.strokeWidth,strokeLinecap:"round",strokeLinejoin:"round"},{nodeId:e,element:i,attribute:n,size:r}=sr(Math.ceil(1e9*Math.random()),{attribute:t});vr(i,n);let a="",s="";return{start:t=>{a=`M ${t.x} ${t.y} L ${t.x} ${t.y}`},move:(t,e)=>{var n,r;n=t.x,r=t.y,a+=` ${n} ${r}`,i.setAttribute("d",a)},end:(t,o)=>{if(o.length>=3){let t=zi().x((t=>t[0])).y((t=>t[1])).curve($i);s=t(o)??"",i.setAttribute("d",s)}else i.setAttribute("d",a);let l=wn(s||a),{minX:c,minY:d,maxX:h,maxY:u}=Sn(l);r.x=c,r.y=d,r.width=h-c||1,r.height=u-d||1,r.ratioMaps=xn(r,l),ls.data.node=Object.assign({id:e,type:Ri.PATH,name:"Path"},{size:r,attribute:n})}}}}class Ea{constructor(){let t={stroke:ls.attribute.stroke,strokeOpacity:.4,strokeWidth:ls.attribute.strokeWidth,strokeLinecap:"round",strokeLinejoin:"round"},{nodeId:e,element:i,attribute:n,size:r}=sr(Math.ceil(1e9*Math.random()),{attribute:t});vr(i,n);let a="";return{start:t=>{a=`M ${t.x} ${t.y} L ${t.x} ${t.y}`},move:(t,e)=>{var n,r;n=t.x,r=t.y,a+=` ${n} ${r}`,i.setAttribute("d",a)},end:(t,i)=>{let s=wn(a),{minX:o,minY:l,maxX:c,maxY:d}=Sn(s);r.x=o,r.y=l,r.width=c-o||1,r.height=d-l||1,r.ratioMaps=xn(r,s),ls.data.node=Object.assign({id:e,type:Ri.PATH,name:"Path"},{size:r,attribute:n})}}}}class Ia{constructor(t,e){let i={stroke:"#FF0000",strokeWidth:un(2),strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:un(8)},{element:n,attribute:r,size:a}=sr(Math.ceil(1e9*Math.random()),{size:e});window.document.getElementById(Ti.INTERACTIVE_GROUP).querySelectorAll("path").forEach((t=>t?.remove())),window.document.getElementById(Ti.INTERACTIVE_GROUP).querySelectorAll("circle").forEach((t=>t?.remove())),window.document.getElementById(Ti.INTERACTIVE_GROUP)?.appendChild(n);var s=e=>{if(!e.length)return;let i=[];if(1==e.length){let{size:n}=t??ls.dataSelect.nodes[0]??{};if(!n)return;i=[[n.x+n.width/2,n.y+n.height/2],e[0]]}else i=[...e];l(i),o(i[0],"start"),o(i[i.length-1],"end")},o=(e,i)=>{e&&((()=>{let{element:t}=pn(Math.ceil(1e9*Math.random()),{attribute:{fill:"start"==i?"#FF0000":"#00BA00",strokeWidth:un(1)},size:{x:e[0]-5,y:e[1]-5,width:10,height:10}});window.document.getElementById(Ti.INTERACTIVE_GROUP)?.prepend(t)})(),(()=>{let{size:i}=t??ls.dataSelect.nodes[0]??{};if(!i)return;let n=[[e[0]-i.width/2,e[1]-i.height/2],[e[0]+i.width/2,e[1]-i.height/2],[e[0]+i.width/2,e[1]+i.height/2],[e[0]-i.width/2,e[1]+i.height/2],[e[0]-i.width/2,e[1]-i.height/2]],{element:r}=sr(Math.ceil(1e9*Math.random()),{attribute:{fill:"#FFFFFF",fillOpacity:.6,stroke:"#5f6ce1",strokeWidth:un(1),strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:un(8)},size:{x:0,y:0,width:10,height:10,points:n}});window.document.getElementById(Ti.INTERACTIVE_GROUP)?.prepend(r)})())},l=t=>{let e=zi().x((t=>t[0])).y((t=>t[1])).curve($i),i=e(t);n.setAttribute("d",i)};vr(n,i),s(e?.points??[]);let c="";return{start:t=>{c=`M ${t.x} ${t.y} L ${t.x} ${t.y}`},move:(t,e)=>{c+=` ${t.x} ${t.y}`,n.setAttribute("d",c)},end:(t,e)=>{s(e),e.length&&(window.interactivePoints=e)}}}}const za=t=>{switch(ls.pointer.pen_type){case Bi.DRAW:Tr(t,new Na);break;case Bi.HIGHTLIGH:Tr(t,new Ea);break;case Bi.INTERACTIVE:ja(t)}},ja=t=>{let e=xr(Ti.INTERACTIVE_GROUP,"g"),i=ls.data.slide?.svg?.viewBox??(()=>{let{width:t,height:e}=ls.screen.get;return{x:0,y:0,width:t,height:e}})();Ir(e,i),t&&Tr(t,new Ia)};function Ja(t,e,i,n){return Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2))}function $a(t,e,i,n,r){return Ja(t,e,i,n)<r?1:0}function Aa(t,e,i,n,r,a,s){var o=[];return o.push($a(t,e,i,n,s)),o.push($a(t,e,r,a,s)),o.push(function(t,e,i,n,r,a,s){var o=[r-i,a-n],l=[t-i,e-n],c=[-o[1],o[0]],d=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),h=[c[0]/d,c[1]/d],u=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)),f=[o[0]/u,o[1]/u],g=l[0]*f[0]+l[1]*f[1];if(g<=0||g>=u)return 0;var p=l[0]*h[0]+l[1]*h[1];return p>=s||p<=-s?0:1}(t,e,i,n,r,a,s)),o}function Ta(t,e,i,n,r){var a=[i-t,n-e],s=[-a[1],a[0]],o=Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)),l=[s[0]/o,s[1]/o];return[[t+r*l[0],e+r*l[1]],[t-r*l[0],e-r*l[1]],[i-r*l[0],n-r*l[1]],[i+r*l[0],n+r*l[1]]]}function Ca(t,e,i,n,r,a,s){var o,l=[r-t,a-e],c=[i-t,n-e],d=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),h=[c[0]/d,c[1]/d],u=l[0]*h[0]+l[1]*h[1],f=[t+u*h[0],e+u*h[1]],g=Math.sqrt(Math.pow(r-f[0],2)+Math.pow(a-f[1],2));o=0===g?s:Math.sqrt(Math.pow(s,2)-Math.pow(g,2));var p=[t+u*h[0]+o*h[0],e+u*h[1]+o*h[1]];return p[0]===t&&p[1]===e?null:p}function Ba(t,e,i,n,r,a,s){var o=[r-t,a-e],l=[i-t,n-e],c=[-l[1],l[0]],d=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),h=[c[0]/d,c[1]/d],u=o[0]*h[0]+o[1]*h[1],f=Fa([t,e],[i,n],[r,a]);if(Pa([f[0]-r,f[1]-a])>=s)return null;var g=Math.sqrt(Math.pow(s,2)-Math.pow(u,2)),p=[r-u*h[0],a-u*h[1]],y=Math.sqrt(Math.pow(l[0],2)+Math.pow(l[1],2)),m=[l[0]/y,l[1]/y],v=[[p[0]-m[0]*g,p[1]-m[1]*g],[p[0]+m[0]*g,p[1]+m[1]*g]];return v[0][0]===t&&v[0][1]===e?null:v}function Ra(t,e,i,n,r,a,s,o){var l,c,d,h,u,f;return-(d=s-r)*(c=n-e)+(l=i-t)*(h=o-a)==0?null:(f=(d*(e-a)-h*(t-r))/(-d*c+l*h),(u=(-c*(t-r)+l*(e-a))/(-d*c+l*h))>=0&&u<=1&&f>=0&&f<=1?[t+f*l,e+f*c]:null)}function Ma(t,e,i,n,r,a,s,o,l,c){var d=Ta(a,s,o,l,c),h=[];if(i[0]&&!i[1])h.push(Ca(t,e,n,r,a,s,c)),h.push(Ra(t,e,n,r,d[0][0],d[0][1],d[3][0],d[3][1])),h.push(Ra(t,e,n,r,d[1][0],d[1][1],d[2][0],d[2][1])),(u=Ba(t,e,n,r,o,l,c))&&h.push(u[0],u[1]);else if(!i[0]&&i[1])h.push(Ca(t,e,n,r,o,l,c)),h.push(Ra(t,e,n,r,d[0][0],d[0][1],d[3][0],d[3][1])),h.push(Ra(t,e,n,r,d[1][0],d[1][1],d[2][0],d[2][1])),(u=Ba(t,e,n,r,a,s,c))&&h.push(u[0],u[1]);else if(i[0]&&i[1])h.push(Ca(t,e,n,r,a,s,c)),h.push(Ra(t,e,n,r,d[0][0],d[0][1],d[3][0],d[3][1])),h.push(Ra(t,e,n,r,d[1][0],d[1][1],d[2][0],d[2][1])),h.push(Ca(t,e,n,r,o,l,c));else{var u=Ba(t,e,n,r,o,l,c),f=Ba(t,e,n,r,a,s,c);u&&h.push(u[0],u[1]),f&&h.push(f[0],f[1]),h.push(Ra(t,e,n,r,d[0][0],d[0][1],d[3][0],d[3][1])),h.push(Ra(t,e,n,r,d[1][0],d[1][1],d[2][0],d[2][1]))}for(var g=[t,e],p=0;p<h.length;p++)h[p]&&Ja(h[p][0],h[p][1],n,r)<Ja(g[0],g[1],n,r)&&(g=h[p]);return g[0]===t&&g[1]===e?null:g}function La(t,e,i,n,r,a,s,o,l){var c=Ta(r,a,s,o,l),d=[],h=Ba(t,e,i,n,r,a,l);h&&d.push(h[0],h[1]),(h=Ba(t,e,i,n,s,o,l))&&d.push(h[0],h[1]),d.push(Ra(t,e,i,n,c[0][0],c[0][1],c[3][0],c[3][1])),d.push(Ra(t,e,i,n,c[1][0],c[1][1],c[2][0],c[2][1]));for(var u=[i,n],f=[t,e],g=0;g<d.length;g++)d[g]&&Ja(d[g][0],d[g][1],t,e)<Ja(u[0],u[1],t,e)&&(u=d[g]);for(var p=0;p<d.length;p++)d[p]&&Ja(d[p][0],d[p][1],i,n)<Ja(f[0],f[1],i,n)&&(f=d[p]);return u[0]===i&&u[1]===n||f[0]===t&&f[1]===e?null:[u,f]}var Pa=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},Fa=function(t,e,i){var n=[e[0]-t[0],e[1]-t[1]],r=Pa(n);if(r<1e-6)return t;var a=[i[0]-t[0],i[1]-t[1]],s=(n[0]*a[0]+n[1]*a[1])/r;return s<0?t:s>r?e:[t[0]+n[0]*s/r,t[1]+n[1]*s/r]};class Ka{constructor(){let{nodeId:t,element:e,attribute:i,size:n}=sr(Math.ceil(1e9*Math.random()));vr(e,{stroke:"#ddd",strokeWidth:10,strokeLinecap:"round",strokeLinejoin:"round"});let r="";return{start:t=>{r=`M ${t.x} ${t.y} L ${t.x} ${t.y}`},move:(t,i)=>{var n,a;n=t.x,a=t.y,r+=` ${n} ${a}`,e.setAttribute("d",r)},end:(t,i)=>{e.remove(),(t=>{let e=9999,i=9999,r=-9999,a=-9999;t.forEach((t=>{e=Math.min(e,t[0]),i=Math.min(i,t[1]),r=Math.max(r,t[0]),a=Math.max(a,t[1])})),n=jn(e,i,r,a,{points:t}),ls.data.getNodeInArea(0,0,1920,1920,Ri.PATH).forEach((e=>{let i=((t,e,i)=>{i=i||20;var n=[],r=function(t){var r=e[0][0],a=e[0][1],s=0,o=0;if(1!==t.length||$a(t[0][0],t[0][1],r,a,i)){for(var l;s<t.length-1;){var c=t[s],d=t[s+1],h=$a(c[0],c[1],r,a,i),u=$a(d[0],d[1],r,a,i);if(h&&u)o=++s;else if(h&&!u)(f=Ca(c[0],c[1],d[0],d[1],r,a,i))?(t[s]=f,o=s):s++;else if(!h&&u){var f;(f=Ca(d[0],d[1],c[0],c[1],r,a,i))&&((l=t.slice(o,s+1)).push(f),n.push(l)),o=++s}else{var g=Ba(c[0],c[1],d[0],d[1],r,a,i);g?((l=t.slice(o,s+1))[l.length-1][0]===g[0][0]&&l[l.length-1][1]===g[0][1]||l.push(g[0]),l.length>1&&n.push(l),t[s]=g[1],t[s+1]&&t[s+1][0]==g[1][0]&&t[s+1][1]==g[1][1]&&s++,o=s):s++}}o!==s&&(l=t.slice(o,t.length))&&n.push(l)}else n.push(t)},a=function(t,r){var a,s=e[r],o=e[r+1],l=0,c=0;if(1!==t.length||-1!==(u=Aa(t[0][0],t[0][1],s[0],s[1],o[0],o[1],i)).indexOf(1)){for(;l<t.length-1;){var d=t[l],h=t[l+1],u=Aa(d[0],d[1],s[0],s[1],o[0],o[1],i),f=Aa(h[0],h[1],s[0],s[1],o[0],o[1],i);if(-1!==u.indexOf(1)&&-1!==f.indexOf(1))c=++l;else if(-1!==u.indexOf(1)&&-1===f.indexOf(1))(g=Ma(d[0],d[1],u,h[0],h[1],s[0],s[1],o[0],o[1],i))?(t[l]=g,c=l):l++;else if(-1===u.indexOf(1)&&-1!==f.indexOf(1)){var g;(g=Ma(h[0],h[1],f,d[0],d[1],s[0],s[1],o[0],o[1],i))?((a=t.slice(c,l+1)).push(g),n.push(a),c=++l):l++}else{var p=La(d[0],d[1],h[0],h[1],s[0],s[1],o[0],o[1],i);p?((a=t.slice(c,l+1))[a.length-1][0]===p[0][0]&&a[a.length-1][1]===p[0][1]||a.push(p[0]),a.length>1&&n.push(a),t[l]=p[1],t[l+1]&&t[l+1][0]==p[1][0]&&t[l+1][1]==p[1][1]&&l++,c=l):l++}}c!==l&&(a=t.slice(c,t.length))&&n.push(a)}else n.push(t)};if(1===(e=function(t){var e=[];if(1===t.length)e=t;else{for(var i=0;i<t.length-1;)t[i][0]===t[i+1][0]&&t[i][1]===t[i+1][1]||e.push(t[i]),i++;0!==t.length&&0===e.length&&e.push(t[0]),t[t.length-1][0]===t[e.length-1][0]&&t[t.length-1][1]===t[e.length-1][1]||e.push(t[i])}return e}(e)).length){for(var s=0;s<t.length;s++)r(t[s]);t=n}else for(var o=0;o<e.length-1;o++){for(s=0;s<t.length;s++)a(t[s],o);t=n,n=[]}for(var l=0;l<t.length;l++)for(var c=0;c<t[l].length;c++)t[l][c][0]=Math.round(t[l][c][0]),t[l][c][1]=Math.round(t[l][c][1]);return t})(ls.data.getNode(e).size.points,t,2);console.log(i)}))})(i)}}}}class Ga{constructor(){let t=xr(Ti.CREATE_GROUP,"g"),{nodeId:e,element:i,attribute:n,size:r,source:a}=Mn(Math.ceil(1e9*Math.random())),s=(e,a,s,o)=>{r=jn(e,a,s,o),r.x=hn(r.x),r.y=hn(r.y),r.width=hn(r.width),r.height=hn(r.height),Object.assign(n,Jn(Ri.TEXT,r,n)),vr(i,n),_r(t,r)};return{start:t=>{s(t.x,t.y,t.x+r.width,t.y+r.height)},move:(t,e)=>{s(e[0][0],e[0][1],t.x,t.y)},end:(s,o)=>{r.width<100&&(r.width=100),r.height<20&&(r.height=20),r.width+r.height<8&&(r.width=100,r.height=20,r.x=r.x-r.width/2,r.y=r.y-r.height/2,Object.assign(n,Jn(Ri.TEXT,r,n)),vr(i,n)),ls.data.node=Object.assign({id:e,type:Ri.TEXT,name:"Text"},{size:r,attribute:n,source:a}),t?.remove()}}}}const Da=t=>{let e=t.mouseEvent?.target||t.touchEvent?.target,i=e?.getAttribute("id")||"",n=e?.nodeName,r=jQuery(e).parents("g[id]").attr("id")||"";if(![Ti.INDEX_GROUP].includes(r))if(t.mouseEvent?.altKey||t.touchEvent?.altKey||!i||i.match(/[^0-9]/)||!ls.dataSelect.nodeName.includes(n))ls.dataSelect.ids.length&&(ls.dataSelect.ids=[]),(0==t.mouseEvent?.button||t.touchEvent)&&((t,e)=>{let i=xr(Ti.SCAN_GROUP,"g"),n=jn(0,0,1,1);Er(i,n),((t,e,i,n)=>{Tr(t,{start:t=>{},move:(t,n)=>{var r,a,s,o;r=n[0][0],a=n[0][1],s=t.x,o=t.y,e=jn(r,a,s,o),Er(i,e)},end:(t,e)=>{i?.remove(),ls.dataSelect.ids=ls.data.getNodeInArea(Math.min(e[0][0],t.x),Math.min(e[0][1],t.y),Math.max(e[0][0],t.x),Math.max(e[0][1],t.y));let r=ls.dataSelect.nodes;n(r)}})})(t,n,i,e)})(t,Qa);else{let e=parseFloat(i||"0");t.mouseEvent?.shiftKey||t.touchEvent?.shiftKey?ls.dataSelect.ids=[e].concat(ls.dataSelect.ids).filter(((t,e,i)=>i.indexOf(t)==e)):ls.dataSelect.ids=[e];let n=ls.dataSelect.nodes;Qa(n)}},Qa=t=>{let e=1;if(t.length&&(e=Math.max.apply(null,ls.data.slide?.svg?.nodes.map((t=>t.idx??0))??[0])+1),1==t.length)t[0].idx||(t[0].idx=e,t[0].time=0);else if(t.length>=0){let i=t.map((t=>t.idx??0)).filter((t=>t>0)),n=i.length?Math.min.apply(null,i):e;t.forEach((t=>{t.idx=n,t.time=t.time??0}))}let i=xr(Ti.INDEX_GROUP,"g");zr(i,ls.data.slide?.svg?.nodes??[])},Ua=t=>{t?.svg?.nodes&&t.svg.nodes.forEach((t=>{t.idx=0,t.time=null}));let e=xr(Ti.INDEX_GROUP,"g");zr(e,ls.data.slide?.svg?.nodes??[])},Wa=t=>{new fr(t.container,t.target);var e=(e,i,n,r)=>{switch(e){case Ci.POINTER:jQuery(t.target).css({cursor:"auto"});break;case Ci.HAND:r?jQuery(t.target).css({cursor:"grabbing"}):jQuery(t.target).css({cursor:"grab"});break;case Ci.PEN:switch(i){case Bi.DRAW:jQuery(t.target).css({cursor:"url(assets/images/svg/icon/viet.png) 12 32,default"});break;case Bi.HIGHTLIGH:jQuery(t.target).css({cursor:"url(assets/images/svg/icon/highlight1.png) 12 32,default"})}break;case Ci.ERASER:jQuery(t.target).css({cursor:"url(assets/images/svg/icon/gom.png) 22 22,default"});break;case Ci.SHAPE:jQuery(t.target).css({cursor:"url(assets/images/svg/icon/point.png) 22 22,default"});break;case Ci.TEXT:case Ci.FOREIGNOBJECT:jQuery(t.target).css({cursor:"url(assets/images/svg/icon/textmouse.png) 22 22,default"})}};ls.pointer.onchange=(t,i,n)=>{e(t,i)},jQuery(t.container).off("mousedown.icdt-init-icon").on("mousedown.icdt-init-icon",(t=>{e(ls.pointer.pointer_type,void 0,0,!0)})).off("mouseup.icdt-init-icon").on("mouseup.icdt-init-icon",(t=>{e(ls.pointer.pointer_type,void 0,0,!1)})),document.addEventListener("wheel",(t=>{t.ctrlKey&&t.preventDefault()}),{passive:!1}),jQuery(t.container).off("wheel.icdt-init").on("wheel.icdt-init",(t=>{t.preventDefault();let e=t.originalEvent??t;if(!e.deltaX&&e.deltaY!=Math.floor(e.deltaY)||e.ctrlKey){var i=ls.screen.scale,n=.04*i*(e.deltaY>0?1:-1);ls.screen.scaleTo(i-n,Ar({x:t.clientX,y:t.clientY},1,{x:0,y:0},ls.screen.offset))}else ls.screen.move(ls.screen.dislocation,{x:-e.deltaX,y:-e.deltaY})})),jQuery(window).off("mousedown.icdt-init").on("mousedown.icdt-init",(t=>{ls.screen.actived=!!jQuery(t.target).parents(ls.container).length})),jQuery(t.container).off("mouseenter.icdt-init").on("mouseenter.icdt-init",(t=>{})),jQuery(t.container).off("mouseleave.icdt-init").on("mouseleave.icdt-init",(t=>{ls.pointer.pointer_type_temp==Ci.HAND&&(ls.pointer.pointer_type_temp=Ci.POINTER)})),jQuery(t.container).off("mousedown.icdt-init").on("mousedown.icdt-init",(e=>{0==e.button&&(t.container.includes("#")&&t.container.includes(e.target.getAttribute("id"))||t.container.includes(".")&&t.container.includes(e.target.getAttribute("class"))||t.container.includes(e.target.nodeName))&&(ls.pointer.pointer_type_temp||ls.pointer.pointer_type)===Ci.POINTER&&(ls.dataSelect.ids=[])})),jQuery(t.container).off("touchmove.icdt-init").on("touchmove.icdt-init",(t=>{t.preventDefault()}));const i=t=>{switch(ls.pointer.pointer_type_temp||ls.pointer.pointer_type){case Ci.POINTER:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type&&"dblclick"!=t.mouseEvent?.type||Yr(t);break;case Ci.HAND:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type||(t=>{Tr(t,new Zr,1,{x:0,y:0})})(t);break;case Ci.PEN:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type||za(t);break;case Ci.SHAPE:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type||(t=>{var e=null;switch(ls.pointer.shape_type){case Ri.CIRCLE:e=new ta;break;case Ri.ELLIPSE:e=new ea;break;case Ri.LINE:e=new ra;break;case Ri.RECT:e=new ia;break;case Ri.POLYGON:e=new na(Li.find((t=>t.type==ls.pointer.polygon_type))?.ratios);break;case Ri.FOREIGNOBJECT:e=new sa;break;case Ri.IMAGE:e=new oa;break;case Ri.TEXT:case Ri.PATH:e=new aa}e&&Tr(t,e)})(t);break;case Ci.FOREIGNOBJECT:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type||(t=>{Tr(t,new sa)})(t);break;case Ci.IMAGE:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type||(t=>{Tr(t,new oa)})(t);break;case Ci.TEXT:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type||(t=>{Tr(t,new Ga)})(t);break;case Ci.ERASER:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type||(t=>{Tr(t,new Ka)})(t);break;case Ci.INDEX:"touchstart"!=t.touchEvent?.type&&"mousedown"!=t.mouseEvent?.type||Da(t)}};let n=!1;jQuery(t.target).off("touchstart.icdt-init").on("touchstart.icdt-init",(t=>{n=!0,i({touchEvent:t})})),jQuery(t.target).off("mousedown.icdt-init").on("mousedown.icdt-init",(t=>{1!=t.button&&(n?n=!1:i({mouseEvent:t}))})),jQuery(t.target).off("dblclick.icdt-init").on("dblclick.icdt-init",(t=>{1!=t.button&&(n?n=!1:i({mouseEvent:t}))})),t.iskeyboard&&(jQuery(window).off("keydown.icdt-init").on("keydown.icdt-init",(t=>{t.keyCode||t.which||t.charCode,ls.screen.actived&&(ls.dataSelect.contenteditable_id||((t.ctrlKey||t.altKey)&&(t.stopPropagation(),t.preventDefault()),Oa(t)))})),jQuery(window).off("keyup.icdt-init").on("keyup.icdt-init",(t=>{t.keyCode||t.which||t.charCode,ls.screen.actived&&(ls.dataSelect.contenteditable_id||((t.ctrlKey||t.altKey)&&(t.stopPropagation(),t.preventDefault()),Oa(t)))})))};class Va{constructor(){this._nodeName=["circle","ellipse","line","polygon","polyline","rect","text","tspan","path","image","foreignObject"],this._selected_Ids=[],this._contenteditable_Id=0,this._fnChanges=[]}get nodeName(){return this._nodeName}get ids(){return this._selected_Ids}set ids(t){this._selected_Ids=t,this.closeEditable(),this.change(this.ids)}get contenteditable_id(){return this._contenteditable_Id}get nodes(){return this._selected_Ids.map((t=>ls.data.getNode(t))).filter((t=>!t.isfake))}set onchange(t){this._fnChanges.push(t)}change(t){this.cleanSelected(),this._fnChanges.forEach((e=>e(t)))}deleteNode(){for(let t of this._selected_Ids){let e=ls.data.deleteNode(t);ls.history.push([{type:"delete",from:{id:e},to:{id:e}}])}ls.dataSelect.ids=[]}groupNode(){let t=[];if(ls.dataSelect.ids.length>=2){let e=ls.data.getNode(ls.dataSelect.ids[0]),{nodeId:i,attribute:n,size:r}=Ln(Math.ceil(1e9*Math.random()),void 0,e.pid?window.document.getElementById(e.pid):null);ls.data.node=Object.assign({id:i,type:Ri.GROUP,name:"G"},{size:r,attribute:n});for(let e of ls.dataSelect.ids)t.push(ls.data.addGroup(e,i))}t.length&&(ls.dataSelect.ids=t,Pr(ls.dataSelect.nodes))}ungroupNode(){let t=[];for(let e of ls.dataSelect.ids)t.push(ls.data.unGroup(e));t.length&&(ls.dataSelect.ids=t,Pr(ls.dataSelect.nodes))}cleanSelected(){window.document.getElementById(Ti.RESIZE_GROUP)?.remove(),window.document.getElementById(Ti.SELECT_GROUP)?.remove(),window.document.getElementById(Ti.SCAN_GROUP)?.remove(),window.document.getElementById(Ti.CREATE_GROUP)?.remove(),window.document.getElementById(Ti.INTERACTIVE_GROUP)?.remove(),jQuery('[id^="icdt-temp-"]').remove()}openEditable(){1==this._selected_Ids.length&&(this._contenteditable_Id=this._selected_Ids[0]);let t=ls.data.getNode(this._contenteditable_Id);if(t.id){let{id:e,source:i,size:n,attribute:r,style:a}=t;mr(e,Ri.FOREIGNOBJECT,"foreignObject",{source:i,size:n,attribute:r,style:a})}this.cleanSelected()}closeEditable(){if(!this._contenteditable_Id)return;let t=ls.data.getNode(this._contenteditable_Id);if(t.id){this._contenteditable_Id=0;let{id:e,type:i,source:n,size:r,attribute:a,style:s}=t;mr(e,i,void 0,{source:n,size:r,attribute:a,style:s}),this.cleanSelected(),Pr(ls.dataSelect.nodes)}}}class Ha{createNodeImage(t,e){let{nodeId:i,element:n,size:r,attribute:a,source:s}=gn(Math.ceil(1e9*Math.random()),{size:{x:(e?.x??50)-50,y:(e?.y??50)-50,width:100,height:100},source:{type:"image",image:Hn(t)}});(t=>{if(!t)return;let e=new Image;e.onload=()=>{let t=hn(e.naturalWidth/e.naturalHeight,100);t>=1?(r.width=Math.min(e.naturalWidth,512),r.height=hn(r.width/t,100)):(r.height=Math.min(e.naturalHeight,512),r.width=hn(r.height*t,100)),r.x=hn(r.x+50-r.width/2,100),r.y=hn(r.y+50-r.height/2,100),Object.assign(a,Jn(Ri.IMAGE,r,a)),vr(n,a),ls.data.node=Object.assign({id:i,type:Ri.IMAGE,name:"Image"},{size:r,attribute:a,source:s})},e.onerror=e=>{console.error(`ImgSrc load failed -> ${t}`,e),n?.remove()},e.src=t})(s.image?.url??"")}createNodeIframe(t,e){let{nodeId:i,element:n,size:r,attribute:a,style:s,source:o}=ar(Math.ceil(1e9*Math.random()),{size:{x:(e?.x??50)-50,y:(e?.y??50)-50,width:100,height:100},style:{},source:{type:"iframe",iframe:Hn(t)}});(()=>{let t=ls.data.slide?.svg?.viewBox||{x:0,y:0,width:100,height:100},e=hn(t.width/t.height,100);e>=1?(r.width=Math.min(t.width,512),r.height=hn(r.width/e,100)):(r.height=Math.min(t.height,512),r.width=hn(r.height*e,100)),r.x=hn(r.x+50-r.width/2,100),r.y=hn(r.y+50-r.height/2,100),Object.assign(a,Jn(Ri.IMAGE,r,a)),vr(n,a),ls.data.node=Object.assign({id:i,type:Ri.FOREIGNOBJECT,name:"ForeignObject"},{size:r,attribute:a,style:s,source:o})})()}createNodeEmbed(t,e){let i={x:50,y:50,width:640,height:360};t.type==Fi.AUDIO&&(i.width=480,i.height=80);let{nodeId:n,element:r,size:a,attribute:s,style:o,source:l}=ar(Math.ceil(1e9*Math.random()),{size:{x:(e?.x??i.x)-i.x,y:(e?.y??i.y)-i.y,width:i.width,height:i.height},style:{},source:{type:"embed",embed:Object.assign(t,Hn(t))}});(()=>{let t=hn(i.width/i.height,100);t>=1?(a.width=Math.min(a.width,i.width),a.height=hn(a.width/t,1)):(a.height=Math.min(a.height,i.height),a.width=hn(a.height*t,1)),a.x=hn(a.x+i.x-a.width/2,1),a.y=hn(a.y+i.y-a.height/2,1),Object.assign(s,Jn(Ri.FOREIGNOBJECT,a,s)),vr(r,s),ls.data.node=Object.assign({id:n,type:Ri.FOREIGNOBJECT,name:"ForeignObject"},{size:a,attribute:s,style:o,source:l})})()}createNodeMedia(t,e){let{nodeId:i,element:n,size:r,attribute:a,source:s}=gn(Math.ceil(1e9*Math.random()),{size:{x:(e?.x??50)-50,y:(e?.y??50)-50,width:100,height:100},source:{type:"image",image:Hn(t.cover)}}),o={click:{media:t.media}};(t=>{if(!t)return;let e=new Image;e.onload=()=>{let t=hn(e.naturalWidth/e.naturalHeight,100);t>=1?(r.width=Math.min(e.naturalWidth,512),r.height=hn(r.width/t,100)):(r.height=Math.min(e.naturalHeight,512),r.width=hn(r.height*t,100)),r.x=hn(r.x+50-r.width/2,100),r.y=hn(r.y+50-r.height/2,100),Object.assign(a,Jn(Ri.IMAGE,r,a)),vr(n,a),ls.data.node=Object.assign({id:i,type:Ri.IMAGE,name:"Image"},{size:r,attribute:a,source:s,interactive:o})},e.onerror=e=>{console.error(`ImgSrc load failed -> ${t}`,e),n?.remove()},e.src=t})(s.image?.url??"")}createNodeText(t,e){let{nodeId:i,element:n,size:r,attribute:a,style:s,source:o}=ar(Math.ceil(1e9*Math.random()),{size:{x:(e?.x??0)-0,y:(e?.y??0)-0,width:320,height:80},style:{},source:{type:"html",html:{htmlContent:`<span style="font-family: Roboto; font-size: 24px;">${t.content}</span>`}}});(()=>{let t=hn(4,100);t>=1?(r.width=Math.min(r.width,320),r.height=hn(r.width/t,1)):(r.height=Math.min(r.height,80),r.width=hn(r.height*t,1)),r.x=hn(r.x+0-r.width/2,1),r.y=hn(r.y+0-r.height/2,1),Object.assign(a,Jn(Ri.FOREIGNOBJECT,r,a)),vr(n,a),ls.data.node=Object.assign({id:i,type:Ri.FOREIGNOBJECT,name:"ForeignObject"},{size:r,attribute:a,style:s,source:o})})()}insert(t){if(ls.data.insertSlide(ls.data.slideId,1),t.title){let{nodeId:e,size:i,attribute:n,style:r,source:a}=ar(Math.ceil(1e9*Math.random()),{size:{x:100,y:100,width:800,height:150},source:{type:"html",html:{htmlContent:`<span style="font-size: 40px;">${t.title}</span>`}}});ls.data.node=Object.assign({id:e,type:Ri.FOREIGNOBJECT,name:"ForeignObject"},{size:i,attribute:n,style:r,source:a})}if(t.description){let{nodeId:e,size:i,attribute:n,style:r,source:a}=ar(Math.ceil(1e9*Math.random()),{size:{x:100,y:300,width:600,height:300},source:{type:"html",html:{htmlContent:`<span style="font-size: 24px;">${t.description.replace(/\n/g,"<br/>")}</span>`}}});ls.data.node=Object.assign({id:e,type:Ri.FOREIGNOBJECT,name:"ForeignObject"},{size:i,attribute:n,style:r,source:a})}t.media?.prompt&&((()=>{let{nodeId:t,size:e,attribute:i}=fn(Math.ceil(1e9*Math.random()),{size:{x:775,y:275,width:350,height:350},attribute:{fill:"#FFFFFF",stroke:"#E6E6E6",strokeWidth:1,strokeDasharray:1,rx:4}});ls.data.node=Object.assign({id:t,type:Ri.RECT,name:"Rect"},{size:e,attribute:i})})(),(()=>{let{nodeId:e,size:i,attribute:n,style:r,source:a}=ar(Math.ceil(1e9*Math.random()),{size:{x:800,y:300,width:300,height:300},source:{type:"html",html:{htmlContent:`<span style="font-size: 18px; color: #6633cc"><i>${t.media?.prompt}</i></span>`}}});ls.data.node=Object.assign({id:e,type:Ri.FOREIGNOBJECT,name:"ForeignObject"},{size:i,attribute:n,style:r,source:a})})())}}class Xa{get newSlideId(){return Math.ceil(1e9*Math.random())}get _defaultSlide(){return JSON.parse(JSON.stringify({id:this.newSlideId,name:"Trang mới",svg:{viewBox:ls.screen.frameSize,nodes:[]}}))}constructor(){this._dataSource={slides:[],resources:[]},this._slideIdx=0,this._fnChangeSlides=[],this.getNodeAll=()=>{let t=this._dataSource.slides?.find(((t,e)=>e==this._slideIdx)),e=t?.svg,i=t=>{let e=[];return t.filter((t=>!t.isdeleted)).forEach((t=>{t.type==Ri.GROUP?e=e.concat(i(t.nodes||[])):e.push(t.id)})),e};return i(e?.nodes||[])}}get get(){let t=e=>(e?.filter((t=>t.type==Ri.GROUP)).forEach((e=>{e.nodes=t(e.nodes?.filter((t=>!t.isdeleted)))})),e=e?.filter((t=>t.type!=Ri.GROUP||(t.nodes?.length??0)>0)),e||[]);return this._dataSource.slides?.forEach((e=>{e.svg&&(e.svg.nodes=t(e.svg?.nodes?.filter((t=>!t.isdeleted))))})),this._dataSource}get getResource(){let t=[];return this._dataSource.slides?.forEach((e=>{t.push(e.svg?.background?.path),e.svg?.nodes.forEach((e=>{t.push(e.source?.image?.path),t.push(e.source?.audio?.path),t.push(e.source?.video?.path),t.push(e.source?.file?.path),t.push(e.source?.iframe?.path),t.push(e.source?.embed?.path),t.push(e.source?.track?.path),t.push(e.interactive?.show?.audio?.source?.path),t.push(e.interactive?.click?.audio?.source?.path),t.push(e.interactive?.click?.image?.source?.path),t.push(e.interactive?.click?.video?.source?.path)})),t.push(e.test?.audiotrue?.path),t.push(e.test?.audiofalse?.path),t.push(e.test?.effecttrue?.path),t.push(e.test?.effectfalse?.path),t.push(e.test?.icontrue?.path),t.push(e.test?.iconfalse?.path)})),t.filter((t=>t)).map((t=>t.replace(/(\?|\#)[^\?\#]+/g,"").toLowerCase())).filter(((t,e,i)=>i.indexOf(t)==e))}get getFonts(){return rn(JSON.stringify(this._dataSource.slides??[]))}set set(t){this._dataSource=t,this._dataSource.slides||(this._dataSource.slides=[]),this._dataSource.slides.length||(this._slideIdx=0,this._dataSource.slides.push(JSON.parse(JSON.stringify(this._defaultSlide)))),yr(),this.changeSlide(this.slides,this.slideIdx,this._dataSource.slides.length,this.slide)}get dataSource(){let t=e=>(e?.filter((t=>t.type==Ri.GROUP)).forEach((e=>{e.nodes=t(e.nodes?.filter((t=>!t.isdeleted)))})),e=e?.filter((t=>t.type!=Ri.GROUP||(t.nodes?.length??0)>0)),e||[]);return this._dataSource.slides?.forEach((e=>{e.svg&&(e.svg.nodes=t(e.svg?.nodes?.filter((t=>!t.isdeleted))))})),this._dataSource.resources=this.getResource,this._dataSource}set dataSource(t){this._dataSource=t,this._dataSource.slides||(this._dataSource.slides=[]),this._dataSource.slides.length||(this._slideIdx=0,this._dataSource.slides.push(JSON.parse(JSON.stringify(this._defaultSlide)))),yr(),this.changeSlide(this.slides,this.slideIdx,this._dataSource.slides.length,this.slide)}get slideId(){return this.slide?.id??0}get slideIdx(){return this._slideIdx}get slide(){return this._dataSource.slides?.find(((t,e)=>e==this._slideIdx))}get slides(){return this._dataSource.slides||[]}backSlide(){this._slideIdx>0&&(this._slideIdx-=1,this.openSlide(void 0,this._slideIdx))}nextSlide(){this._slideIdx<(this._dataSource.slides?.length??0)-1&&(this._slideIdx+=1,this.openSlide(void 0,this._slideIdx))}refreshSlide(){yr(),ma(this.slide)}openSlide(t,e){if(t){for(let e=0,i=this._dataSource.slides?.length??0;e<i;e++)if((this._dataSource.slides??[])[e].id==t){this._slideIdx=e;break}}else e&&e>=0&&e<(this._dataSource.slides?.length??0)?this._slideIdx=e??0:(this._slideIdx=0,this._dataSource.slides?.length||(this._dataSource.slides=[JSON.parse(JSON.stringify(this._defaultSlide))]));yr(),this.slide?.svg?.viewBox&&(ls.screen.frameSize=this.slide.svg.viewBox),ma(this.slide),this.changeSlide(this.slides,this.slideIdx,this._dataSource.slides?.length??0,this.slide)}addSlide(){this._dataSource.slides?.push(this._defaultSlide),this._slideIdx=(this._dataSource.slides?.length??0)-1,this.openSlide(void 0,this._slideIdx)}tryMergeSlide(t,e,i){let n=this._dataSource.slides?.find((e=>e.id==t));return n?n.test?.type&&e.test?.type?"boolean"!=typeof i?-1:i?this.mergeSlide(t,n,e):this.insertSlide(t,1,e):this.mergeSlide(t,n,e):this.insertSlide(t,1,e)}tryReplaceSlide(t,e){let i=this._dataSource.slides?.find((e=>e.id==t));if(!i||i?.svg?.nodes.filter((t=>!t.isdeleted)).length)return this.insertSlide(t,1,e);let n=this._dataSource.slides?.indexOf(i)??0;return this._dataSource.slides?.splice(n,1,e),this._slideIdx=n,this.openSlide(void 0,this._slideIdx),1}mergeSlide(t,e,i){return e.test=i.test??e.test,e.audio=i.audio??e.audio,e.svg?e.svg.nodes=e.svg.nodes.concat(i.svg?.nodes??[]):e.svg=i.svg,this.openSlide(t),1}insertSlide(t,e,i){let n=this._dataSource.slides?.find((e=>e.id==t))??this._defaultSlide,r=(this._dataSource.slides?.indexOf(n)??0)+e;return i?(i.id=this.newSlideId,i.code=void 0,i.name||(i.name="Trang mới"),i.svg?.viewBox||i.svg&&(i.svg.viewBox=ls.screen.frameSize)):i=this._defaultSlide,this._dataSource.slides?.splice(r,0,i),this._slideIdx=r,this.openSlide(void 0,this._slideIdx),1}copySlide(t){let e=this._dataSource.slides?.find((e=>e.id==t))??this._defaultSlide,i=(this._dataSource.slides?.indexOf(e)??0)+1,n=Object.assign(JSON.parse(JSON.stringify(e)),{id:this.newSlideId,code:void 0,name:`${e.name} + (Copy)`});this._dataSource.slides?.splice(i,0,n),this.changeSlide(this.slides,this.slideIdx,this._dataSource.slides?.length??0,this.slide)}moveSlide(t,e){let i=this._dataSource.slides?.find((e=>e.id==t))??this._defaultSlide,n=this._dataSource.slides?.indexOf(i)??0;this._dataSource.slides?.splice(n+e,0,this._dataSource.slides?.splice(n,1)[0])}deleteSlide(t){let e=this._dataSource.slides?.find((e=>e.id==t))??this._defaultSlide,i=this._dataSource.slides?.indexOf(e)??0;this._dataSource.slides?.splice(i,1),this._dataSource.slides?.length?i<this._slideIdx?(--this._slideIdx,this.changeSlide(this.slides,this.slideIdx,this._dataSource.slides?.length??0,this.slide)):i==this._slideIdx&&(--this._slideIdx,this.openSlide(void 0,this._slideIdx)):this.addSlide()}deleteSlide1(t){let e=this._dataSource.slides?.find((e=>e.id==t))??this._defaultSlide,i=this._dataSource.slides?.indexOf(e)??0;if(e.isdeleted=!0,this._dataSource.slides?.filter((t=>!t.isdeleted))?.length){let t=!0;for(;e.isdeleted;)t?i++:i--,this._dataSource.slides[i]?e=this._dataSource.slides[i]:t=!t;this.openSlide(e.id)}else this.addSlide()}set onChangeSlide(t){this._fnChangeSlides.push(t)}changeSlide(t,e,i,n){this._fnChangeSlides.forEach((r=>r(t,e,i,n)))}set node(t){let e=this._dataSource.slides?.find(((t,e)=>e==this._slideIdx));e?.svg?.nodes&&e.svg.nodes.push(t),ls.history.push([{type:"add",from:{id:t.id},to:{id:t.id}}]),ma(e),ma(e,e?.id)}findNode(t){let e=this._dataSource.slides?.find(((t,e)=>e==this._slideIdx)),i=e?.svg,n=(e,i)=>{let r=e?.find((e=>e.id==t));if(r)return r.pid=i,r;let a=0,s=e.length||0;for(;a<s&&!r&&(r=n(e[a].nodes||[],e[a].id),!r);)a++;return r},r=n(i?.nodes||[]);return r?(r.style=r.style??{},r.source=r.source??{},r.animate=r.animate??{},r.interactive=r.interactive??{},r.variable=r.variable??{},r):{id:0,size:{x:0,y:0,width:0,height:0},attribute:{},isfake:!0}}getNode(t){let e=this._dataSource.slides?.find(((t,e)=>e==this._slideIdx)),i=e?.svg,n=e=>{let i=e?.find((e=>e.id==t))||(t=>{let e=null,i=0,r=t.length||0;for(;i<r&&!e;){if(e=n(t[i].nodes),e){e.pid=t[i].id;break}i++}return e&&(e.style=e.style??{},e.source=e.source??{},e.animate=e.animate??{},e.interactive=e.interactive??{},e.variable=e.variable??{}),e})(e?.filter((t=>t.type==Ri.GROUP))||[]);return i&&(i.style=i.style??{},i.source=i.source??{},i.animate=i.animate??{},i.interactive=i.interactive??{},i.variable=i.variable??{}),i};return n(i?.nodes||[])||{id:null,pid:null,type:null,element:document.createElement("div"),size:{x:0,y:0,width:0,height:0,points:[]},attribute:{},style:{},source:{},animate:{},interactive:{},variable:{},isfake:!0,isdeleted:!1,nodes:[]}}getNodeInArea(t,e,i,n,r){let a=this._dataSource.slides?.find(((t,e)=>e==this._slideIdx)),s=a?.svg,o=a=>{let s=[];return a.filter((t=>!t.isdeleted)).forEach((a=>{a.type==Ri.GROUP?s=s.concat(o(a.nodes||[])):t>a.size.x||e>a.size.y||i<a.size.x+a.size.width||n<a.size.y+a.size.height||(r?a.type==r&&s.push(a.id):s.push(a.id))})),s};return o(s?.nodes||[])}getNodeOnArea(t,e,i,n,r){let a=this._dataSource.slides?.find(((t,e)=>e==this._slideIdx)),s=a?.svg,o=a=>{let s=[];return a.filter((t=>!t.isdeleted)).forEach((a=>{a.type==Ri.GROUP?s=s.concat(o(a.nodes||[])):a.size.x+a.size.width<t||a.size.y+a.size.height<e||a.size.x>i||a.size.y>n||(r?a.type==r&&s.push(a.id):s.push(a.id))})),s};return o(s?.nodes||[])}deleteNode(t,e){return this.getNode(t).isdeleted=e??!0,ma(this.slide),ma(this.slide,this.slide?.id),t}unGroup(t){let e=this.getNode(t),i=Math.ceil(1e9*Math.random());return this.slide?.svg?.nodes.push(Object.assign(JSON.parse(JSON.stringify(e)),{id:i})),Object.assign(e,{isdeleted:!0}),ma(this.slide),ma(this.slide,this.slide?.id),i}addGroup(t,e){let i=this.getNode(t),n=this.getNode(e);n.nodes=n.nodes||[];let r=Math.ceil(1e9*Math.random());return n.nodes.push(Object.assign(JSON.parse(JSON.stringify(i)),{id:r})),Object.assign(i,{isdeleted:!0}),ma(this.slide),ma(this.slide,this.slide?.id),r}setNodeP(t,e){let i=this.slide?.svg?.nodes.find((e=>e.id==t));i&&(i.pid=e||null)}bringToFront(t){this.bringToFrontStep(t,0)}sendToBack(t){this.sendToBackStep(t,0)}bringToFrontStep(t,e){this.slide?.svg?.nodes.forEach(((t,e)=>{t.index=e+1}));let i=(this.slide?.svg?.nodes.length??0)+1;t.map((t=>({id:t,index:this.slide?.svg?.nodes.find((e=>e.id==t))?.index??0}))).sort(((t,e)=>t.index-e.index)).forEach((t=>{e?this.slide?.svg?.nodes.filter(((e,i)=>e.id==t.id)).forEach((i=>{i.index=e+t.index+t.index/1e3})):this.slide?.svg?.nodes.filter((e=>e.id==t.id)).forEach((e=>{e.index=i+t.index}))})),this.slide?.svg?.nodes.sort(((t,e)=>(t.index??0)-(e.index??0))),va(this.slide),window.document.getElementById(Ti.RESIZE_GROUP)?.remove(),window.document.getElementById(Ti.SELECT_GROUP)?.remove(),Pr(ls.dataSelect.nodes)}sendToBackStep(t,e){this.slide?.svg?.nodes.forEach(((t,e)=>{t.index=e+1})),t.map((t=>({id:t,index:this.slide?.svg?.nodes.find((e=>e.id==t))?.index??0}))).sort(((t,e)=>t.index-e.index)).forEach((t=>{e?this.slide?.svg?.nodes.filter((e=>e.id==t.id)).forEach((i=>{i.index=e+t.index+t.index/1e3})):this.slide?.svg?.nodes.filter((e=>e.id==t.id)).forEach((e=>{e.index=t.index/100-1}))})),this.slide?.svg?.nodes.sort(((t,e)=>(t.index??0)-(e.index??0))),va(this.slide),window.document.getElementById(Ti.RESIZE_GROUP)?.remove(),window.document.getElementById(Ti.SELECT_GROUP)?.remove(),Pr(ls.dataSelect.nodes)}bringToFrontArea(t){let e=t.map((t=>ls.data.getNode(t))).filter((t=>!t.isfake)),{x1:i,y1:n,x2:r,y2:a}=qa(e),s=this.getNodeOnArea(i,n,r,a);this.slide?.svg?.nodes.forEach(((t,e)=>{t.index=e+1}));let o=s.map((t=>this.slide?.svg?.nodes.find((e=>e.id==t))?.index??0)),l=Math.max.apply(null,o);t.forEach(((t,e)=>{this.slide?.svg?.nodes.filter((e=>e.id==t)).forEach((t=>{t.index=l+(e+1)/100}))})),this.slide?.svg?.nodes.sort(((t,e)=>(t.index??0)-(e.index??0))),va(this.slide),window.document.getElementById(Ti.RESIZE_GROUP)?.remove(),window.document.getElementById(Ti.SELECT_GROUP)?.remove(),Pr(ls.dataSelect.nodes)}sendToBackArea(t){let e=t.map((t=>ls.data.getNode(t))).filter((t=>!t.isfake)),{x1:i,y1:n,x2:r,y2:a}=qa(e),s=this.getNodeOnArea(i,n,r,a);this.slide?.svg?.nodes.forEach(((t,e)=>{t.index=e+1}));let o=s.map((t=>this.slide?.svg?.nodes.find((e=>e.id==t))?.index??0)),l=Math.min.apply(null,o)-1;t.forEach(((t,e)=>{this.slide?.svg?.nodes.filter((e=>e.id==t)).forEach((t=>{t.index=l+(e+1)/100}))})),this.slide?.svg?.nodes.sort(((t,e)=>(t.index??0)-(e.index??0))),va(this.slide),window.document.getElementById(Ti.RESIZE_GROUP)?.remove(),window.document.getElementById(Ti.SELECT_GROUP)?.remove(),Pr(ls.dataSelect.nodes)}}const qa=t=>{let e=999999,i=999999,n=-999999,r=-999999;return t.forEach((t=>{e=Math.min(e,t.size.x),i=Math.min(i,t.size.y),n=Math.max(n,t.size.x+t.size.width),r=Math.max(r,t.size.y+t.size.height)})),{x1:e,y1:i,x2:n,y2:r}};class Ya{constructor(){this._index=-1,this._dataSource=[],this.undoExecute=t=>{t.forEach((function(t){switch(t.type){case"add":ls.data.deleteNode(t.from.id);break;case"edit":break;case"delete":ls.data.deleteNode(t.from.id,!1);break;case"size":{let{id:e,type:i,size:n,attribute:r}=ls.data.getNode(t.from.id);Object.assign(n,t.from.size),Object.assign(r,Jn(i,n,r)),vr(window.document.getElementById(e),r);break}case"attribute":{let{id:e,attribute:i}=ls.data.getNode(t.from.id);Object.assign(i,t.from.attribute),vr(window.document.getElementById(e),i);break}case"style":{let{id:e,style:i}=ls.data.getNode(t.from.id);Object.assign(i??{},t.from.style),br(window.document.getElementById(e),i);break}case"source":{let{id:e,type:i,source:n}=ls.data.getNode(t.from.id);Object.assign(n??{},t.from.source),wr(window.document.getElementById(e),i,n??{});break}case"animate":{let{animate:e}=ls.data.getNode(t.from.id);Object.assign(e??{},t.from.animate);break}case"interactive":{let{interactive:e}=ls.data.getNode(t.from.id);Object.assign(e??{},t.from.interactive);break}case"variable":{let{variable:e}=ls.data.getNode(t.from.id);Object.assign(e??{},t.from.variable);break}}})),ls.dataSelect.ids=[]},this.redoExecute=t=>{t.forEach((function(t){switch(t.type){case"add":ls.data.deleteNode(t.to.id,!1);break;case"edit":break;case"delete":ls.data.deleteNode(t.to.id,!0);break;case"size":{let{id:e,type:i,size:n,attribute:r}=ls.data.getNode(t.to.id);Object.assign(n,t.to.size),Object.assign(r,Jn(i,n,r)),vr(window.document.getElementById(e),r);break}case"attribute":{let{id:e,attribute:i}=ls.data.getNode(t.to.id);Object.assign(i,t.to.attribute),vr(window.document.getElementById(e),i);break}case"style":{let{id:e,style:i}=ls.data.getNode(t.to.id);Object.assign(i??{},t.to.style),br(window.document.getElementById(e),i);break}case"source":{let{id:e,type:i,source:n}=ls.data.getNode(t.to.id);Object.assign(n??{},t.to.source),wr(window.document.getElementById(e),i,n??{});break}case"animate":{let{animate:e}=ls.data.getNode(t.to.id);Object.assign(e??{},t.to.animate);break}case"interactive":{let{interactive:e}=ls.data.getNode(t.to.id);Object.assign(e??{},t.to.interactive);break}case"variable":{let{variable:e}=ls.data.getNode(t.to.id);Object.assign(e??{},t.to.variable);break}}})),ls.dataSelect.ids=[]},this._fnChanges=[],this._index=-1,this._dataSource=[]}get index(){return this._index}get total(){return this._dataSource.length}get dataSource(){return this._dataSource}renew(){this._index=-1,this._dataSource=[],this.change()}push(t){this._index<0?(this._index=0,this._dataSource.length=0,this._dataSource[this._index]={data:t}):(this._index<this._dataSource.length-1&&this._dataSource.splice(this._index+1,this._dataSource.length-this._index-1),this._index++,this._dataSource.push({data:t})),this.change()}undo(){if(this._index<0)return;let t=this._dataSource[this._index];this.undoExecute(t.data),this._index--,this.change()}redo(){if(this._index>=this._dataSource.length-1)return;this._index++;let t=this._dataSource[this._index];this.redoExecute(t.data),this.change()}set onchange(t){this._fnChanges.push(t)}change(){this._fnChanges.forEach((t=>t(this.index,this.total)))}}class Za{constructor(){this._x=0,this._y=0,this._width=0,this._height=0,this._scale=1,this._dislocation={x:0,y:0},this._offset={x:0,y:0},this._svgSize={x:0,y:0,width:0,height:0},this._svgViewBox={x:0,y:0,width:0,height:0},this._frameSize={x:0,y:0,width:1280,height:720},this._actived=!1,this._fnZoomChanges=[]}get actived(){return this._actived}set actived(t){this._actived=t}get get(){return{x:this._frameSize.x,y:this._frameSize.y,w:this._frameSize.width,h:this._frameSize.height,width:this._frameSize.width,height:this._frameSize.height}}set set(t){this._frameSize.width=t?.width??1080,this._frameSize.height=t?.height??1080,this.zoomTo="fit"}get width(){return this._width}get height(){return this._height}get scale(){return this._scale}get dislocation(){return this._dislocation}get offset(){return this._offset}get svgSize(){return this._svgSize}get svgViewBox(){return this._svgViewBox}set svgViewBox(t){this._svgViewBox=t}get frameSize(){return this._frameSize}set frameSize(t){this._frameSize.x=t.x,this._frameSize.y=t.y,this._frameSize.width=t.width,this._frameSize.height=t.height,this.reset()}set screen(t){this._offset=t.offset,this._width=t.width,this._height=t.height,this.reset()}reset(){this.scaleTo(this._scale,void 0,!0)}scaleTo(t,e,i){if(!(t<.01||t>100)){if(e=e??{x:this._width/2,y:this._height/2},i)this._dislocation.x=this._width/t/2-e.x,this._dislocation.y=this._height/t/2-e.y,this._dislocation.x+=(this._width-this._frameSize.width)/2,this._dislocation.y+=(this._height-this._frameSize.height)/2;else{var n={x:Math.max(0,Math.min(hn(e.x/this._width,1e3),1)),y:Math.max(0,Math.min(hn(e.y/this._height,1e3),1))},r={x:(this._width/t-this._width/this._scale)*n.x,y:(this._height/t-this._height/this._scale)*n.y};this._dislocation.x+=r.x,this._dislocation.y+=r.y}this._scale=t,this.change(),this.zoomChange(this.scale)}}set zoomTo(t){"fit"==t?this.scaleTo(Math.min((this._width-80)/this._frameSize.width,(this._height-80)/this._frameSize.height),void 0,!0):"number"==typeof t&&this.scaleTo(t/100,void 0,!0)}zoomIn(){this.scaleTo(this._scale+.04*this._scale)}zoomOut(){this.scaleTo(this._scale-.04*this._scale)}init(){return{svgViewBox:this.svgViewBox,svgSize:this.svgSize}}move(t,e){this._dislocation.x=t.x+e.x/this._scale,this._dislocation.y=t.y+e.y/this._scale,this._svgViewBox.x=-this._dislocation.x,this._svgViewBox.y=-this._dislocation.y,this.refScreen()}change(){this._svgSize.x=this._x,this._svgSize.y=this._y,this._svgSize.width=this._width,this._svgSize.height=this._height,this._svgViewBox.x=-this._dislocation.x,this._svgViewBox.y=-this._dislocation.y,this._svgViewBox.width=this._width/this._scale,this._svgViewBox.height=this._height/this._scale,this.refScreen()}refScreen(){pr()}set onZoomChange(t){this._fnZoomChanges.push(t)}zoomChange(t){this._fnZoomChanges.forEach((e=>e(t)))}}class ts{constructor(){this._fill="#D9D9D9",this._stroke="#AAAAAA",this._strokeWidth=1,this._strokeLinecap="round",this._strokeLinejoin="round",this._fontFamily=void 0,this._fontSize=20,this._textLength=void 0,this._fnChangeFills=[],this._fnChangeStrokes=[],this._fnChangeStrokeWidths=[],this.loadConfig()}loadConfig(){fa({callback:t=>{this._fill=t?.fill||this._fill,this._stroke=t?.stroke||this._stroke,this._strokeWidth=t?.strokeWidth||this._strokeWidth,this._strokeLinecap=t?.strokeLinecap||this._strokeLinecap,this._strokeLinejoin=t?.strokeLinejoin||this._strokeLinejoin,this.changeFill(this.fill),this.changeStroke(this.stroke),this.changeStrokeWidth(this.strokeWidth)}})}saveConfig(){ga({params:{fill:this._fill,stroke:this._stroke,strokeWidth:this._strokeWidth,strokeLinecap:this._strokeLinecap,strokeLinejoin:this._strokeLinejoin}})}get fill(){return this._fill}set fill(t){this._fill=t,this.changeFill(this.fill)}get stroke(){return this._stroke}set stroke(t){this._stroke=t,this.changeStroke(this.stroke)}get strokeWidth(){return this._strokeWidth}set strokeWidth(t){this._strokeWidth=t,this.changeStrokeWidth(this.strokeWidth)}get strokeLinecap(){return this._strokeLinecap}set strokeLinecap(t){this._strokeLinecap=t}get strokeLinejoin(){return this._strokeLinejoin}set strokeLinejoin(t){this._strokeLinejoin=t}get fontFamily(){return this._fontFamily}get fontSize(){return this._fontSize}get textLength(){return this._textLength}set onchangefill(t){this._fnChangeFills.push(t)}changeFill(t){this._fnChangeFills.forEach((e=>e(t))),this.saveConfig()}set onchangestroke(t){this._fnChangeStrokes.push(t)}changeStroke(t){this._fnChangeStrokes.forEach((e=>e(t))),this.saveConfig()}set onchangestrokewidth(t){this._fnChangeStrokeWidths.push(t)}changeStrokeWidth(t){this._fnChangeStrokeWidths.forEach((e=>e(t))),this.saveConfig()}}var es=function(t){return t?JSON.parse(JSON.stringify(t)):t},is=[{key:"FinishedTest",type:"boolean",value:!1,note:"Hoàn thành BKT",system:!0,readonly:!1},{key:"TotalTest",type:"number",value:0,note:"Tổng số BKT",system:!0,readonly:!1},{key:"TotalTestDidNotPass",type:"number",value:0,note:"Số BKT không vượt qua",system:!0,readonly:!1},{key:"TotalTestPassed",type:"number",value:0,note:"Số BKT đã vượt qua",system:!0,readonly:!1}],ns=[],rs={key:"BienSo",value:"0",type:"number",note:null,readonly:!1},as={if:[{type:"variable",variable:"BienSo",variables:null,slide:null,node:null,condition:">",operator:null,valuetype:"value",value:5}],then:[{type:"variable",variable:"BienChu",variables:null,slide:null,node:null,condition:null,operator:"=",valuetype:"value",value:"BienSo > 5"}],else:[{type:"variable",variable:"BienChu",variables:null,slide:null,node:null,condition:null,operator:"=",valuetype:"value",value:"BienSo <= 5"}],id:"57623302",idx:1,variables:["BienSo"]};class ss{constructor(){this._data_variables=es(is).concat(es(ns)),this._data_conditions=[],this.GetActionExecutings=[],this.GetActionExecuteds=[],this.FuncGetExecuteds=t=>{"function"==typeof t&&this.GetActionExecuteds.push(t)},this.OnGetActionExecuted=t=>{this.GetActionExecuteds.forEach((e=>{e(t)}))},this.SetActionExecutings=[],this.FuncSetExecutings=t=>{"function"==typeof t&&this.SetActionExecutings.push(t)},this.OnSetActionExecuting=t=>{this.SetActionExecutings.forEach((e=>{e(t)}))},this.SetActionExecuteds=[],this.FuncSetExecuteds=t=>{"function"==typeof t&&this.SetActionExecuteds.push(t)},this.OnSetActionExecuted=t=>{for(var e of(this.SetActionExecuteds.forEach((e=>{e(t)})),this.getCondition(t.key)||[]))e.if&&e.if.length>0&&(this.checkValueConditions(e.if)?this.setValueOperators(e.then||[]):this.setValueOperators(e.else||[]))}}renew(){this._data_variables=es(is).concat(es(ns)),this._data_conditions=[]}get totalVariable(){return this._data_variables.length}get totalCondition(){return this._data_conditions.length}get get(){return{variables:this._data_variables||[],conditions:this._data_conditions||[]}}set set(t){if(!t)return;let e={};"string"==typeof t?e=JSON.parse(t):"object"==typeof t&&(e=t),this._data_variables=e.variables||[],this._data_conditions=e.conditions||(t=>(this._data_variables.map((t=>t.change||[])).forEach((e=>{t=t.concat(e)})),t))([]),is.forEach((t=>{var e=this._data_variables.filter((e=>e.key==t.key));e.length?e.forEach((function(e,i,n){e.type=t.type,e.readonly=t.readonly,e.system=t.system})):this._data_variables.push(t)}))}getVariableTemp(){return es(rs)}getConditionTemp(){return es(as)}getKeys(){return this._data_variables.map((function(t){return t.key})).sort((function(t,e){return t.localeCompare(e)}))}getVariableAll(){return this._data_variables.length?es((t=this._data_variables,e="key",function(i){for(var n of t.map((function(t){return t[e]})).sort())t.filter((function(t){return t[e]==n})).forEach((function(t){i.push(t)})),t=t.filter((function(t){return t[e]!=n}));return i}([]))):es(is).concat(es(ns));var t,e}setVariableAll(t){t&&("string"==typeof t&&(t=JSON.parse(t)),"object"==typeof t&&(this._data_variables=t),is.forEach((t=>{var e=this._data_variables.filter((e=>e.key==t.key));e.length?e.forEach(((e,i,n)=>{e.type=t.type,e.readonly=t.readonly,e.system=t.system})):this._data_variables.push(t)})))}getVariable(t){return t?es(this._data_variables.filter((e=>e.key==t))[0]||{}):{}}setVariable(t,e,i){if(t){switch([null,void 0,NaN,1/0].indexOf(e)>=0&&(e=""),i||(i=(this._data_variables.filter((e=>e.key==t))[0]||{}).type||null),i){case"string":"string"!=typeof e&&(e=e.toString().trim());break;case"number":"number"!=typeof e&&(e=parseFloat(e)||0);break;case"boolean":"string"==typeof e&&(e=e.toLowerCase()),"boolean"!=typeof e&&(e="1"==e||"true"==e||"yes"==e||"dung"==e)}var n=this._data_variables.filter((e=>e.key==t));n.length?n.forEach((function(t,n,r){t.value=e,t.type=i})):this._data_variables.push({key:t,value:e,type:i})}}getValue(t,e){if(!t)return"";var i=this._data_variables.filter((function(e){return e.key==t}));if(i.length){var n,r=i[0]||{};switch(this.OnGetActionExecuting(r),e||(e=r.type||null),e){case"string":n=[null,void 0,NaN,1/0].indexOf(r.value)>=0?"":"string"==typeof r.value?r.value||"":r.value.toString().trim();break;case"number":n=[null,void 0,NaN,1/0].indexOf(r.value)>=0?0:"number"==typeof r.value?r.value||0:parseFloat(r.value)||0;break;case"boolean":[null,void 0,NaN,1/0].indexOf(r.value)>=0?n=!1:"boolean"==typeof r.value?n=r.value:(n=(r.value+"").toLowerCase(),n="1"==r.value||"true"==r.value||"yes"==r.value||"dung"==r.value);break;case"audio-src":n=[null,void 0,NaN,1/0].indexOf(r.value)>=0?"":r.value?`<audio controls style="width:280px;vertical-align:middle;"><source src="${r.value}"></source></audio>`:"";break;case"video-src":n=[null,void 0,NaN,1/0].indexOf(r.value)>=0?"":r.value?`<video controls style="width:280px;vertical-align:middle;"><source src="${r.value}"></source></video>`:"";break;case"img-src":n=[null,void 0,NaN,1/0].indexOf(r.value)>=0?"":r.value?`<img style="width:100%;vertical-align:middle;" src="${r.value}"/>`:"";break;default:n=[null,void 0,NaN,1/0].indexOf(r.value)>=0?"":r.value}return this.OnGetActionExecuted(r),n}return null}setValue(t,e,i){if(t){switch([null,void 0,NaN,1/0].indexOf(e)>=0&&(e=""),i||(i=(this._data_variables.filter((function(e){return e.key==t}))[0]||{}).type||null),i){case"string":"string"!=typeof e&&(e=e.toString().trim());break;case"number":"number"!=typeof e&&(e=parseFloat(e)||0);break;case"boolean":"string"==typeof e&&(e=e.toLowerCase()),"boolean"!=typeof e&&(e="1"==e||"true"==e||"yes"==e||"dung"==e)}var n=this._data_variables.filter((function(e){return e.key==t}));if(n.length){var r=n[0];this.OnSetActionExecuting(r),r&&(r.value=e),this.OnSetActionExecuted(r)}}}getConditionAll(){return es(this._data_conditions.sort((function(t,e){return t.idx-e.idx})))}setConditionAll(t){t&&("string"==typeof t&&(t=JSON.parse(t)),"object"==typeof t&&(this._data_conditions=t))}getCondition(t){return t?es(this._data_conditions.filter((e=>e.variable==t||(e.variables||[]).indexOf(t)>=0)).sort((function(t,e){return t.idx-e.idx}))):{}}switchCondition(t,e,i){switch(t){case"==":return"string"==typeof i?(i=i.toLowerCase().trim(),"string"==typeof e&&(e=e.toLowerCase().trim()),i.split(";").map((function(t){return e==t.trim()?1:0})).reduce((function(t,e){return t+e}))>0):e==i;case"!=":return"string"==typeof i?(i=i.toLowerCase().trim(),"string"==typeof e&&(e=e.toLowerCase().trim()),0==i.split(";").map((function(t){return e==t.trim()?1:0})).reduce((function(t,e){return t+e}))):e!=i;case">=":return e>=i;case"<=":return e<=i;case">":return e>i;case"<":return e<i;case"∈":return i=(i+"").toLowerCase().trim(),e=(e+"").toLowerCase().trim(),i.split(";").map((function(t){return e.indexOf(t.trim())>=0?1:0})).reduce((function(t,e){return t+e}))>0;case"∉":return i=(i+"").toLowerCase().trim(),e=(e+"").toLowerCase().trim(),0==i.split(";").map((function(t){return e.indexOf(t.trim())>=0?1:0})).reduce((function(t,e){return t+e}));default:return!1}}switchOperator(t,e,i){switch(t){case"+":return e+i;case"-":return e-i;case"*":return e*i;case"/":return e/i;case"=":return i;case"=!":return!i;case"==":return e==i;case"!=":return e!=i}}switchFormula(t,e){switch(t){case"sum":return e.reduce((function(t,e){return t+e}));case"sub":return e.reduce((function(t,e){return t-e}));case"pro":return e.reduce((function(t,e){return t*e}));case"div":return e.reduce((function(t,e){return t/e}));case"avg":var i=e.reduce((function(t,e){return t+e}))/(e.length||1);return Math.round(1e4*(i+Number.EPSILON))/1e4;case"min":return Math.min.apply(null,e);case"max":return Math.max.apply(null,e);case"and":return e.reduce((function(t,e){return t&&e}));case"or":return e.reduce((function(t,e){return t||e}));default:return 0}}switchValueType_Condition(t){switch(t.valuetype){case"value":return this.switchCondition(t.condition,this.getValue(t.variable),t.value);case"variable":return this.switchCondition(t.condition,this.getValue(t.variable),this.getValue(t.value));default:return 0}}switchValueType_Operator(t){switch(t.valuetype){case"value":return this.switchOperator(t.operator,this.getValue(t.variable),t.value);case"variable":return this.switchOperator(t.operator,this.getValue(t.variable),this.getValue(t.value));case"variables":var e=this.switchFormula(t.valueformula,t.value.map((t=>this.getValue(t))));return this.switchOperator(t.operator,this.getValue(t.variable),e)}}checkValueCondition(t){return this.switchValueType_Condition(t)}getValueOperator(t){return this.switchValueType_Operator(t)}setValueOperator(t){t?.variable&&this.setValue(t.variable,this.getValueOperator(t))}checkValueConditions(t){return 0==t.map((t=>{switch(t.type){case"variable":return this.switchValueType_Condition(t)?0:1;case"variables":return 0==t.variables.map((e=>this.switchValueType_Condition(Object.assign(es(t),{variable:e}))?0:1)).reduce((function(t,e){return t+e}))?0:1;default:return 0}})).reduce(((t,e)=>(t??0)+(e??0)))}setValueOperators(t){for(var e of t)switch(e.type){case"variable":this.setValue(e.variable,this.getValueOperator(e));break;case"variables":for(var i of e.variables)this.setValue(i,this.getValueOperator(Object.assign(es(e),{variable:i})));break;case"slide":hr.runSlide(void 0,void 0,e.slide);break;case"node":{Tn({id:e.node,nodeStatus:hr.nodeStatus,slideStatus:hr.slideStatus});let t=hr.findNode(e.node);t?.interactive?.click&&Rn(t,hr.nodeStatus,hr.slideStatus);break}}}FuncGetExecutings(t){"function"==typeof t&&this.GetActionExecutings.push(t)}OnGetActionExecuting(t){this.GetActionExecutings.forEach((e=>{e(t)}))}}class os{constructor(){this._fnChangePointerTypes=[],this._fnChangePointerTypeTemps=[],this._fnChangePenTypes=[],this._fnChangeShapeTypes=[],this._fnChangePolygonTypes=[],this._fnChanges=[],this._pointer_type=0,this._pointer_type_temp=0,this._pen_type=0,this._shape_type=0,this._polygon_type=0}setPointer_nochange(t,e,i){if(this._pointer_type=t,e)switch(t){case Ci.PEN:this._pen_type=e;break;case Ci.SHAPE:this._shape_type=e,i&&e===Ri.POLYGON&&(this._polygon_type=i)}}get pointer_type(){return this._pointer_type}set pointer_type(t){switch(this._pointer_type=t,t){case Ci.PEN:this._pen_type||(this._pen_type=Bi.DRAW);break;case Ci.SHAPE:this._shape_type||(this._shape_type=Ri.RECT)}this.changePointerType(this.pointer_type),this.change(this.pointer_type)}get pointer_type_temp(){return this._pointer_type_temp}set pointer_type_temp(t){this._pointer_type_temp=t,this.changePointerTypeTemp(this.pointer_type),this.change(this.pointer_type_temp)}get pen_type(){return this._pen_type}set pen_type(t){this._pen_type=t,this.changePenType(this.pointer_type,this.pen_type),this.change(this.pointer_type,this.pen_type)}get shape_type(){return this._shape_type}set shape_type(t){this._shape_type=t,this.changeShapeType(this.pointer_type,this.shape_type),this.change(this.pointer_type,this.shape_type)}get polygon_type(){return this._polygon_type}set polygon_type(t){this._polygon_type=t,this.changePolygonType(this.pointer_type,this.shape_type,this.polygon_type),this.change(this.pointer_type,this.shape_type,this.polygon_type)}set onchangePointerType(t){this._fnChangePointerTypes.push(t)}changePointerType(t,e,i){this._fnChangePointerTypes.forEach((n=>n(t,e,i)))}set onchangePointerTypeTemp(t){this._fnChangePointerTypeTemps.push(t)}changePointerTypeTemp(t,e,i){this._fnChangePointerTypeTemps.forEach((n=>n(t,e,i)))}set onchangePenType(t){this._fnChangePenTypes.push(t)}changePenType(t,e,i){this._fnChangePenTypes.forEach((n=>n(t,e,i)))}set onchangeShapeType(t){this._fnChangeShapeTypes.push(t)}changeShapeType(t,e,i){this._fnChangeShapeTypes.forEach((n=>n(t,e,i)))}set onchangePolygonType(t){this._fnChangePolygonTypes.push(t)}changePolygonType(t,e,i){this._fnChangePolygonTypes.forEach((n=>n(t,e,i)))}set onchange(t){this._fnChanges.push(t)}change(t,e,i){this._fnChanges.forEach((n=>n(t,e,i)))}}const ls=new class{constructor(){this._container="",this._svg="",this._screen=Za.prototype,this._data=Xa.prototype,this._dataSelect=Va.prototype,this._slide=Ha.prototype,this._history=Ya.prototype,this._attribute=ts.prototype,this._pointer=os.prototype,this._variable=ss.prototype,this._data=new Xa,this._dataSelect=new Va,this._slide=new Ha,this._history=new Ya,this._attribute=new ts,this._pointer=new os,this._variable=new ss,this._pointer.onchangePointerType=()=>{this._dataSelect.ids.length&&(this._dataSelect.ids=[])},this._data.onChangeSlide=()=>{this._dataSelect.ids.length&&(this._dataSelect.ids=[])}}get config(){return this._config}set config(t){this._config=t}get dataSource(){return{modules:"icdtV2",screen:this._screen.get,data:this._data.get,variable:this._variable.get,resources:this._data.getResource,fonts:this._data.getFonts,info:{}}}set dataSource(t){this._screen.set=t.screen||{width:1080,height:1080},this._data.set=t.data||{},this._variable.set=t.variable||{}}get container(){return this._container}set container(t){this._container=t}get svg(){return this._svg}set svg(t){this._svg=t}get target(){return window.document.querySelector(this._svg)}get screen(){return this._screen}get data(){return this._data}get dataSelect(){return this._dataSelect}get slide(){return this._slide}get history(){return this._history}get attribute(){return this._attribute}get pointer(){return this._pointer}get variable(){return this._variable}reloadView(){var t,e,i;this._screen.screen=(t=jQuery(this._container).offset(),e=jQuery(this._container).width(),i=jQuery(this._container).height(),{offset:{x:t?.left??0,y:t?.top??0},width:e??0,height:i??0})}init(t){this._container=t.container,this._svg=t.target,this._screen=new Za,Wa({container:t.container,target:t.target,iskeyboard:t.iskeyboard})}},cs=t=>!!t.match("^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$"),ds=t=>!!t.match(/^rgba?/),hs=t=>!!t.match(/^none|transparent$/),us=(t,e)=>{gs(t,null,e,t);var i=t=>{"text"==t.nodeName?(t=>{t.child?.length&&(t.nodeName="g",t.child=t.child.reduce(((t,e,i,n)=>{if("tspan"==e.nodeName){let i=t.find((t=>t.fill==e.fill&&t.y==e.y&&t["font-family"]==e["font-family"]&&t["font-weight"]==e["font-weight"]&&t["font-style"]==e["font-style"]&&t["font-size"]==e["font-size"]));i?(i.x=Math.min(parseFloat(i.x??"0"),parseFloat(e.x??"0")),i.textContent+=e.textContent):(e.nodeName="text",t.push(e))}else t.push(e);return t}),[]))})(t):t.child?.length&&t.child.forEach((t=>i(t)))},n=t=>t.reduce(((t,e,i,r)=>{if("g"==e.nodeName&&e.child?.length&&(e.child=n(e.child)),"text"==e.nodeName){let i=t.find((t=>t.fill==e.fill&&t.y==e.y&&t["font-family"]==e["font-family"]&&t["font-weight"]==e["font-weight"]&&t["font-style"]==e["font-style"]&&t["font-size"]==e["font-size"]));i?(i.x=Math.min(parseFloat(i.x??"0"),parseFloat(e.x??"0")),i.textContent+=e.textContent):t.push(e)}else t.push(e);return t}),[]);e.forEach((t=>i(t))),e=n(e),console.log("SVG2JSON",e);let r=(()=>{let e=t.getAttribute("viewBox")?.replace(/^([0-9\.]+)[\s]([0-9\.]+)[\s\,]([0-9\.]+)[\s\,]([0-9\.]+)$/g,"$1,$2,$3,$4")?.split(",")?.map((t=>hn(parseFloat(t),1)));return 4==e?.length?{x:e[0],y:e[1],width:e[2],height:e[3]}:{x:ms(t.getAttribute("x"))??0,y:ms(t.getAttribute("y"))??0,width:ms(t.getAttribute("width"))??0,height:ms(t.getAttribute("height"))??0}})(),a={id:ls.data.newSlideId,name:"SVG",svg:{viewBox:r,nodes:fs(e)}};if(console.log(a),a.svg&&(!a.svg.viewBox.width||!a.svg.viewBox.height)){let t=0,e=0,i=n=>{n.forEach((n=>{let{size:r}=n;t=Math.max(t,r.width),e=Math.max(e,r.height),i(n.nodes??[])}))};i(a.svg.nodes??[]),a.svg.viewBox.width=t,a.svg.viewBox.height=e}return a},fs=(t,e)=>{let i=[];return t.forEach((t=>{let n={id:Math.ceil(1e9*Math.random()),pid:e,name:t.nodeName,type:(()=>{switch(t.nodeName){case"polygon":return Ri.POLYGON;case"polyline":return Ri.POLYLINE;case"path":return Ri.PATH;case"circle":return Ri.CIRCLE;case"ellipse":return Ri.ELLIPSE;case"line":return Ri.LINE;case"rect":return Ri.RECT;case"foreignObject":return Ri.FOREIGNOBJECT;case"image":return Ri.IMAGE;case"text":return Ri.TEXT;case"tspan":return Ri.TSPAN;case"g":return Ri.GROUP}return 0})(),size:(()=>{let e={},i=0,n=0,r=0,a=0,s=t.rotate??null;switch(t.nodeName){case"circle":{let e=parseFloat(t.cx||"0"),s=parseFloat(t.cy||"0"),o=parseFloat(t.r||"0");i=e-o,n=s-o,r=2*o,a=2*o;break}case"ellipse":{let e=parseFloat(t.cx||"0"),s=parseFloat(t.cy||"0"),o=parseFloat(t.rx||"0"),l=parseFloat(t.ry||"0");i=e-o,n=s-l,r=2*o,a=2*l;break}case"line":{let s=parseFloat(t.x1||"0"),o=parseFloat(t.y1||"0"),l=parseFloat(t.x2||"0"),c=parseFloat(t.y2||"0"),d=999999999,h=999999999,u=0,f=0;d=Math.min(s,l),h=Math.min(o,c),u=Math.max(s,l),f=Math.max(o,c),i=d,n=h,r=u-i||1,a=f-n||1;let g=[[(s-i)/r,(o-n)/a],[(l-i)/r,(c-n)/a]];Object.assign(e,{ratios:g});break}case"rect":i=parseFloat(t.x||"0"),n=parseFloat(t.y||"0"),r=parseFloat(t.width||"0"),a=parseFloat(t.height||"0"),Object.assign(e,{x:i,y:n,width:r,height:a});break;case"foreignObject":case"image":i=parseFloat(t.x||"0"),n=parseFloat(t.y||"0"),r=parseFloat(t.width||"0"),a=parseFloat(t.height||"0");break;case"text":case"tspan":e.x||e.y||(t.x&&(i=parseFloat(t.x||"0")),t.y&&(n=parseFloat(t.y||"0"))),(e=>{let i=16;var s;e&&(i=e.match(/rem/)?16*parseInt(e):parseInt(e)),a=1.2*(s=i),r=s/14*8*(t.textContent?.length??1),t["alignment-baseline"]||t["dominant-baseline"]||(n-=s)})(t["font-size"]||"16");break;case"polygon":case"polyline":{if(!t.points)break;let s=(t=>{return(e=t.replace(/\,/g," ").replace(/\-/g," -").replace(/[^0-9\.\-]/g," ").replace(/\s+/g," ").trim())?e.split(/\s/).map((t=>parseFloat(t))):[];var e})(t.points),{minX:o,minY:l,maxX:c,maxY:d}=(t=>{let e=[],i=[];return t.forEach(((t,n)=>{n%2==0?e.push(t):i.push(t)})),{minX:Math.min.apply(null,e),minY:Math.min.apply(null,i),maxX:Math.max.apply(null,e),maxY:Math.max.apply(null,i)}})(s);i=o,n=l,r=c-i||1,a=d-n||1,Object.assign(e,{ratios:kn({x:i,y:n,width:r,height:a},s)});break}case"path":{if(!t.d)break;let s=wn(t.d),{minX:o,minY:l,maxX:c,maxY:d}=Sn(s);i=o,n=l,r=c-i||1,a=d-n||1,Object.assign(e,{ratioMaps:xn({x:i,y:n,width:r,height:a},s)});break}}return o=t.transform?.replace(/\,/," ")?.replace(/\s+/g," "),o?.match(/rotate\([^\)]+\)/)&&(l=(o?.match(/rotate\([^\)]+\)/)??[])?.shift()?.toString(),l&&(c=l?.replace(/[^0-9\-\.\,\ ]/g,"")?.replace(/\,/g," ")?.replace(/\s+/g," ")?.split(" "),c.length&&Object.assign(e,{rotate:parseFloat(c[0]||"0")}))),o?.match(/translate\([^\)]+\)/)&&(d=(o?.match(/translate\([^\)]+\)/)??[])?.shift()?.toString(),d&&(t=>{t.length>=2&&(i+=parseFloat(t[0]||"0"),n+=parseFloat(t[1]||"0"))})(d?.replace(/[^0-9\-\.\,\ ]/g,"")?.replace(/\,/g," ")?.replace(/\s+/g," ")?.split(" "))),o?.match(/matrix\([^\)]+\)/)&&(t=>{if(t){let e=Nn({x:i,y:n},t);i=e.x,n=e.y,s=e.rotate??null}})(o),Object.assign(e,{x:i,y:n,width:r,height:a,rotate:s}),e;var o,l,c,d})(),attribute:(()=>{let e={};switch(t.fill&&(t=>{ds(t)?e.fill=an(t):cs(t)?e.fill=t:hs(t)?e.fill="rgba(0,0,0,0)":e.fill="#000000"})(t.fill),t["fill-opacity"]&&(e.fillOpacity=t["fill-opacity"]),t["fill-rule"]&&(e.fillRule=t["fill-rule"]),t.stroke&&(t=>{ds(t)?e.stroke=an(t):cs(t)?e.stroke=t:hs(t)?e.stroke="rgba(0,0,0,0)":e.stroke="#000000"})(t.stroke),t["stroke-opacity"]&&(e.strokeOpacity=t["stroke-opacity"]),t["stroke-width"]&&(e.strokeWidth=parseFloat(t["stroke-width"])||0),t["stroke-linecap"]&&(e.strokeLinecap=t["stroke-linecap"]),t["stroke-linejoin"]&&(e.strokeLinejoin=t["stroke-linejoin"]),t["stroke-miterlimit"]&&(e.strokeMiterlimit=parseFloat(t["stroke-miterlimit"])||0),t["stroke-dasharray"]&&(e.strokeDasharray=parseFloat(t["stroke-dasharray"])||0),t.nodeName){case"polygon":case"polyline":{let i=t.points??null;Object.assign(e,{points:i});break}case"path":{let i=t.d??null;Object.assign(e,{d:i});break}case"circle":case"ellipse":case"line":case"rect":case"foreignObject":case"image":break;case"text":case"tspan":{let i=t["font-family"]??null,n=t["font-weight"]??null,r=t["font-style"]??null,a=t["font-size"]??null,s=t["letter-spacing"]??null,o=t["word-spacing"]??null,l=t["alignment-baseline"]??null,c=t["dominant-baseline"]??null,d=t["text-anchor"]??null;if(i){let t=nn(i);i=t.fontFamily??i,n=t.fontWeight??n,r=t.fontStyle??r}l||c||(c="text-before-edge"),Object.assign(e,{fontFamily:i,fontWeight:n,fontStyle:r,letterSpacing:s,wordSpacing:o,alignmentBaseline:l,dominantBaseline:c,textAnchor:d}),a&&(a.match(/rem/)?Object.assign(e,{fontSize:16*parseInt(a)}):Object.assign(e,{fontSize:parseInt(a)}));break}}return e})(),style:(t.nodeName,{}),source:(()=>{let e={};switch(t.nodeName){case"polygon":case"polyline":case"circle":case"ellipse":case"line":case"rect":case"foreignObject":break;case"image":t.base64&&Object.assign(e,{type:"image",image:{base64:t.base64}});break;case"text":case"tspan":t.textContent&&Object.assign(e,{type:"text",text:{textContent:t.textContent}})}return e})()};if(i.push(n),t.child){let e=fs(t.child,n.id);i=[...i,...e]}})),i},gs=(t,e,i,n)=>{t.querySelectorAll(":scope > *").forEach((t=>{if(["defs","script"].includes(t.nodeName))return;let r=[],a={};switch(ps(t,a),a=Object.assign({},e??{},a),"use"===a.nodeName&&(a.href?ps(n.querySelector(a.href),a):a["xlink:href"]&&ps(n.querySelector(a["xlink:href"]),a)),a.nodeName){case"circle":case"ellipse":if(a.transform?.match(/matrix\([^\)]+\)/)){let t=parseFloat(a.x??"0"),e=parseFloat(a.y??"0");(i=>{if(i){let n=Nn({x:t,y:e},i);a.x=n.x,a.y=n.y,a.rotate=n.rotate??null}})(a.transform),a.transform=null}break;case"text":{if(a.transform?.match(/matrix\([^\)]+\)/)){let t=parseFloat(a.x??"0"),e=parseFloat(a.y??"0");(i=>{if(i){let n=Nn({x:t,y:e},i);a.x=n.x,a.y=n.y,a.rotate=n.rotate??null}})(a.transform),a.transform=null}else if(a.transform?.match(/translate\([^\)]+\)/)){let t=parseFloat(a.x??"0"),e=parseFloat(a.y??"0");s=(a.transform?.match(/translate\([^\)]+\)/)??[])?.shift()?.toString(),s&&(o=s?.replace(/[^0-9\-\.\,\ ]/g,"")?.replace(/\,/g," ")?.replace(/\s+/g," ")?.split(" "),o.length>=2&&(a.x=t+parseFloat(o[0]||"0"),a.y=e+parseFloat(o[1]||"0"))),a.transform=null}let e=t.textContent;e&&Object.assign(a,{textContent:e}),a.fill||a.stroke||(a.fill="#000000");break}case"tspan":{if(a.transform?.match(/matrix\([^\)]+\)/)){let t=parseFloat(a.x??"0"),e=parseFloat(a.y??"0");(i=>{if(i){let n=Nn({x:t,y:e},i);a.x=n.x,a.y=n.y}})(a.transform),a.transform=null}else{let t=parseFloat(a.x??"0"),i=parseFloat(a.y??"0");a.x=hn(t+(e?.x??0),10),a.y=hn(i+(e?.y??0),10)}let i=t.textContent;i&&Object.assign(a,{textContent:i}),a.fill||a.stroke||(a.fill="#000000");break}case"path":if(a.d){let t=((t,e)=>{let i=En(e);return i?window.Snap.path.map(t,window.Snap.matrix(i.a,i.b,i.c,i.d,i.e,i.f)).toString():t})(a.d,a.transform?.match(/matrix/)?a.transform:"matrix(1 0 0 1 0 0)");Object.assign(a,{d:t}),a.transform=null}a.fill||a.stroke||(a.fill="#000000");break;case"image":{let t=a["xlink:href"]||a.href;t?.match(/;base64,/)&&Object.assign(a,{base64:t});break}}var s,o;gs(t,a,r,n),r.length&&Object.assign(a,{child:r}),i.push(a)}))},ps=(t,e)=>{t&&(["symbol"].includes(t.nodeName)?ps((t.querySelectorAll(":scope > *")||[])[0],e):(e.nodeName=t.nodeName,[["x","y","width","height"],["x1","x2","y1","y2"],["rx","ry","r"],["cx","cy"],["fill","fill-opacity","fill-rule"],["stroke","stroke-opacity","stroke-width","stroke-miterlimit","stroke-linecap","stroke-linejoin","stroke-dasharray"],["d","points"],["font-family","font-weight","font-style","font-size","letter-spacing","word-spacing","alignment-baseline","dominant-baseline","text-anchor"],["transform","transform-origin"],["href","xlink:href"]].forEach((i=>{i.forEach((i=>{ys(t,e,i)}))}))))},ys=(t,e,i)=>{let n=t.getAttribute(i);if(n){let t={};t[i]=n.trim(),Object.assign(e,t)}},ms=t=>t?"string"==typeof t?t.match(/in/)?hn(96*parseFloat(t.replace(/[^0-9\.]/g,"")??"0"),1):hn(parseFloat(t.replace(/[^0-9\.]/g,"")??"0"),1):"number"==typeof t?t:0:0,vs=(t,e)=>{var i={data:{slides:[]},info:{},resources:[],screen:{w:0,h:0,width:0,height:0},variable:{conditions:[],variables:[]}};return(i=t.shift()).data=i.data||{slides:[]},i.data.slides=i.data.slides||[],i.variable=i.variable||{conditions:[],variables:[]},i.variable.conditions=i.variable.conditions||[],i.variable.variables=i.variable.variables||[],t.forEach(((t,e)=>{var n=(t.data||{slides:[]}).slides||[],r=t.variable||{conditions:[],variables:[]},a=r.conditions||[],s=r.variables||[];n.forEach((function(t){if(n.find((function(e){return e.id==t.id}))){var e=t.id.toString(),i=ls.data.newSlideId;t.id=i,n.forEach((function(t){t.svg?.nodes&&(t.svg.nodes=JSON.parse(JSON.stringify(t.svg.nodes).replace(new RegExp(e,"g"),i.toString())))})),a=JSON.parse(JSON.stringify(a).replace(new RegExp(e,"g"),i.toString()))}}));var o=i.variable.variables.map((function(t){return t.key}));s=s.filter((function(t){return o.indexOf(t.key)<0}));var l=i.variable.conditions.length;a.sort((function(t,e){return t.idx-e.idx})).map((function(t,e){return t.idx=e+1,t})).forEach((function(i,n){console.log(`${e}(b=${t.board_id}) -> ${i.idx} + ${l} = ${i.idx+l}`),i.idx=i.idx+l})),i.data.slides=i.data.slides.concat(n),i.variable.conditions=i.variable.conditions.concat(a),i.variable.variables=i.variable.variables.concat(s)})),i},bs=(t,e)=>{let{id:i,size:n,animate:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,animate:r}));r?r.value=e:r={value:e},ls.history.push([{type:"animate",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,animate:r}))}])},ws=(t,e)=>{let{id:i,size:n,animate:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,animate:r}));r?r.in=e:r={in:e},ls.history.push([{type:"animate",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,animate:r}))}])},Ss=(t,e)=>{let{id:i,size:n,animate:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,animate:r}));r?r.out=e:r={out:e},ls.history.push([{type:"animate",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,animate:r}))}])},xs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.action?n.show.action.value=e:n.show.action={value:e}:n.show={action:{value:e}}:n={show:{action:{value:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},_s=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.action?n.show.action.points=e:n.show.action={points:e}:n.show={action:{points:e}}:n={show:{action:{points:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},ks=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.action?n.show.action.time=e:n.show.action={time:e}:n.show={action:{time:e}}:n={show:{action:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Os=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.action?n.show.action.iteration=e:n.show.action={iteration:e}:n.show={action:{iteration:e}}:n={show:{action:{iteration:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ns=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.action?n.show.action.finish=e:n.show.action={finish:e}:n.show={action:{finish:e}}:n={show:{action:{finish:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Es=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.audio?n.show.audio.source=e:n.show.audio={source:e}:n.show={audio:{source:e}}:n={show:{audio:{source:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Is=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.audio?n.show.audio.iteration=e:n.show.audio={iteration:e}:n.show={audio:{iteration:e}}:n={show:{audio:{iteration:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}]),-1==e&&js(t,"change-slide")},zs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.audio?n.show.audio.finish=e:n.show.audio={finish:e}:n.show={audio:{finish:e}}:n={show:{audio:{finish:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},js=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.audio?n.show.audio.async=e:n.show.audio={async:e}:n.show={audio:{async:e}}:n={show:{audio:{async:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Js=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.audio?n.show.audio.time=e:n.show.audio={time:e}:n.show={audio:{time:e}}:n={show:{audio:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},$s=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggershow?n.show.triggershow.id=e:n.show.triggershow={id:e}:n.show={triggershow:{id:e}}:n={show:{triggershow:{id:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},As=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggershow?n.show.triggershow.ids=e:n.show.triggershow={ids:e}:n.show={triggershow:{ids:e}}:n={show:{triggershow:{ids:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ts=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggershow?n.show.triggershow.async=e:n.show.triggershow={async:e}:n.show={triggershow:{async:e}}:n={show:{triggershow:{async:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Cs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggershow?n.show.triggershow.time=e:n.show.triggershow={time:e}:n.show={triggershow:{time:e}}:n={show:{triggershow:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Bs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggerrun?n.show.triggerrun.id=e:n.show.triggerrun={id:e}:n.show={triggerrun:{id:e}}:n={show:{triggerrun:{id:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Rs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggerrun?n.show.triggerrun.ids=e:n.show.triggerrun={ids:e}:n.show={triggerrun:{ids:e}}:n={show:{triggerrun:{ids:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ms=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggerrun?n.show.triggerrun.async=e:n.show.triggerrun={async:e}:n.show={triggerrun:{async:e}}:n={show:{triggerrun:{async:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ls=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggerrun?n.show.triggerrun.time=e:n.show.triggerrun={time:e}:n.show={triggerrun:{time:e}}:n={show:{triggerrun:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ps=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggerhide?n.show.triggerhide.id=e:n.show.triggerhide={id:e}:n.show={triggerhide:{id:e}}:n={show:{triggerhide:{id:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Fs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggerhide?n.show.triggerhide.ids=e:n.show.triggerhide={ids:e}:n.show={triggerhide:{ids:e}}:n={show:{triggerhide:{ids:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ks=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggerhide?n.show.triggerhide.async=e:n.show.triggerhide={async:e}:n.show={triggerhide:{async:e}}:n={show:{triggerhide:{async:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Gs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.show?n.show.triggerhide?n.show.triggerhide.time=e:n.show.triggerhide={time:e}:n.show={triggerhide:{time:e}}:n={show:{triggerhide:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ds=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.action?n.click.action.value=e:n.click.action={value:e}:n.click={action:{value:e}}:n={click:{action:{value:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Qs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.action?n.click.action.points=e:n.click.action={points:e}:n.click={action:{points:e}}:n={click:{action:{points:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Us=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.action?n.click.action.time=e:n.click.action={time:e}:n.click={action:{time:e}}:n={click:{action:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ws=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.action?n.click.action.iteration=e:n.click.action={iteration:e}:n.click={action:{iteration:e}}:n={click:{action:{iteration:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Vs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.action?n.click.action.finish=e:n.click.action={finish:e}:n.click={action:{finish:e}}:n={click:{action:{finish:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Hs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.audio?n.click.audio.source=e:n.click.audio={source:e}:n.click={audio:{source:e}}:n={click:{audio:{source:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Xs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.audio?n.click.audio.iteration=e:n.click.audio={iteration:e}:n.click={audio:{iteration:e}}:n={click:{audio:{iteration:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}]),-1==e&&js(t,"change-slide")},qs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.audio?n.click.audio.finish=e:n.click.audio={finish:e}:n.click={audio:{finish:e}}:n={click:{audio:{finish:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Ys=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.audio?n.click.audio.async=e:n.click.audio={async:e}:n.click={audio:{async:e}}:n={click:{audio:{async:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},Zs=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.audio?n.click.audio.time=e:n.click.audio={time:e}:n.click={audio:{time:e}}:n={click:{audio:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},to=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggershow?n.click.triggershow.id=e:n.click.triggershow={id:e}:n.click={triggershow:{id:e}}:n={click:{triggershow:{id:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},eo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggershow?n.click.triggershow.ids=e:n.click.triggershow={ids:e}:n.click={triggershow:{ids:e}}:n={click:{triggershow:{ids:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},io=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggershow?n.click.triggershow.async=e:n.click.triggershow={async:e}:n.click={triggershow:{async:e}}:n={click:{triggershow:{async:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},no=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggershow?n.click.triggershow.time=e:n.click.triggershow={time:e}:n.click={triggershow:{time:e}}:n={click:{triggershow:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},ro=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggerrun?n.click.triggerrun.id=e:n.click.triggerrun={id:e}:n.click={triggerrun:{id:e}}:n={click:{triggerrun:{id:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},ao=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggerrun?n.click.triggerrun.ids=e:n.click.triggerrun={ids:e}:n.click={triggerrun:{ids:e}}:n={click:{triggerrun:{ids:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},so=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggerrun?n.click.triggerrun.async=e:n.click.triggerrun={async:e}:n.click={triggerrun:{async:e}}:n={click:{triggerrun:{async:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},oo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggerrun?n.click.triggerrun.time=e:n.click.triggerrun={time:e}:n.click={triggerrun:{time:e}}:n={click:{triggerrun:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},lo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggerhide?n.click.triggerhide.id=e:n.click.triggerhide={id:e}:n.click={triggerhide:{id:e}}:n={click:{triggerhide:{id:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},co=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggerhide?n.click.triggerhide.ids=e:n.click.triggerhide={ids:e}:n.click={triggerhide:{ids:e}}:n={click:{triggerhide:{ids:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},ho=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggerhide?n.click.triggerhide.async=e:n.click.triggerhide={async:e}:n.click={triggerhide:{async:e}}:n={click:{triggerhide:{async:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},uo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.triggerhide?n.click.triggerhide.time=e:n.click.triggerhide={time:e}:n.click={triggerhide:{time:e}}:n={click:{triggerhide:{time:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},fo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.slide?(n.click.slide.id=e?.id,n.click.slide.code=e?.code):n.click.slide=e:n.click={slide:e}:n={click:{slide:e}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},go=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.media=e:n.click={media:e}:n={click:{media:e}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},po=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.image?n.click.image.source=e:n.click.image={source:e}:n.click={image:{source:e}}:n={click:{image:{source:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},yo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.video?n.click.video.source=e:n.click.video={source:e}:n.click={video:{source:e}}:n={click:{video:{source:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},mo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.link?n.click.link.source=e:n.click.link={source:e}:n.click={link:{source:e}}:n={click:{link:{source:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},vo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.link?n.click.link.source?n.click.link.source.url=e:n.click.link.source={url:e}:n.click.link={source:{url:e}}:n.click={link:{source:{url:e}}}:n={click:{link:{source:{url:e}}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},bo=(t,e)=>{let{id:i,interactive:n}=t,r=JSON.parse(JSON.stringify({id:i,interactive:n}));n?n.click?n.click.text?n.click.text.content=e:n.click.text={content:e}:n.click={text:{content:e}}:n={click:{text:{content:e}}},ls.history.push([{type:"interactive",from:r,to:JSON.parse(JSON.stringify({id:i,interactive:n}))}])},wo=(t,e)=>{let{id:i,variable:n}=t,r=JSON.parse(JSON.stringify({id:i,variable:n}));n?n.input?n.input.variable=e:n.input={variable:e}:n={input:{variable:e}},ls.history.push([{type:"variable",from:r,to:JSON.parse(JSON.stringify({id:i,variable:n}))}])},So=(t,e)=>{let{id:i,variable:n}=t,r=JSON.parse(JSON.stringify({id:i,variable:n}));n?n.click?n.click.variable=e:n.click={variable:e}:n={click:{variable:e}},ls.history.push([{type:"variable",from:r,to:JSON.parse(JSON.stringify({id:i,variable:n}))}])},xo=(t,e)=>{let{id:i,variable:n}=t,r=JSON.parse(JSON.stringify({id:i,variable:n}));n?n.click?n.click.operator=e:n.click={operator:e}:n={click:{operator:e}},ls.history.push([{type:"variable",from:r,to:JSON.parse(JSON.stringify({id:i,variable:n}))}])},_o=(t,e)=>{let{id:i,variable:n}=t,r=JSON.parse(JSON.stringify({id:i,variable:n}));n?n.click?n.click.valuetype=e:n.click={valuetype:e}:n={click:{valuetype:e}},ls.history.push([{type:"variable",from:r,to:JSON.parse(JSON.stringify({id:i,variable:n}))}])},ko=(t,e)=>{let{id:i,variable:n}=t,r=JSON.parse(JSON.stringify({id:i,variable:n}));n?n.click?n.click.value=e:n.click={value:e}:n={click:{value:e}},ls.history.push([{type:"variable",from:r,to:JSON.parse(JSON.stringify({id:i,variable:n}))}])},Oo=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=999999;for(let{size:e}of t)i=Math.min(i,e.x);for(let{id:e,type:n,size:r,attribute:a}of t)r.x=i,Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},No=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=999999;for(let{size:e}of t)i=Math.min(i,e.y);for(let{id:e,type:n,size:r,attribute:a}of t)r.y=i,Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Eo=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=-999999;for(let{size:e}of t)i=Math.max(i,e.x+e.width);for(let{id:e,type:n,size:r,attribute:a}of t)r.x=i-r.width,Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Io=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=-999999;for(let{size:e}of t)i=Math.max(i,e.y+e.height);for(let{id:e,type:n,size:r,attribute:a}of t)r.y=i-r.height,Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},zo=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=999999,n=-999999,r=0;for(let{size:e}of t)i=Math.min(i,e.x),n=Math.max(n,e.x+e.width);r=hn((i+n)/2);for(let{id:e,type:i,size:n,attribute:a}of t)n.x=hn(r-n.width/2),Object.assign(a,Jn(i,n,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},jo=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=999999,n=-999999,r=0;for(let{size:e}of t)i=Math.min(i,e.y),n=Math.max(n,e.y+e.height);r=hn((i+n)/2);for(let{id:e,type:i,size:n,attribute:a}of t)n.y=hn(r-n.height/2),Object.assign(a,Jn(i,n,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Jo=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=ls.data.slide?.svg?.viewBox.x??0;for(let{id:e,type:n,size:r,attribute:a}of t)r.x=i,Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},$o=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=ls.data.slide?.svg?.viewBox.y??0;for(let{id:e,type:n,size:r,attribute:a}of t)r.y=i,Object.assign(a,Jn(n,r,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Ao=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let{x:i,width:n}=ls.data.slide?.svg?.viewBox??{x:0,width:0},r=i+n;for(let{id:e,type:i,size:n,attribute:a}of t)n.x=r-n.width,Object.assign(a,Jn(i,n,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},To=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let{y:i,height:n}=ls.data.slide?.svg?.viewBox??{y:0,height:0},r=i+n;for(let{id:e,type:i,size:n,attribute:a}of t)n.y=r-n.height,Object.assign(a,Jn(i,n,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Co=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let{x:i,width:n}=ls.data.slide?.svg?.viewBox??{x:0,width:0},r=hn((i+(i+n))/2);for(let{id:e,type:i,size:n,attribute:a}of t)n.x=hn(r-n.width/2),Object.assign(a,Jn(i,n,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Bo=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let{y:i,height:n}=ls.data.slide?.svg?.viewBox??{y:0,height:0},r=hn((i+(i+n))/2);for(let{id:e,type:i,size:n,attribute:a}of t)n.y=hn(r-n.height/2),Object.assign(a,Jn(i,n,a)),vr(window.document.getElementById(e),a);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Ro=t=>{if(t.length<3)return;let e=[];t.forEach(((t,i)=>{let{id:n,type:r,size:a,attribute:s}=t;e.push(JSON.parse(JSON.stringify({id:n,size:a,attribute:s})))}));let i=999999,n=-999999,r=[],a=t.length;for(let e=0;e<a;e++){let{id:i,size:n}=t[e];r.push({idx:e,id:i,x:n.x+n.width/2})}r=r.sort(((t,e)=>t.x-e.x)),i=r[0].x,n=r[a-1].x;let s=n-i;for(let e=1,n=r.length-2;e<=n;e++){let{id:n,type:o,size:l,attribute:c}=t[r[e].idx];l.x=i+s*e/(a-1)-l.width/2,Object.assign(c,Jn(o,l,c)),vr(window.document.getElementById(n),c)}ls.history.push(t.map(((t,i)=>{let{id:n,type:r,size:a,attribute:s}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:a,attribute:s}))}})))},Mo=t=>{if(t.length<3)return;let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let i=999999,n=-999999,r=[],a=t.length;for(let e=0;e<a;e++){let{id:i,size:n}=t[e];r.push({idx:e,id:i,y:n.y+n.height/2})}r=r.sort(((t,e)=>t.y-e.y)),i=r[0].y,n=r[a-1].y;let s=n-i;for(let e=1,n=r.length-2;e<=n;e++){let{id:n,type:o,size:l,attribute:c}=t[r[e].idx];l.y=i+s*e/(a-1)-l.height/2,Object.assign(c,Jn(o,l,c)),vr(window.document.getElementById(n),c)}ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Lo=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,type:r,size:a,attribute:s}=t;e.push(JSON.parse(JSON.stringify({id:n,size:a,attribute:s})))}));let{x:i,width:n}=ls.data.slide?.svg?.viewBox??{x:0,width:0};for(let{id:e,type:r,size:a,attribute:s}of t)a.x=i,a.width=n,Object.assign(s,Jn(r,a,s)),vr(window.document.getElementById(e),s);ls.history.push(t.map(((t,i)=>{let{id:n,type:r,size:a,attribute:s}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:a,attribute:s}))}})))},Po=t=>{let e=[];t.forEach(((t,i)=>{let{id:n,size:r,attribute:a}=t;e.push(JSON.parse(JSON.stringify({id:n,size:r,attribute:a})))}));let{y:i,height:n}=ls.data.slide?.svg?.viewBox??{y:0,height:0};for(let{id:e,type:r,size:a,attribute:s}of t)a.y=i,a.height=n,Object.assign(s,Jn(r,a,s)),vr(window.document.getElementById(e),s);ls.history.push(t.map(((t,i)=>{let{id:n,size:r,attribute:a}=t;return{type:"size",from:e[i],to:JSON.parse(JSON.stringify({id:n,size:r,attribute:a}))}})))},Fo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.opacity="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Ko=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));e?cs(e)&&(r.fill=e):r.fill=void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Go=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.fillOpacity="number"==typeof e?hn(e/100,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Do=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));e?cs(e)&&(r.stroke=e):r.stroke=void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Qo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.strokeOpacity="number"==typeof e?hn(e/100,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Uo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.strokeWidth="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Wo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.strokeDasharray="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Vo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.strokeLinecap=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Ho=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.strokeLinejoin=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Xo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.preserveAspectRatio=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},qo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.fontFamily=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Yo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.fontWeight=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},Zo=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.fontStyle=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},tl=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.fontSize="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},el=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.textLength="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},il=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.letterSpacing="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},nl=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.wordSpacing="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},rl=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.textDecoration=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},al=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.textAnchor=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},sl=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.dominantBaseline=e,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},ol=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.r="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},ll=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.rx="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},cl=(t,e)=>{let{id:i,size:n,attribute:r}=t,a=JSON.parse(JSON.stringify({id:i,size:n,attribute:r}));r.ry="number"==typeof e?hn(e,100):void 0,vr(window.document.getElementById(i),r),ls.history.push([{type:"attribute",from:a,to:JSON.parse(JSON.stringify({id:i,size:n,attribute:r}))}])},dl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.padding=hn(e):n={padding:hn(e)},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},hl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.borderWidth=e:n={borderWidth:e},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},ul=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.borderStyle=e:n={borderStyle:e},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},fl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n})),a=t=>{n?n.borderColor=t:n={borderColor:t}};e?cs(e)&&a(e):a(),br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},gl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.borderOpacity="number"==typeof e?hn(e/100,100):void 0:n={borderOpacity:"number"==typeof e?hn(e/100,100):void 0},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},pl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.borderRadius=hn(e):n={borderRadius:hn(e)},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},yl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.fontFamily=e:n={fontFamily:e},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},ml=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.fontSize=e:n={fontSize:e},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},vl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n})),a=t=>{n?n.color=t:n={color:t}};e?cs(e)&&a(e):a(),br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},bl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.opacity="number"==typeof e?hn(e/100,100):void 0:n={opacity:"number"==typeof e?hn(e/100,100):void 0},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},wl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n})),a=t=>{n?n.backgroundColor=t:n={backgroundColor:t}};e?cs(e)&&a(e):a(),br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},Sl=(t,e)=>{let{id:i,style:n}=t,r=JSON.parse(JSON.stringify({id:i,style:n}));n?n.backgroundOpacity="number"==typeof e?hn(e/100,100):void 0:n={backgroundOpacity:"number"==typeof e?hn(e/100,100):void 0},br(window.document.getElementById(i),n),ls.history.push([{type:"style",from:r,to:JSON.parse(JSON.stringify({id:i,style:n}))}])},xl=(t,e)=>{t.svg?t.svg.viewBox?t.svg.viewBox.x=hn(e):t.svg.viewBox={x:hn(e),y:0,width:1e3,height:1e3}:t.svg={viewBox:{x:hn(e),y:0,width:1e3,height:1e3}}},_l=(t,e)=>{t.svg?t.svg.viewBox?t.svg.viewBox.y=hn(e):t.svg.viewBox={x:0,y:hn(e),width:1e3,height:1e3}:t.svg={viewBox:{x:0,y:hn(e),width:1e3,height:1e3}}},kl=(t,e,i)=>{t.svg?t.svg.viewBox?(i&&(t.svg.viewBox.height=hn(e*t.svg.viewBox.height/t.svg.viewBox.width)),t.svg.viewBox.width=hn(e)):t.svg.viewBox={x:0,y:0,width:hn(e),height:hn(e)}:t.svg={viewBox:{x:0,y:0,width:hn(e),height:hn(e)}}},Ol=(t,e,i)=>{t.svg?t.svg.viewBox?(i&&(t.svg.viewBox.width=hn(e*t.svg.viewBox.width/t.svg.viewBox.height)),t.svg.viewBox.height=hn(e)):t.svg.viewBox={x:0,y:0,width:hn(e),height:hn(e)}:t.svg={viewBox:{x:0,y:0,width:hn(e),height:hn(e)}}},Nl=(t,e)=>{t.svg?t.svg.background?t.svg.background.color=e:t.svg.background={color:e}:t.svg={background:{color:e}},gr(t)},El=(t,e)=>{t.svg?t.svg.background?t.svg.background.opacity="number"==typeof e?hn(e/100,100):void 0:t.svg.background={opacity:"number"==typeof e?hn(e/100,100):void 0}:t.svg={background:{opacity:"number"==typeof e?hn(e/100,100):void 0}},gr(t)},Il=(t,e)=>{t.svg?t.svg.background?(t.svg.background.path=e?.path,t.svg.background.url=e?.url,t.svg.background.name=e?.name):t.svg.background=e:t.svg={background:e},gr(t)}}},n={};function r(t){var e=n[t];if(void 0!==e)return e.exports;var a=n[t]={exports:{}};return i[t](a,a.exports,r),a.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,r.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var a=Object.create(null);r.r(a);var s={};t=t||[null,e({}),e([]),e(e)];for(var o=2&n&&i;"object"==typeof o&&!~t.indexOf(o);o=e(o))Object.getOwnPropertyNames(o).forEach((t=>s[t]=()=>i[t]));return s.default=()=>i,r.d(a,s),a},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=r(314);window.addEventListener("load",(function(){var e;t.icdt.container="#mainContainer",t.icdt.svg="#mainSvg";var i,n,r,a=document.getElementById("mainActionList"),s=0,o=1;(null===_board_setting||void 0===_board_setting?void 0:_board_setting.buttons.paging)&&(n=document.createElement("button"),(r=new Image).height=40,r.title="Fullscreen",r.src="public/icon/Back.png",n.append(r),a.append(n),n.onclick=function(){s>0&&(s--,t.icdt_Run.runSlide(s))},(i=document.createElement("div")).className="page-info",i.textContent="".concat(s+1,"/").concat(o),a.append(i),t.icdt_Run.onChangeSlide=function(t,e,n,r,a){s=n,o=r,i.textContent="".concat(s+1,"/").concat(o)},function(){var e=document.createElement("button"),i=new Image;i.height=40,i.title="Fullscreen",i.src="public/icon/Next.png",e.append(i),a.append(e),e.onclick=function(){s<o-1&&(s++,t.icdt_Run.runSlide(s))}}()),(null===_board_setting||void 0===_board_setting?void 0:_board_setting.buttons.refresh)&&function(){var e=document.createElement("button"),i=new Image;i.height=40,i.title="Fullscreen",i.src="public/icon/Refresh.png",e.append(i),a.append(e),e.onclick=function(){t.icdt_Run.runSlide(s)}}(),(null===(e=null===_board_setting||void 0===_board_setting?void 0:_board_setting.buttons)||void 0===e?void 0:e.fullscreen)&&function(){var t=function(){return!!((t=document).fullscreen||t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement);var t},e=document.createElement("button"),i=new Image;i.height=40,i.title="Fullscreen",i.src=t()?"public/icon/Fullscreen_on.png":"public/icon/Fullscreen_off.png",e.append(i),a.append(e),e.onclick=function(){var e;t()?(e=document).exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.msExitFullscreen&&e.msExitFullscreen():function(){var t;(t=document.body).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}(),setTimeout((function(){i.src=t()?"public/icon/Fullscreen_on.png":"public/icon/Fullscreen_off.png"}),600)}}();t.icdt.config={fileuploadurl:"/",readfileuploadurl:"files/"},t.icdt_Run.data=_board_content,t.icdt_Run.runSlide();var l=_board_content.fonts||[];(0,t.APP_FONT_Content)(l.filter((function(t){return"Roboto"!=t})),"https://www.tabca.vn/fonts")}))})()})();